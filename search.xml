<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>ElasticSearch (III)</title>
      <link href="/2022/01/31/ElasticSearch-III/"/>
      <url>/2022/01/31/ElasticSearch-III/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="aaaeb654ce9ece01824786dd07ff1d9af4acdde07824d43837d96cdfd7658b30">68a8c3278477baad47ac774912504a9cdcd8564349944cf2ef53b9f8b29ebf5a19137bfc5a245beab9360db98d3bae4037ed1d8810dafc7e7496d52472d557c6708f4cddb8b6d5f267a1b36aae6562b7708f8ae56d4ad070105d37526582b3b43b390ac34fd310381f70f0e315cf1de6918e9a473c344b333550f5f828453a9fd050b0277aaa33fba7054e07836f27912f844f5bac4f9165b735d84d8392920dbb2c86a4ccf484abefb510bef842d4d08956890af4fa30ba14b5b9a1e3597048</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Need Password to Read the Blog</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
            <tag> Apache </tag>
            
            <tag> Kibana </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearch (II)</title>
      <link href="/2022/01/30/ElasticSearch-II/"/>
      <url>/2022/01/30/ElasticSearch-II/</url>
      
        <content type="html"><![CDATA[<h2 id="è¿è¡Œ-Elasticsearch"><a href="#è¿è¡Œ-Elasticsearch" class="headerlink" title="è¿è¡Œ Elasticsearch"></a>è¿è¡Œ Elasticsearch</h2><p>å‡è®¾å·²ç»ä¸‹è½½ Dockerã€Elasticsearch å’Œ Kibanaï¼Œæ¥ä¸‹æ¥è®²è§£åœ¨ docker é‡Œé¢å¯åŠ¨ Elasticsearch å’Œ Kibanaï¼Œå¹¶å¯¹ Elasticsearch é›†ç¾¤å¯ç”¨å¤šä¸ªèŠ‚ç‚¹ã€‚</p><h3 id="Docker-ä¸­å¯åŠ¨å•èŠ‚ç‚¹-Elasticsearch"><a href="#Docker-ä¸­å¯åŠ¨å•èŠ‚ç‚¹-Elasticsearch" class="headerlink" title="Docker ä¸­å¯åŠ¨å•èŠ‚ç‚¹ Elasticsearch"></a>Docker ä¸­å¯åŠ¨å•èŠ‚ç‚¹ Elasticsearch</h3><p>ä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤ä»¥å®ä¾‹åŒ– ElasticSearch æœåŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name es -d -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.16.2</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå°† 9200 ç«¯å£ä¸ 9300 ç«¯å£æ˜ å°„åˆ° docker ç›¸åº”ç«¯å£ï¼Œå¦‚æœä¸åšç«¯å£æ˜ å°„ï¼Œæµè§ˆå™¨æ— æ³•è®¿é—® elasticsearch æœåŠ¡ã€‚å…¶ä¸­ 9200 ä¸ºä¾› http è®¿é—®ç«¯å£ï¼Œ9300 ä¸ºä¾› tcp è®¿é—®ç«¯å£ã€‚æ³¨æ„ <code>discovery.type=single-node</code>  æŒ‡ä»¤ï¼Œå¯¹äºå•æœºåªç”Ÿæˆä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µè€Œè¨€ï¼Œè¿™ä¸ªå¿…é¡»æŒ‡æ˜ï¼Œå¦åˆ™ docker å¯åŠ¨ elasticsearch ä¼šé—ªé€€ï¼Œç›¸å…³æŠ¥é”™ä¸ºï¼š<code>the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured</code>ã€‚</p><p>å¦‚æœæƒ³è¦å®ç°æ•°æ®æŒä¹…åŒ–ï¼Œåˆ™éœ€è¦é€šè¿‡ -v å‚æ•°å°† docker å®¿ä¸»æœº (host) ä¸Šçš„ç›®å½• mount åˆ° ElasticSearch å®¹å™¨é‡Œã€‚ç›¸å…³æŒ‡ä»¤å¦‚ä¸‹ï¼ˆ<code>/usr/local/es</code> ä¸ºå®¿ä¸»æœºçš„ç›®å½•åœ°å€ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name es -d -v /usr/local/es:/usr/share/elasticsearch/data -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.16.2</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå®¿ä¸»æœºçš„ç›®å½•éœ€è¦èµ‹æƒï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼šfailed to bind service AccessDeniedException</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod 777 /usr/local/es</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ <code>docker ps</code> æŸ¥çœ‹å®¹å™¨æ˜¯å¦æˆåŠŸè¿è¡Œã€‚åœ¨æ‰“å¼€æµè§ˆå™¨è®¿é—® <code>localhost:9200</code>ï¼Œå¦‚æœå±•ç°å¦‚ä¸‹ï¼Œåˆ™è¯´æ˜æœåŠ¡å¯åŠ¨æˆåŠŸã€‚</p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch-II/local_host.png" alt="local_host.png"></p><p>å¦‚æœéœ€è¦å¯è§†åŒ–ç®¡ç†ç•Œé¢ï¼Œå¯ä»¥é€šè¿‡ Chrome æµè§ˆå™¨å®‰è£…æ’ä»¶ ElasticSearch Head. </p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch-II/elasticsearch_head.png" alt="elasticsearch_head.png"></p><p>åˆ™æœ€ç»ˆçš„å±•ç¤ºä¸º</p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch-II/elasticsearch_head2.png" alt="elasticsearch_head2.png"></p><h3 id="ElasticSearch-æµ‹è¯•ç¯å¢ƒé…ç½®ä¿®æ”¹"><a href="#ElasticSearch-æµ‹è¯•ç¯å¢ƒé…ç½®ä¿®æ”¹" class="headerlink" title="ElasticSearch æµ‹è¯•ç¯å¢ƒé…ç½®ä¿®æ”¹"></a>ElasticSearch æµ‹è¯•ç¯å¢ƒé…ç½®ä¿®æ”¹</h3><p>é…ç½®æ–‡ä»¶çš„ä¿®æ”¹æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œå› ä¸ºåŸå§‹çš„é…ç½®æ–‡ä»¶å¯èƒ½åœ¨ç½‘ç»œæˆ–è€…èµ„æºç¯å¢ƒè¦æ±‚ä¸Šæ— æ³•æ»¡è¶³/overqualify äº†æµ‹è¯•ç¯å¢ƒçš„è¦æ±‚ã€‚</p><h4 id="ä¿®æ”¹-ES-é…ç½®æ–‡ä»¶"><a href="#ä¿®æ”¹-ES-é…ç½®æ–‡ä»¶" class="headerlink" title="ä¿®æ”¹ ES é…ç½®æ–‡ä»¶"></a>ä¿®æ”¹ ES é…ç½®æ–‡ä»¶</h4><p>è¿›å…¥å®¹å™¨åï¼Œéœ€è¦ä¿®æ”¹ es é…ç½®æ–‡ä»¶ï¼Œè®¾ç½®å®¿ä¸»æœºçš„ ip åœ°å€ä¸ºä»»æ„ç½‘ç»œå‡å¯è®¿é—®ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim config/elasticsearch.yml</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹å¦‚ä¸‹ host network ip address</span></span><br><span class="line">network.host: 0.0.0.0</span><br></pre></td></tr></table></figure><h4 id="ä¿®æ”¹å¯åŠ¨å‚æ•°"><a href="#ä¿®æ”¹å¯åŠ¨å‚æ•°" class="headerlink" title="ä¿®æ”¹å¯åŠ¨å‚æ•°"></a>ä¿®æ”¹å¯åŠ¨å‚æ•°</h4><p>å¦‚æœ Elasticsearch ä¸­çš„ network.host ä¸æ˜¯ localhost æˆ–è€… 127.0.0.1 çš„è¯ï¼Œè¯¥å®¹å™¨ç¯å¢ƒä¼šè¢«è®¤ä¸ºæ˜¯ç”Ÿäº§ç¯å¢ƒï¼Œè¿™ä¸ªç¯å¢ƒè¦æ±‚çš„ä¸€äº›å†…å­˜ç­‰æ¯”è¾ƒé«˜ï¼Œæµ‹è¯•ç¯å¢ƒä¸ä¸€å®šæ»¡è¶³ï¼Œå› æ­¤éœ€è¦ä¿®æ”¹ä¸€äº›é…ç½®ã€‚</p><p>ä¿®æ”¹ jvm å¯åŠ¨å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim config/jvm.options</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹å¦‚ä¸‹é…ç½®ï¼Œå°† heap å†…å­˜å¯åŠ¨å‚æ•°å’Œæœ€å¤§å‚æ•°ä» 4g ä¿®æ”¹æˆ 256m</span></span><br><span class="line">-Xms256m</span><br><span class="line">-Xmx256m</span><br></pre></td></tr></table></figure><p>è®¾ç½®ä¸€ä¸ªè¿›ç¨‹åœ¨ VMAs (Virtual Memory Areas) åˆ›å»ºå†…å­˜æ˜ å°„çš„æœ€å¤§æ•°é‡ã€‚è¿™ä¸ªæ“ä½œéœ€è¦ä½¿ç”¨ root ç”¨æˆ·å»æ“ä½œã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysctl.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> åŠ ä¸Šå¦‚ä¸‹é…ç½®</span></span><br><span class="line">vm.max_map_count=655360</span><br><span class="line"><span class="meta">#</span><span class="bash"> è®°å¾—éœ€è¦ç”¨ root æƒé™ç”Ÿæ•ˆè¯¥é…ç½®ã€‚ä¸è¿‡ä¹Ÿå¯èƒ½å› ä¸ºè™šæ‹Ÿæœºæ˜¯ OpenZV è€Œæ— æ³•ä¿®æ”¹</span></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure><p>ä»¥ root æƒé™ç™»å…¥å®¹å™¨ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it --user root f9c23e8de222 /bin/bash</span><br></pre></td></tr></table></figure><p>ä»»ä½•ç”¨æˆ·ç»„çš„æƒé™éƒ½å¯ä»¥è¿™æ ·åˆ‡æ¢ã€‚å¦‚æœå¿˜è®°äº†ç”¨æˆ·ç»„åï¼Œå¯ä»¥åœ¨å®¹å™¨ä¸­è¾“å…¥ <code>id</code>, å¯ä»¥ä» <code>groups</code> ä¸­çœ‹åˆ°ç»„å†…æ‰€æœ‰ç”¨æˆ·ã€‚</p><p>å¦‚æœæƒ³è¦ä½¿ç”¨ jpsã€jstack ç­‰ jvm ç›‘æ§å‘½ä»¤ï¼Œåˆ™å¯èƒ½éœ€è¦æ¢ä¸€ä¸ª JDK é•œåƒï¼Œå› ä¸º docker ä¸­ä½¿ç”¨çš„ JDK é•œåƒæ˜¯ç²¾ç®€ç‰ˆï¼Œæ²¡æœ‰è¿™äº›é¢å¤–çš„ JDK è¾…åŠ©å·¥å…·åŒ…</p><h3 id="Docker-Compose-ä½¿ç”¨"><a href="#Docker-Compose-ä½¿ç”¨" class="headerlink" title="Docker-Compose ä½¿ç”¨"></a>Docker-Compose ä½¿ç”¨</h3><p>é€šè¿‡ä¸Šé¢è¿™äº›æŒ‡ä»¤å»å¯ç”¨ docker ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œä¸»è¦æ˜¯åç»­éœ€è¦ä¿®æ”¹ä¸€äº›é…ç½®ï¼Œæ¯”å¦‚ mount æ–‡ä»¶ä¸å†…å­˜æ˜ å°„æœ€å¤§æ•°é‡ç­‰ï¼Œè¿™äº›éœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™å°±æ‰§è¡ŒæˆåŠŸï¼Œä¸”ç»™äºˆç›¸åº”çš„æƒé™ï¼Œå¦åˆ™è¿›å…¥å®¹å™¨åä¼šå› ä¸ºå®¹å™¨å†…æ–‡ä»¶çš„åªè¯»æ€§è´¨è€Œæ— æ³•æ›´æ–°ã€‚åŒæ ·çš„ï¼Œå¦‚æœå†™ä¸€æ¡å†—é•¿çš„æŒ‡ä»¤æ»¡è¶³ä¸Šè¿°è¦æ±‚çš„åŒæ—¶ï¼Œå´å¤±å»äº†å‘½ä»¤è¡Œçš„ç®€æ´ç›´è§‚ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæå‰åœ¨å®¿ä¸»æœºä¸Šè®¾ç½®å¥½é…ç½®æ–‡ä»¶ï¼Œåœ¨å¯åŠ¨å®¹å™¨æ—¶å°±é…ç½®å¥½å®¹å™¨å†…çš„ä¸€äº›å‚æ•°ï¼Œä¼šæ˜¯éå¸¸å¿…è¦çš„æ–¹æ³•ã€‚è€Œ Docker-Compose æ°å¥½å¯ä»¥æ‰¿æ‹…è¿™æ ·çš„ä»»åŠ¡ã€‚</p><p>å¯¹äºä¸‹è½½å’Œå®‰è£…äº† Docker Desktop æˆ–è€… Decker for Mac ç­‰çš„ Mac ç”¨æˆ·ï¼Œæˆ‘ä»¬å°±ä¸å¿…å†å•ç‹¬å®‰è£… docker-compose äº†ã€‚è€Œå¯¹äº Linux ç”¨æˆ·ï¼Œåˆ™éœ€è¦å¦‚ä¸‹æ“ä½œï¼š</p><h4 id="Linux-ä¸‹-Compose-çš„å®‰è£…"><a href="#Linux-ä¸‹-Compose-çš„å®‰è£…" class="headerlink" title="Linux ä¸‹ Compose çš„å®‰è£…"></a>Linux ä¸‹ Compose çš„å®‰è£…</h4><ol><li><p>ä¸‹è½½ Docker Compose ç¨³å®šç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/v2.2.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure></li><li><p>ç»™äºˆ binary å¯æ‰§è¡Œæƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure></li><li><p>æ„å»ºè½¯é“¾ï¼Œä¾›æ‰§è¡Œå‘½ä»¤è°ƒç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</span><br></pre></td></tr></table></figure></li><li><p>æµ‹è¯•æ˜¯å¦å®‰è£…æˆåŠŸ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure></li></ol><h4 id="é…ç½®å¯åŠ¨æ–‡ä»¶-docker-compose-yaml"><a href="#é…ç½®å¯åŠ¨æ–‡ä»¶-docker-compose-yaml" class="headerlink" title="é…ç½®å¯åŠ¨æ–‡ä»¶ docker-compose.yaml"></a>é…ç½®å¯åŠ¨æ–‡ä»¶ <code>docker-compose.yaml</code></h4><p>é€šè¿‡é…ç½®å¯åŠ¨æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€äº›å‚æ•°ä»å®¿ä¸»æœºç›´æ¥ä¼ åˆ°å®¹å™¨ã€‚</p><h5 id="å•-es-èŠ‚ç‚¹-kibana-é…ç½®"><a href="#å•-es-èŠ‚ç‚¹-kibana-é…ç½®" class="headerlink" title="å• es èŠ‚ç‚¹ + kibana é…ç½®"></a>å• es èŠ‚ç‚¹ + kibana é…ç½®</h5><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.8&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">elasticsearch:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.16.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.type=single-node</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">      <span class="comment"># - cluster.initial_master_nodes=elasticsearch</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./elasticsearch/data:/usr/share/elasticsearch/data</span></span><br><span class="line">  <span class="attr">kibana:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">kibana:7.16.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kibana_1</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elasticsearch</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5601</span><span class="string">:5601</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">es-data:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼šå•èŠ‚ç‚¹ <code>single-mode</code> æ¨¡å¼ä¸‹ï¼Œ<code>cluster.initial_master_nodes</code> æ˜¯ä¸è¢«å…è®¸è®¾ç½®çš„ã€‚</p><h5 id="å¤š-es-èŠ‚ç‚¹-kibana-é…ç½®"><a href="#å¤š-es-èŠ‚ç‚¹-kibana-é…ç½®" class="headerlink" title="å¤š es èŠ‚ç‚¹ + kibana é…ç½®"></a>å¤š es èŠ‚ç‚¹ + kibana é…ç½®</h5><p>è¿™é‡Œæˆ‘ä»¬ç”¨ä¸‰ä¸ªèŠ‚ç‚¹æ¥åšç®€å•é…ç½®ã€‚éœ€è¦æ ¹æ®èŠ‚ç‚¹æ•°é‡é…ç½® memory çš„å¤§å°ï¼Œåˆšå¼€å§‹æˆ‘åªè®¾ç½®äº† 1 G çš„å†…å­˜ï¼Œå› ä¸ºå¯åŠ¨æ—¶å°±éœ€è¦ 1.5 G å†…å­˜ï¼Œç»“æœå®¹å™¨ç›´æ¥å¯åŠ¨å¤±è´¥ï¼Œä¸”æ— ç›¸å…³æ—¥å¿—äº§å‡ºã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3.8&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">es01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.16.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es01</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es01</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es01/data:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">9200</span><span class="string">:9200</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">es02:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.16.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es02</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es01,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es02/data:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">es03:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">elasticsearch:7.16.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">es03</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">node.name=es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.name=es-docker-cluster</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">discovery.seed_hosts=es01,es02</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cluster.initial_master_nodes=es01,es02,es03</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bootstrap.memory_lock=true</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;ES_JAVA_OPTS=-Xms512m -Xmx512m&quot;</span></span><br><span class="line">    <span class="attr">ulimits:</span></span><br><span class="line">      <span class="attr">memlock:</span></span><br><span class="line">        <span class="attr">soft:</span> <span class="number">-1</span></span><br><span class="line">        <span class="attr">hard:</span> <span class="number">-1</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./es03/data:/usr/share/elasticsearch/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">kib01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">kibana:7.16.2</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">kib01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">5601</span><span class="string">:5601</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">ELASTICSEARCH_URL:</span> <span class="string">http://es01:9200</span></span><br><span class="line">      <span class="attr">ELASTICSEARCH_HOSTS:</span> <span class="string">&#x27;[&quot;http://es01:9200&quot;,&quot;http://es02:9200&quot;,&quot;http://es03:9200&quot;]&#x27;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">elastic</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">data01:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data02:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line">  <span class="attr">data03:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">local</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">elastic:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure><h4 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h4><p>åœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰ï¼Œè¿˜éœ€è¦æ ¹æ®é…ç½®æå‰è®¾ç½®åˆ° <code>volumes</code>ã€‚æ¯”å¦‚åœ¨å•èŠ‚ç‚¹æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬è¿›å…¥ä¸€ä¸ªç›®å½•ï¼Œå‡è®¾æ˜¯ <code>$Home</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦</p><ol><li><p>æå‰åˆ›å»ºå®¿ä¸»æœºä¸Šçš„æ˜ å°„ç›®å½• <code>mkdir -p elasticsearch/data</code></p></li><li><p>ç»™äºˆç›¸å…³ç›®å½• 777 æƒé™ <code>chmod -R 777 elasticsearch</code></p></li></ol><p>è®¾ç½®å¥½ä¹‹åï¼Œåœ¨<code>$Home</code> ç›®å½•ä¸‹æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><p>docker å°±ä¼šå»è®¿é—®<code>$Home</code>ç›®å½•ä¸‹ <code>docker-compose.yaml</code> ç­‰ç›¸å…³é…ç½®æ–‡ä»¶ã€‚æ ¹æ®é…ç½®æ–‡ä»¶å»ä»ç½‘ç»œæˆ–è€…æœ¬åœ°æ‹‰å–é•œåƒï¼Œæ–°å»ºå¹¶ä½¿ç”¨é•œåƒå¯åŠ¨æœåŠ¡ç­‰ã€‚è€Œä¸Šé¢çš„ <code>-d</code> æ˜¯ detach çš„æ„æ€ï¼Œä¹Ÿå°±æ˜¯ä¸ä»…å¦‚æ­¤å®¹å™¨ã€‚</p><p>å¯ä»¥é€šè¿‡ <code>docker ps -a</code> ç­‰æŒ‡ä»¤æŸ¥çœ‹å®¹å™¨çš„ç›¸å…³çŠ¶æ€ï¼Œæ¯”å¦‚æ˜¯å¦æ˜¯ <code>up</code> æ‹‰èµ·çš„çŠ¶æ€ï¼Œæˆ–è€…å› ä¸ºæŸä¸€äº›åŸå› <code>Exited</code>é€€å‡ºç­‰ã€‚æ‹‰èµ·ä¸€æ®µæ—¶é—´åï¼Œå¯ä»¥é€šè¿‡è®¿é—® <code>localhost:5601</code> æŸ¥çœ‹ kibana æœåŠ¡æ˜¯å¦æ­£å¸¸ã€‚</p><h4 id="å…³é—­å®¹å™¨ç­‰ç›¸å…³æ“ä½œ"><a href="#å…³é—­å®¹å™¨ç­‰ç›¸å…³æ“ä½œ" class="headerlink" title="å…³é—­å®¹å™¨ç­‰ç›¸å…³æ“ä½œ"></a>å…³é—­å®¹å™¨ç­‰ç›¸å…³æ“ä½œ</h4><p>åœæ­¢å½“å‰ç›®å½•ä¸‹ <code>docker-compose.yaml</code> æ–‡ä»¶å¯åŠ¨çš„ç›¸å…³å®¹å™¨ï¼Œä½¿ç”¨ <code>docker-compose stop</code> æˆ– <code>docker-compose kill</code> åœæ‰ dockerã€‚è¿™ä¸¤è€…çš„ä¸»è¦åŒºåˆ«æ˜¯ <code>stop</code> æ”¯æŒä¼˜é›…é€€å‡ºï¼Œä¹Ÿå°±æ˜¯ä¼šå…ˆæ¥å— SIGTERM è¯·æ±‚ï¼Œåšä¸€äº›é¢„å¤„ç†å·¥ä½œä¿å­˜çŠ¶æ€ï¼Œ10 s åå†æ‰§è¡Œ SIGKILL è¯·æ±‚ã€‚è€Œ <code>kill</code> åˆ™æ˜¯ç›´æ¥æ‰§è¡Œ SIGKILL è¯·æ±‚å¯¹åº”çš„æ“ä½œã€‚</p><p>è¦æŸ¥çœ‹å½“å‰<code>docker-compose.yaml</code> å¯ç”¨çš„å®¹å™¨çš„çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ <code>docker-compose ps</code></p><p>å…³é—­æœåŠ¡åçš„å®¹å™¨çš„å¯åŠ¨å¯ä½¿ç”¨ <code>docker-compose start</code> æŒ‡ä»¤ï¼Œè€Œå¦‚æœå› ä¸ºæ›´æ–°é…ç½®è¦é‡å¯æœåŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>docker-compose restart</code> æŒ‡ä»¤ã€‚</p><p>å¦‚æœæƒ³è¦çœ‹å½“å‰ docker è¿è¡Œæƒ…å†µï¼Œå¯ä»¥é€šè¿‡æŒ‡ä»¤<code>docker-compose top</code> å®Œæˆ</p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://juejin.cn/post/6844904202204872711">Dockeréƒ¨ç½²ElasticSearchåŠä½¿ç”¨</a></p><p><a href="https://www.i4k.xyz/article/Dooonald/87931435">ElasticSearch 6.x å¢åˆ æ”¹æŸ¥æ“ä½œæ±‡æ€» åŠ pythonè°ƒç”¨ESä¸­æ–‡æ£€ç´¢å®ä¾‹_ç§äººå¤©åœ°-ç¨‹åºå‘˜ä¿¡æ¯ç½‘</a></p><p><a href="https://stackoverflow.com/questions/65295961/elasticsearch-server-with-docker-compose-java-nio-file-accessdeniedexception">ElasticSearch Server with Docker Compose: java.nio.file.AccessDeniedException: /usr/share/elasticsearch/data/nodes</a></p><p><a href="https://zysite.top/archives/elasticsearch-docker-compose-install">docker-composeéƒ¨ç½²ElasticSearché›†ç¾¤ | January</a></p><p><a href="https://blog.csdn.net/u011790603/article/details/105227925">elasticsearch:7.4.2 çš„docker composeæ–‡ä»¶</a></p>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
            <tag> Apache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker Intro (I)</title>
      <link href="/2022/01/29/Docker-Intro-I/"/>
      <url>/2022/01/29/Docker-Intro-I/</url>
      
        <content type="html"><![CDATA[<p>Docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨å¼•æ“ï¼Œè®©å¼€å‘è€…å¯ä»¥æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°å¯ç§»æ¤çš„é•œåƒä¸­ã€‚è¿™æ ·çš„é•œåƒå¯ä»¥è¢«åœ¨ä»»æ„çš„ Linux æˆ– Windows ç­‰åŒ…å«ç‰¹å®šè¾“å…¥è¾“å‡ºè§„åˆ™çš„æœºå™¨ä¸Šã€‚å®ƒå®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’ä¹‹é—´æ— ä»»ä½•æ¥å£ã€‚</p><h3 id="Docker-å®‰è£…"><a href="#Docker-å®‰è£…" class="headerlink" title="Docker å®‰è£…"></a>Docker å®‰è£…</h3><h4 id="å‘½ä»¤è¡Œ-Homebrew-å®‰è£…"><a href="#å‘½ä»¤è¡Œ-Homebrew-å®‰è£…" class="headerlink" title="å‘½ä»¤è¡Œ Homebrew å®‰è£…"></a>å‘½ä»¤è¡Œ Homebrew å®‰è£…</h4><p>é€šè¿‡ homebrew ä¸‹è½½å¹¶å®‰è£…åˆ°åº”ç”¨ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install --cask --appdir=/Applications docker</span><br></pre></td></tr></table></figure><h4 id="Docker-Desktop-for-Mac-å®‰è£…åŒ…å®‰è£…"><a href="#Docker-Desktop-for-Mac-å®‰è£…åŒ…å®‰è£…" class="headerlink" title="Docker Desktop for Mac å®‰è£…åŒ…å®‰è£…"></a>Docker Desktop for Mac å®‰è£…åŒ…å®‰è£…</h4><p>Docker Desktop for Mac æ˜¯ Docker çš„ä¸€ç§æ¡Œé¢ç®¡ç† IDEï¼Œç”¨äºåœ¨ Mac ä¸Šæ„å»ºï¼Œè°ƒè¯•å’Œæµ‹è¯• Dockerized åº”ç”¨ç¨‹åºã€‚å®ƒæ˜¯ä¸€ä¸ªå®Œæ•´çš„å¼€å‘ç¯å¢ƒï¼Œä¸ Mac OS Hypervisor æ¡†æ¶ï¼Œç½‘ç»œä¸æ–‡ä»¶ç³»ç»Ÿæ·±åº¦ç»§æ‰¿ï¼Œæ˜¯åœ¨ Mac ä¸Šè¿è¡Œ Docker çš„æœ€å¿«ï¼Œæœ€å¯é çš„æ–¹æ³•ã€‚</p><p>åœ¨Dockerå®˜æ–¹ç½‘ç«™ä¸‹è½½å®‰è£…æ–‡ä»¶ï¼š<a href="https://link.zhihu.com/?target=https%3A//yq.aliyun.com/go/articleRenderRedirect%3Furl%3Dhttps%253A%252F%252Fhub.docker.com%252Feditions%252Fcommunity%252Fdocker-ce-desktop-mac">https://hub.docker.com/editions/community/docker-ce-desktop-mac</a><br>ä¸‹è½½ Docker.dmgå®‰è£…æ–‡ä»¶ï¼Œç›´æ¥åŒå‡»å®‰è£…å®Œæˆå°±å¯ä»¥äº†ã€‚</p><h3 id="Docker-æ›´æ–°é•œåƒæº"><a href="#Docker-æ›´æ–°é•œåƒæº" class="headerlink" title="Docker æ›´æ–°é•œåƒæº"></a>Docker æ›´æ–°é•œåƒæº</h3><p>è¿è¡Œé•œåƒæ‹‰å–æ—¶ï¼Œå¯èƒ½å› ä¸ºç½‘ç»œåŸå› å‡ºç°ä¸‹é¢ ERROR </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ERROR: Get https://registry-1.docker.io/v2/: net/http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†è§£å†³è¿™ä¸ªåŸå› ï¼Œæˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æŒ‡å®šé•œåƒæºï¼Œåœ¨ Mac OS ç³»ç»Ÿä¸­ï¼Œæ›´æ–°é•œåƒæºçš„æ–‡ä»¶ä¸º </p><p><code>~/.docker/daemon.json</code> æ–‡ä»¶ï¼Œåªç”¨åŠ å…¥ ä»¥ä¸‹ json é…ç½®å³å¯æ›´æ¢é•œåƒæº</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;registry-mirrors&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;https://registry.docker-cn.com&quot;</span>ï¼Œ <span class="comment">// ä¸­å›½åŒºå®˜æ–¹é•œåƒ</span></span><br><span class="line">        <span class="string">&quot;http://hub-mirror.c.163.com&quot;</span>,  <span class="comment">// ç½‘æ˜“é•œåƒ</span></span><br><span class="line">        <span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>  <span class="comment">// ä¸­ç§‘å¤§é•œåƒ</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœé€šè¿‡ Homebrew å®‰è£…çš„ Dockerï¼Œå¯ä»¥å°è¯•ç‚¹å‡»å³ä¸Šè§’çš„ğŸ³å›¾æ ‡ &gt; Preference &gt;  Docker Engine å»ç›´æ¥ä¿®æ”¹é‚£ä¸ª configuration æ–‡ä»¶</p><h3 id="Docker-å®¹å™¨å†…å®‰è£…-vim"><a href="#Docker-å®¹å™¨å†…å®‰è£…-vim" class="headerlink" title="Docker å®¹å™¨å†…å®‰è£… vim"></a>Docker å®¹å™¨å†…å®‰è£… vim</h3><p>æˆ‘ä»¬ç™»å…¥ docker çš„å®¹å™¨ï¼Œå‘ç°æ²¡åŠæ³•ä½¿ç”¨ vim ç­‰å‘½ä»¤å»ä¿®æ”¹ config æ–‡ä»¶æˆ–è€…ç¼–è¾‘å…¶ä»–æ–‡ä»¶ï¼Œä¼šæç¤ºï¼š<code>vim: command not found</code></p><p>ä¸ºäº† solve è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥è¿›å…¥å®¹å™¨å¹¶å®‰è£… vim å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get install vim</span><br></pre></td></tr></table></figure><p>ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæœ€å¥½ä¸è¦å† docker å®¹å™¨ä¸­ä¿®æ”¹æ–‡ä»¶ï¼Œè€Œæ˜¯å°†ç»å¸¸ä¿®æ”¹çš„æ–‡ä»¶æŒ‚è½½åˆ°å®¿ä¸»æœºä¸Šï¼Œè¿™æ ·é¿å…é‡å¯æ—¶æ— æ³•å›å¤ä¿®æ”¹ã€‚</p><h3 id="Docker-æŒ‚è½½æœ¬åœ°ç›®å½•"><a href="#Docker-æŒ‚è½½æœ¬åœ°ç›®å½•" class="headerlink" title="Docker æŒ‚è½½æœ¬åœ°ç›®å½•"></a>Docker æŒ‚è½½æœ¬åœ°ç›®å½•</h3><p>Docker æ”¯æŒæŠŠä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„ç›®å½•æŒ‚è½½åˆ°é•œåƒé‡Œï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸éœ€è¦é€šè¿‡ä¿®æ”¹é•œåƒå†…çš„æ–‡ä»¶å»ä¿®æ”¹é…ç½®äº†ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -v /usr/local/es:/usr/share/elasticsearch/data -e &quot;discovery.type=single-node&quot; -p 9200:9200 -p 9300:9300 --name es elasticsearch</span><br></pre></td></tr></table></figure><h3 id="Docker-ç›¸å…³é—®é¢˜ä¸è§£å†³"><a href="#Docker-ç›¸å…³é—®é¢˜ä¸è§£å†³" class="headerlink" title="Docker ç›¸å…³é—®é¢˜ä¸è§£å†³"></a>Docker ç›¸å…³é—®é¢˜ä¸è§£å†³</h3><h4 id="Docker-æ— æ³•é€šè¿‡æŒ‡ä»¤åœæ­¢"><a href="#Docker-æ— æ³•é€šè¿‡æŒ‡ä»¤åœæ­¢" class="headerlink" title="Docker æ— æ³•é€šè¿‡æŒ‡ä»¤åœæ­¢"></a>Docker æ— æ³•é€šè¿‡æŒ‡ä»¤åœæ­¢</h4><p>ä»Šå¤©å‡ºç°äº†ä¸€ä¸ªæ— æ³•é€šè¿‡ stop ä¸ kill ç­‰ç›¸å…³çš„æŒ‡ä»¤åœæ­¢æˆ–ç»ˆæ­¢å®¹å™¨çš„é—®é¢˜ã€‚</p><p>é¦–å…ˆæ˜¯åœ¨å·²ç»æœ‰ä¸€ä¸ªå®¹å™¨æ­£å¸¸è¿è¡Œçš„åŸºç¡€ä¸Šï¼Œé‡æ–° <code>docker-compose up -d</code> äº†ä¸€ä¸ªæ–°å®¹å™¨ï¼Œè°ƒç”¨äº†åŒä¸€ä¸ªç«¯å£ä½œä¸ºæ˜ å°„ï¼Œå¯¼è‡´é”™è¯¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line">-----------------------------</span><br><span class="line">Creating network &quot;elasticsearch_default&quot; with the default driver</span><br><span class="line">Creating volume &quot;elasticsearch_es-data&quot; with local driver</span><br><span class="line">Creating elasticsearch_01 ...</span><br><span class="line"></span><br><span class="line">ERROR: for elasticsearch_01  UnixHTTPConnectionPool(host=&#x27;localhost&#x27;, port=None): Read timed out. (read timeout=60)</span><br><span class="line"></span><br><span class="line">ERROR: for elasticsearch_01  UnixHTTPConnectionPool(host=&#x27;localhost&#x27;, port=None): Read timed out. (read timeout=60)</span><br><span class="line">ERROR: An HTTP request took too long to complete. Retry with --verbose to obtain debug information.</span><br><span class="line">If you encounter this issue regularly because of slow network conditions, consider setting COMPOSE_HTTP_TIMEOUT to a higher value (current value: 60).</span><br></pre></td></tr></table></figure><p>è¿™æ—¶å€™é€šè¿‡ <code>docker ps -a</code> å¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨ STATUS æ˜¯ CREATEDï¼Œä½†æ˜¯æ²¡åŠæ³•å¯åŠ¨ï¼Œå› ä¸ºæ¥å£ä¸å¯¹ã€‚æ‰€ä»¥æƒ³è¦åœæ­¢ä¹‹å‰çš„å®¹å™¨ï¼Œç„¶åå†å¯åŠ¨æ–°å®¹å™¨çš„æœåŠ¡ã€‚è¿™æ—¶å€™å‘ç°æ–°å®¹å™¨åœä¸ä¸‹æ¥äº†ï¼Œçœ‹å®¹å™¨å†…æœåŠ¡ä¿¡æ¯<code>docker logs container-id</code>ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;type&quot;: &quot;server&quot;, &quot;timestamp&quot;: &quot;2022-01-31T07:15:51,250Z&quot;, &quot;level&quot;: &quot;ERROR&quot;, &quot;component&quot;: &quot;i.n.u.c.D.rejectedExecution&quot;, &quot;cluster.name&quot;: &quot;docker-cluster&quot;, &quot;node.name&quot;: &quot;8d619a059150&quot;, &quot;message&quot;: &quot;Failed to submit a listener notification task. Event loop shut down?&quot;, &quot;cluster.uuid&quot;: &quot;S33uPEbYT4iKRFfqRiul-Q&quot;, &quot;node.id&quot;: &quot;To5wb_cQRg-BheySS5Nliw&quot; ,</span><br><span class="line">&quot;stacktrace&quot;: [&quot;java.util.concurrent.RejectedExecutionException: event executor terminated&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.SingleThreadEventExecutor.reject(SingleThreadEventExecutor.java:923) ~[netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.SingleThreadEventExecutor.offerTask(SingleThreadEventExecutor.java:350) ~[netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.SingleThreadEventExecutor.addTask(SingleThreadEventExecutor.java:343) ~[netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.SingleThreadEventExecutor.execute(SingleThreadEventExecutor.java:825) ~[netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.SingleThreadEventExecutor.execute(SingleThreadEventExecutor.java:815) ~[netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.DefaultPromise.safeExecute(DefaultPromise.java:842) [netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:499) [netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:616) [netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:609) [netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.util.concurrent.DefaultPromise.setFailure(DefaultPromise.java:109) [netty-common-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.channel.DefaultChannelPromise.setFailure(DefaultChannelPromise.java:89) [netty-transport-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.channel.AbstractChannelHandlerContext.safeExecute(AbstractChannelHandlerContext.java:998) [netty-transport-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.channel.AbstractChannelHandlerContext.write(AbstractChannelHandlerContext.java:796) [netty-transport-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.channel.AbstractChannelHandlerContext.writeAndFlush(AbstractChannelHandlerContext.java:758) [netty-transport-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.channel.DefaultChannelPipeline.writeAndFlush(DefaultChannelPipeline.java:1020) [netty-transport-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at io.netty.channel.AbstractChannel.writeAndFlush(AbstractChannel.java:311) [netty-transport-4.1.66.Final.jar:4.1.66.Final]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.http.netty4.Netty4HttpChannel.sendResponse(Netty4HttpChannel.java:34) [transport-netty4-client-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.http.DefaultRestChannel.sendResponse(DefaultRestChannel.java:134) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.rest.RestController$ResourceHandlingHttpChannel.sendResponse(RestController.java:588) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.rest.action.RestActionListener.onFailure(RestActionListener.java:55) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.rest.action.RestActionListener.onResponse(RestActionListener.java:40) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:88) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.action.support.TransportAction$1.onResponse(TransportAction.java:82) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.action.ActionListener.completeWith(ActionListener.java:447) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.action.support.nodes.TransportNodesAction.newResponseAsync(TransportNodesAction.java:181) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.action.support.nodes.TransportNodesAction.newResponse(TransportNodesAction.java:156) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.action.support.nodes.TransportNodesAction$AsyncAction.lambda$finishHim$0(TransportNodesAction.java:295) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingRunnable.run(ThreadContext.java:718) [elasticsearch-7.16.2.jar:7.16.2]&quot;,</span><br><span class="line">&quot;at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) [?:?]&quot;,</span><br><span class="line">&quot;at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) [?:?]&quot;,</span><br><span class="line">&quot;at java.lang.Thread.run(Thread.java:833) [?:?]&quot;] &#125;</span><br></pre></td></tr></table></figure><p>å‡ºç°é—®é¢˜çš„æœ€ä¸»è¦åŸå› å¯èƒ½æ˜¯ï¼Œæ–°åˆ›å»ºçš„å®¹å™¨çš„æŸä¸€ä¸ªé…ç½®æŠ¢å äº†æ—§å®¹å™¨çš„ç«¯å£ï¼Œä¹Ÿé˜»æ­¢äº†æ—§å®¹å™¨é‡æ–°ç”Ÿæˆæ—§åç§°çš„æ–°å®¹å™¨ï¼Œå› ä¸ºç³»ç»Ÿè®¤ä¸ºæ—§å®¹å™¨ä¾ç„¶å­˜åœ¨ã€‚</p><p>é¦–å…ˆæˆ‘æ‰¾åˆ°æ–°åˆ›å»ºçš„å¼‚å¸¸å®¹å™¨ï¼Œä½¿ç”¨ <code>docker rm container-id</code>åˆ é™¤æ‰äº†ï¼Œä½†æ˜¯ä¾ç„¶ stop æ—§å®¹å™¨ï¼ŒæŠ¥é”™æ˜¯ <code>Cannot kill container: : tried to kill container, but did not receive an exit event</code>ã€‚</p><p>æœ€åæ²¡æœ‰åŠæ³•ï¼Œç›´æ¥é‡å¯äº† docker desktopï¼Œå°±çœ‹åˆ°æ—§å®¹å™¨å·²ç» dead äº†ï¼Œç„¶ååˆ é™¤å®¹å™¨å³å¯ã€‚</p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://zhuanlan.zhihu.com/p/22382728">ä¸€ç¯‡ä¸ä¸€æ ·çš„dockeråŸç†è§£æ</a></p><p><a href="https://zhuanlan.zhihu.com/p/22403015">ä¸€ç¯‡ä¸ä¸€æ ·çš„dockeråŸç†è§£æ æé«˜ç¯‡</a></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ElasticSearch (I)</title>
      <link href="/2022/01/29/ElasticSearch-I/"/>
      <url>/2022/01/29/ElasticSearch-I/</url>
      
        <content type="html"><![CDATA[<h2 id="ELK-Intro"><a href="#ELK-Intro" class="headerlink" title="ELK Intro"></a>ELK Intro</h2><p>ELK å®é™…ä¸Šæ˜¯ä¸‰æ¬¾è½¯ä»¶çš„ç®€ç§°ï¼Œåˆ†åˆ«æ˜¯ Elasticsearchã€Logstashã€Kibana ç»„æˆï¼Œåœ¨å‘å±•è¿‡ç¨‹ä¸­ï¼Œåˆæœ‰æ–°æˆå‘˜ Beats çš„åŠ å…¥ï¼Œæ‰€ä»¥å°±å½¢æˆäº† Elastic Stackã€‚</p><p>ELK ä¸»è¦æ˜¯ç”¨äºåšæ—¥å¿—åˆ†æçš„è½¯ä»¶ã€‚å…¶ä¸­ï¼ŒElasticsearch ä¸»è¦æ˜¯æ ¸å¿ƒå­˜å‚¨å’Œæ£€ç´¢å¼•æ“ï¼Œè€Œ Kibana åˆ™æ˜¯ç”¨äºå°† Elasticsearch çš„æ•°æ®å¯è§†åŒ–åŒ–ï¼Œlogstash æ˜¯ä¸€ä¸ªé«˜ååé‡æ•°æ®å¤„ç†å¼•æ“ï¼Œå…¶å°†äº‹ä»¶æ—¥å¿—ç­‰é€šè¿‡ Parse å’Œ Transform çš„æ–¹å¼å¤„ç†åä¼ ç»™ Elasticsearchã€‚è€Œ Beats åˆ™ç”¨äºé‡‡é›†ä¸€åˆ‡æ•°æ®ï¼Œå†å°†è¿™äº›æ•°æ®åˆ›ç»™ LogStash æˆ–ç›´æ¥ä¼ ç»™ Elasticsearchã€‚æ•´ä¸ªæµç¨‹æ¡†å›¾å¯ç®€åŒ–ä¸ºï¼š</p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch/elastic_stack_workflow.png" alt="elastic_stack_workflow.png"></p><p>ä¸Šé¢åˆæ­¥è®²è§£äº†å››ä¸ªè½¯ä»¶ä¹‹é—´æ˜¯å¦‚ä½•åè°ƒåˆä½œçš„ï¼Œä¸‹é¢å…ˆç®€å•å®šä¹‰ä¸€ä¸‹è¿™å››ä¸ªè½¯ä»¶ï¼š</p><ul><li><p><strong>Elasticsearch</strong>: åŸºäº javaï¼Œæ˜¯ä¸€ä¸ªå¼€æºåˆ†å¸ƒå¼æœç´¢å¼•æ“ï¼Œå…¶ç‰¹ç‚¹æ˜¯ï¼šåˆ†å¸ƒå¼ã€é›¶é…ç½®ã€è‡ªåŠ¨å‘ç°ã€ç´¢å¼•è‡ªåŠ¨åˆ†ç‰‡ã€ç´¢å¼•å‰¯æœ¬æœºåˆ¶ã€restful é£æ ¼æ¥å£ï¼Œå¤šæ•°æ®æºã€è‡ªåŠ¨æœç´¢è´Ÿè½½ç­‰ã€‚</p></li><li><p><strong>Logstash</strong>ï¼šåŸºäº Javaï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ç”¨äºæ”¶é›†ã€åˆ†æå’Œå­˜å‚¨æ—¥å¿—çš„å·¥å…·</p></li><li><p><strong>Kibana</strong>ï¼šåŸºäº nodejsï¼Œå¯ä»¥ä¸º Logstash å’Œ Elasticsearch æä¾›æ—¥å¿—åˆ†æå‹å¥½çš„ Web ç•Œé¢ï¼Œå¯ä»¥æ±‡æ€»ã€åˆ†æå’Œæœç´¢é‡è¦æ•°æ®æ—¥å¿—</p></li><li><p><strong>Beats</strong>ï¼šelastic å…¬å¸å¼€æºçš„é‡‡é›†ç³»ç»Ÿç›‘æ§æ•°æ®çš„ä»£ç† agentï¼Œæ˜¯è¢«ç›‘æ§æœåŠ¡å™¨ä¸Šä»¥å®¢æˆ·ç«¯å½¢å¼è¿è¡Œçš„æ•°æ®æ”¶é›†å™¨çš„æ€»ç§°ã€‚ç”±å¦‚ä¸‹ç»„æˆï¼š</p><ul><li><p>Packetbeat: ç½‘ç»œæ•°æ®åŒ…åˆ†æå™¨ï¼Œç”¨äºç›‘æ§ã€æ”¶é›†ç½‘ç»œæµé‡ä¿¡æ¯ã€‚æ”¯æŒ ICMP(v4 and v6)ã€DNSã€HTTPã€MySQLã€PostgreSQLã€Redisã€MongoDB ç­‰åè®®</p></li><li><p>Filebeatï¼šç”¨äºç›‘æ§ã€æ”¶é›†æœåŠ¡å™¨æ—¥å¿—æ–‡ä»¶ï¼Œå–ä»£ logstash forwarder</p></li><li><p>Metricbeatï¼šå®šæœŸè·å–å¤–éƒ¨ç³»ç»Ÿçš„ç›‘æ§æŒ‡æ ‡ä¿¡æ¯ï¼Œå¯ä»¥ç›‘æ§ã€æ”¶é›† Apacheã€HAproxyã€MongoDBã€MySQLã€Nginxã€PostgreSQLã€Redisã€Zookeeper ç­‰æœåŠ¡</p></li><li><p>Winlogbeatï¼š ç›‘æ§æ”¶é›† Windows ç³»ç»Ÿçš„æ—¥å¿—ä¿¡æ¯</p></li></ul></li></ul><h2 id="Introduction-to-ElasticSearch"><a href="#Introduction-to-ElasticSearch" class="headerlink" title="Introduction to ElasticSearch"></a>Introduction to ElasticSearch</h2><p>ElasticSearch æ˜¯ä¸€ç§å¼€æºçš„å®æ—¶æœç´¢å¼•æ“ï¼Œå…¶æ˜¯åŸºäº Apache Lucene(TM) å¼€å‘çš„ã€‚è¢«è®¤ä¸ºæ˜¯ç›®å‰æœ€å…ˆè¿›ã€åŠŸèƒ½æœ€é½å…¨çš„æœç´¢å¼•æ“åº“ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Lucene åªæ˜¯ä¸€ä¸ªåº“ï¼Œéœ€è¦ä½¿ç”¨ Java å¹¶å°†å…¶é›†æˆåˆ°åº”ç”¨ä¸­ã€‚è¦æƒ³æ˜ç™½å…¶å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å……åˆ†çš„äº†è§£æ£€ç´¢ç›¸å…³çš„çŸ¥è¯†æ‰è¡Œã€‚</p><p>è€Œ Elasticsearch ä¾¿æ˜¯ä¸€ä¸ªä½¿ç”¨ Java ç¼–å†™çš„ä½¿ç”¨ Lucene å»ºç«‹ç´¢å¼•å¹¶å®ç°æœç´¢åŠŸèƒ½çš„ä¸€ç§å¼•æ“ã€‚å®ƒéšè—äº† Lucene çš„å¤æ‚æ€§ï¼Œè€Œæ˜¯è®©ç¨‹åºå‘˜èƒ½ç®€å•å¾—é€šè¿‡ RESTful API åŒ…è£…è°ƒç”¨ã€‚</p><p> é™¤ Lucene å’Œå…¨æ–‡æœç´¢å¼•æ“å¤–ï¼ŒES è¿˜æä¾›äº†ï¼š</p><ul><li><p>åˆ†å¸ƒå¼çš„å®æ—¶æ–‡ä»¶å­˜å‚¨ï¼Œæ¯ä¸ªå­—æ®µéƒ½è¢«ç´¢å¼•å¹¶å¯è¢«æœç´¢ã€‚</p></li><li><p>å®æ—¶åˆ†æçš„åˆ†å¸ƒå¼æœç´¢å¼•æ“</p></li><li><p>å¯æ‰©å±•æ€§ï¼Œå¯æ‰©å±•è‡³ä¸Šç™¾å°æœåŠ¡å™¨ï¼Œå¤„ç† PB çº§çš„ç»“æ„åŒ–æˆ–éç»“æ„åŒ–æ•°æ®</p></li></ul><p>è€Œæ‰€æœ‰çš„è¿™äº›åŠŸèƒ½ï¼Œéƒ½è¢«é›†ä¸­åˆ°ä¸€å°æœåŠ¡å™¨ï¼Œé€šè¿‡ RESTful API ä»¥åŠå„ç§è¯­è¨€çš„ client stub è½»æ¾è¿›è¡Œäº¤äº’ã€‚å®ƒçš„å¦ä¸€ä¸ªç‰¹ç‚¹å°±æ˜¯ææ˜“ä¸Šæ‰‹ï¼Œéšè—äº†å¤æ‚çš„æœç´¢å¼•æ“ç†è®ºã€‚</p><h3 id="ES-æ ¸å¿ƒæ¦‚å¿µ"><a href="#ES-æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="ES æ ¸å¿ƒæ¦‚å¿µ"></a>ES æ ¸å¿ƒæ¦‚å¿µ</h3><h4 id="Near-Real-Time-è¿‘å®æ—¶-NRT"><a href="#Near-Real-Time-è¿‘å®æ—¶-NRT" class="headerlink" title="Near Real-Time è¿‘å®æ—¶ NRT"></a>Near Real-Time è¿‘å®æ—¶ NRT</h4><p>æœç´¢å¹³å°è¿‘å®æ—¶æ„å‘³ç€æˆ‘ä»¬ä»å¯¹æ–‡æ¡£æ„å»ºç´¢å¼•åˆ°æ–‡æ¡£èƒ½è¢«æœç´¢åˆ°ä¹‹é—´çš„æ—¶å»¶å¾ˆçŸ­ï¼Œé€šå¸¸æ˜¯ç§’çº§çš„ã€‚</p><h4 id="Node-èŠ‚ç‚¹"><a href="#Node-èŠ‚ç‚¹" class="headerlink" title="Node èŠ‚ç‚¹"></a>Node èŠ‚ç‚¹</h4><p>ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥ç†è§£æˆ Elasticsearch ä¸­çš„ä¸€ä¸ªæœåŠ¡å™¨ï¼Œæ˜¯æ•´ä¸ª ES é›†ç¾¤ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå­˜å‚¨æ•°æ®ï¼Œå¹¶å‚ä¸é›†ç¾¤çš„ç´¢å¼•ä¸æœç´¢ã€‚ä¸€ä¸ªèŠ‚ç‚¹éœ€è¦ä¸€ä¸ªåå­—ä½œä¸ºæ ‡è¯†ï¼Œè¿™ä¸ªåå­—ä¼šæ˜¯éšæœºæ¼«å¨è§’è‰²çš„åå­—ï¼Œåœ¨å¯åŠ¨çš„æ—¶å€™èµ‹äºˆã€‚è¿™ä¸ªåå­—éœ€è¦é¢å¤–å…³æ³¨ï¼Œå› ä¸ºæˆ‘ä»¬ä¼šéœ€è¦ç¡®å®šç½‘ç»œä¸­çš„æœåŠ¡å™¨å¯¹åº”çš„èŠ‚ç‚¹ã€‚</p><p>é€šè¿‡é…ç½®é›†ç¾¤åï¼Œä¸€ä¸ªèŠ‚ç‚¹è¢«åŠ å…¥æŒ‡å®šé›†ç¾¤(default æƒ…å†µä¸‹æ˜¯åä¸º elasticsearch çš„é›†ç¾¤)ã€‚ä¸€ä¸ªé›†ç¾¤å¯ä»¥æ‹¥æœ‰æ— æŒ‡å®šä¸Šé™ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœå½“å‰ç½‘ç»œä¸­æ²¡æœ‰ä»»ä½• Elasticsearch èŠ‚ç‚¹ï¼Œè¿™æ—¶å¯åŠ¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¼šé»˜è®¤åˆ›å»ºå¹¶åŠ å…¥ä¸€ä¸ªå«åš elasticsearch çš„é›†ç¾¤ã€‚</p><h4 id="Cluster-é›†ç¾¤"><a href="#Cluster-é›†ç¾¤" class="headerlink" title="Cluster é›†ç¾¤"></a>Cluster é›†ç¾¤</h4><p>ä¸€ä¸ªé›†ç¾¤å°±æ˜¯æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªèŠ‚ç‚¹ç»„æˆçš„ï¼Œå…±åŒæä¾›æ•´ä¸ªæ•°æ®ï¼Œå¹¶ä¸€èµ·æä¾›ç´¢å¼•å’Œæœç´¢åŠŸèƒ½çš„æŠ½è±¡ã€‚ä¸€ä¸ªé›†ç¾¤ä¼šæœ‰å”¯ä¸€çš„åå­—æ ‡è¯†ï¼Œé»˜è®¤ä¸º elasticsearchã€‚</p><p>Note: é›†ç¾¤åå¾ˆé‡è¦ï¼ŒèŠ‚ç‚¹éœ€è¦åˆ¶å®šé›†ç¾¤åï¼Œæ‰èƒ½åŠ å…¥è¯¥é›†ç¾¤ã€‚æ‰€ä»¥æ‰äº§å“ç¯å¢ƒä¸­ï¼Œé€šå¸¸éœ€è¦æ˜¾å¼è®¾å®šè¯¥é›†ç¾¤å</p><h4 id="Index-ç´¢å¼•"><a href="#Index-ç´¢å¼•" class="headerlink" title="Index ç´¢å¼•"></a>Index ç´¢å¼•</h4><p>ä¸€ä¸ªç´¢å¼•å¯ä»¥è®¤ä¸ºæ˜¯æ ¹æ®æŸä¸€äº›ç‰¹å¾å°†ç›¸ä¼¼æ–‡æ¡£åˆ†åˆ°ä¸€èµ·åçš„é›†åˆã€‚å¯ä»¥ç±»æ¯”å…³ç³»å‹æ•°æ®åº“ Databaseã€‚æ¯”å¦‚ï¼Œäº§å“ç±»ç›®çš„ç´¢å¼•ï¼Œè®¢å•æ•°æ®çš„ç´¢å¼•ã€‚ä¸€ä¸ªç´¢å¼•éœ€è¦ä¸€ä¸ªåå­—(å°å†™å­—æ¯) æ¥è¡¨ç¤ºã€‚å½“æˆ‘ä»¬è¦å¯¹ç´¢å¼•ä¸­æ–‡æ¡£è¿›è¡Œç´¢å¼•ã€æœç´¢ã€æ›´æ–°å’Œåˆ é™¤æ—¶ï¼Œéƒ½éœ€è¦è¿™ä¸ªåå­—ã€‚</p><h4 id="Type-ç±»å‹"><a href="#Type-ç±»å‹" class="headerlink" title="Type ç±»å‹"></a>Type ç±»å‹</h4><p>ç±»å‹ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­ Table çš„æ¦‚å¿µã€‚åœ¨ä¸€ä¸ªç´¢å¼•ä¸­ï¼Œå¯ä»¥å®šä¹‰ä¸€ç§æˆ–å¤šç§ç±»å‹ã€‚ä¸€ä¸ªç±»å‹å¯ä»¥ç†è§£ä¸ºç´¢å¼•ä¸­çš„é€»è¾‘åˆ†ç±»/åˆ†åŒºã€‚é€šå¸¸ä¼šä¸ºå…·æœ‰ä¸€ç»„å…±åŒå­—æ®µçš„æ–‡æ¡£å®šä¹‰ä¸€ä¸ªç±»å‹ã€‚</p><h4 id="Document-æ–‡æ¡£"><a href="#Document-æ–‡æ¡£" class="headerlink" title="Document æ–‡æ¡£"></a>Document æ–‡æ¡£</h4><p>æ–‡æ¡£æ˜¯å¯è¢«ç´¢å¼•çš„åŸºç¡€ä¿¡æ¯å•å…ƒã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå®¢æˆ·çš„æ–‡æ¡£ï¼Œä¸€ä¸ªå•†å“çš„æ‰€æœ‰ä¿¡æ¯ã€‚æ–‡æ¡£ä»¥ JSON (JavaScript Object Notation) æ ¼å¼è¡¨ç¤ºã€‚</p><p>åœ¨ä¸€ä¸ª index / type é‡Œï¼Œæˆ‘ä»¬å¯ä»¥å­˜å‚¨ä»»æ„å¤šçš„æ–‡æ¡£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ–‡æ¡£è™½ç„¶ç‰©ç†ä¸Šæ˜¯å­˜åœ¨äºç´¢å¼•ä¹‹ä¸­ï¼Œä½†æ–‡æ¡£å¿…é¡»ç´¢å¼•ã€èµ‹äºˆä¸€ä¸ªç´¢å¼•çš„ typeã€‚ç±»ä¼¼äºå…³ç³»å‹æ•°æ®åº“ä¸­ Record çš„æ¦‚å¿µã€‚é™¤äº†ç”¨æˆ·å®šä¹‰çš„æ•°æ®å¤–ï¼Œæ–‡æ¡£è¿˜éœ€è¦åŒ…æ‹¬ <code>_index</code>ï¼Œ<code>_type</code> ä¸ <code>_id</code> å­—æ®µ</p><h4 id="Shard-amp-Replicas-åˆ†ç‰‡ä¸å¤åˆ¶"><a href="#Shard-amp-Replicas-åˆ†ç‰‡ä¸å¤åˆ¶" class="headerlink" title="Shard &amp; Replicas åˆ†ç‰‡ä¸å¤åˆ¶"></a>Shard &amp; Replicas åˆ†ç‰‡ä¸å¤åˆ¶</h4><p>æœ‰æ—¶å€™ä¸€ä¸ªç´¢å¼•å­˜å‚¨çš„æ•°æ®è¶…è¿‡äº†ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹å¯¹åº”ç¡¬ä»¶çš„è´Ÿè·è¦æ±‚ï¼Œæ¯”å¦‚ç£ç›˜ç©ºé—´ï¼Œæˆ–è€… CPU å¤„ç†ç›¸åº”æ—¶å»¶ç­‰ã€‚ElasticSearch çš„è§£å†³æ–¹æ³•ä¾¿æ˜¯åˆ†ç‰‡ï¼Œå°†ç´¢å¼•åˆ’åˆ†æˆå¤šä»½ã€‚æ¯ä¸ªåˆ†ç‰‡æœ¬èº«ä¹Ÿæ˜¯åŠŸèƒ½å®Œå–„å¹¶ä¸”ç‹¬ç«‹çš„ â€œç´¢å¼•â€ï¼Œå¯è¢«åˆ†é…ç»™ä»»æ„èŠ‚ç‚¹ã€‚</p><p>åˆ†ç‰‡çš„ä¼˜åŠ¿ï¼š</p><ol><li><p>æå‡æ‰©å±•æ€§ï¼Œå…è®¸æ‰©å±•å†…å®¹å®¹é‡</p></li><li><p>åˆ†å¸ƒå¼å¹¶è¡Œæ“ä½œï¼Œæé«˜æ€§èƒ½/ååé‡</p></li></ol><p>é™¤æ­¤ä»¥å¤–ï¼ŒES è¿˜ç®¡ç†äº†åˆ†ç‰‡åˆ†å¸ƒä»¥åŠæ–‡æ¡£ç´¢å¼•èšåˆçš„å·¥ä½œã€‚</p><p>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå½“ç½‘ç»œ/äº‘ç¯å¢ƒä¸­ï¼Œå¤±è´¥å‘ç”Ÿæ˜¯å¾ˆé¢‘ç¹çš„äº‹æƒ…ï¼Œè¿™å¯èƒ½å¯¼è‡´æŸä¸ªèŠ‚ç‚¹çªç„¶æ— æ³•å·¥ä½œï¼Œéœ€è¦ä¸€ä¸ªæ•…éšœè½¬ç§»æœºåˆ¶å» back up è¿™ç§æƒ…å†µã€‚è€Œ ElasticSearch çš„è§£å†³æ–¹æ³•æ˜¯å…è®¸åˆ›å»ºåˆ†ç‰‡çš„ä¸€ä»½æˆ–å¤šä»½æ‹·è´ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¸º Replica / å¤åˆ¶ã€‚</p><p>å¤åˆ¶çš„ä¼˜åŠ¿ï¼š</p><ol><li><p>åˆ†ç‰‡/èŠ‚ç‚¹å¤±è´¥æ—¶ï¼Œå¯ä»¥ä»å…¶ä»–åˆ†ç‰‡/èŠ‚ç‚¹ç´¢å¼•ï¼Œæé«˜å¼•æ“å¯ç”¨æ€§ã€‚ä¹Ÿå› ä¸ºè¿™ä¸ªåŸå› ï¼Œå¤åˆ¶çš„åˆ†ç‰‡ä¸èƒ½ä¸åŸåˆ†ç‰‡å¤„äºåŒä¸€èŠ‚ç‚¹ä¸Š</p></li><li><p>æ‰©å±•äº†æœç´¢é‡/ååé‡ã€‚</p></li></ol><p>éœ€è¦æ³¨æ„ï¼šåˆ†ç‰‡ä¸å¤åˆ¶çš„æ•°é‡å¯ä»¥åœ¨ç´¢å¼•åˆ›å»ºçš„æ—¶å€™æŒ‡å®šã€‚ä½†ç´¢å¼•ä¸€æ—¦åˆ›å»ºï¼Œåˆ†ç‰‡æ•°å°±å›ºå®šäº†ï¼Œæˆ‘ä»¬åªèƒ½åŠ¨æ€æ”¹å˜å¤åˆ¶çš„æ•°é‡ã€‚è€Œä¸€ä¸ªç´¢å¼•çš„å¤šä¸ªåˆ†ç‰‡å¯ä»¥å­˜æ”¾åœ¨é›†ç¾¤ä¸­çš„ä¸€å°ä¸»æœºï¼Œä¹Ÿå¯ä»¥å­˜åœ¨å¤šå°ä¸»æœºä¸Šï¼Œä¸»è¦å–å†³äºé›†ç¾¤æœºå™¨æ•°é‡ã€‚ä¸»åˆ†ç‰‡å’Œå¤åˆ¶åˆ†ç‰‡çš„å…·ä½“ä½ç½®è¢« ES å†…åœ¨çš„ç­–ç•¥å†³å®šã€‚</p><h4 id="ES-ç‰ˆæœ¬é€‰æ‹©"><a href="#ES-ç‰ˆæœ¬é€‰æ‹©" class="headerlink" title="ES ç‰ˆæœ¬é€‰æ‹©"></a>ES ç‰ˆæœ¬é€‰æ‹©</h4><p>ES 5.0 ä¹‹å‰ï¼Œ Elastic Stack çš„å„ä¸ªç‰ˆæœ¬éƒ½ä¸åŒæ„ï¼Œå®¹æ˜“å‡ºç°ç‰ˆæœ¬å·æ··ä¹±é—®é¢˜ã€‚ä» 5.0 å¼€å§‹ï¼Œæ‰€æœ‰çš„ Elastic Stack ä¸­çš„é¡¹ç›®å…¨éƒ¨ç»Ÿä¸€ç‰ˆæœ¬å·ã€‚æ–¹ä¾¿å¤§å®¶ç»´æŠ¤å’Œæ›´æ–°ã€‚</p><h3 id="elasticsearch-ä¸‹è½½å’Œå®‰è£…"><a href="#elasticsearch-ä¸‹è½½å’Œå®‰è£…" class="headerlink" title="elasticsearch ä¸‹è½½å’Œå®‰è£…"></a>elasticsearch ä¸‹è½½å’Œå®‰è£…</h3><h4 id="å®‰è£…-docker"><a href="#å®‰è£…-docker" class="headerlink" title="å®‰è£… docker"></a>å®‰è£… docker</h4><p>è¯¦æƒ…å¯å‚è€ƒ <a href="https://jason24-zeng.github.io/2022/01/29/Docker-Intro-I/">Docker Intro (I)</a>ï¼Œé¦–å…ˆå®‰è£… Dockerï¼Œåç»­ ESï¼Œkibana çš„ä½¿ç”¨éƒ½åœ¨ docker é‡Œè¿è¡Œã€‚</p><h4 id="ä¸‹è½½-ES-å’Œ-Kibana"><a href="#ä¸‹è½½-ES-å’Œ-Kibana" class="headerlink" title="ä¸‹è½½ ES å’Œ Kibana"></a>ä¸‹è½½ ES å’Œ Kibana</h4><p>å…ˆè¿è¡Œ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search elasticsearch</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ docker hub å…¬ç”¨é•œåƒä¸­å­˜åœ¨çš„ elasticseaerch é•œåƒã€‚å¯çœ‹åˆ°æ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch/docker_search_elasticsearch.png" alt="docker_search_elasticsearch.png"></p><p>å¯ä»¥è€ƒè™‘ pull elasticsearch-kibana é•œåƒï¼Œä½¿ç”¨ä¸‹é¢æŒ‡ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nshou/elasticsearch-kibana</span><br></pre></td></tr></table></figure><p>æˆ–è€…è€ƒè™‘åˆ†åˆ«ä¸‹è½½ es å’Œ kibana</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:7.16.2</span><br><span class="line">docker pull kibana:7.16.2</span><br></pre></td></tr></table></figure><p>å®‰è£…æ—¶å¯ä»¥çœ‹åˆ°å¦‚ä¸‹çš„ä¿¡æ¯æç¤ºï¼š</p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch/docker_id.png" alt="docker_id.png"></p><p>å¯ä»¥çœ‹åˆ° docker çš„é•œåƒ ID</p><h5 id="æ£€æŸ¥æœºå†…å·²å®‰è£…é•œåƒ"><a href="#æ£€æŸ¥æœºå†…å·²å®‰è£…é•œåƒ" class="headerlink" title="æ£€æŸ¥æœºå†…å·²å®‰è£…é•œåƒ"></a>æ£€æŸ¥æœºå†…å·²å®‰è£…é•œåƒ</h5><p>é€šè¿‡ä¸‹é¢æŒ‡ä»¤ï¼Œå¯ä»¥çœ‹æœ¬æœºå·²å®‰è£…çš„é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><p>æˆ–è€…é€šè¿‡ docker desktop å¯è§†åŒ–ç•Œé¢æŸ¥çœ‹ã€‚</p><p>å¦‚å›¾ï¼Œå¯ä»¥çœ‹åˆ°ç›¸å…³çš„ tagï¼Œ IMAGE ID ä»¥åŠåˆ›é€ æ—¶é—´</p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch/image_on_disk.png" alt="image_on_disk.png"></p><h5 id="è¿è¡Œé•œåƒ"><a href="#è¿è¡Œé•œåƒ" class="headerlink" title="è¿è¡Œé•œåƒ"></a>è¿è¡Œé•œåƒ</h5><p>éœ€è¦æ˜ å°„å®¹å™¨å’Œæœ¬æœºç«¯å£ port 9200, 9300, 5601(kibana ä¸“ç”¨)</p><p>æŒ‡ä»¤ä¸º </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9200:9200 -p 9300:9300 -p 5601:5601 --name eskibana nshou/elasticsearch-kibana</span><br></pre></td></tr></table></figure><h4 id="Docker-å†…æ‰§è¡Œ"><a href="#Docker-å†…æ‰§è¡Œ" class="headerlink" title="Docker å†…æ‰§è¡Œ"></a>Docker å†…æ‰§è¡Œ</h4><h5 id="æŸ¥çœ‹å½“å‰è¿è¡Œå®¹å™¨"><a href="#æŸ¥çœ‹å½“å‰è¿è¡Œå®¹å™¨" class="headerlink" title="æŸ¥çœ‹å½“å‰è¿è¡Œå®¹å™¨"></a>æŸ¥çœ‹å½“å‰è¿è¡Œå®¹å™¨</h5><p>æŒ‡ä»¤ï¼š </p><ul><li><p><code>docker ps</code> ï¼ˆæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼‰</p></li><li><p><code>docker ps -a</code> ï¼ˆæŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼‰</p></li></ul><p>å¦‚ä¸‹å›¾ï¼Œå¯ä»¥çœ‹åˆ° CONTAINER ID ä¸º f9c23e8de222ï¼ŒNAMES æŒ‡å®šä¸º eskibana</p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch/docker_ps.png" alt="docker_ps.png"></p><p>è¿›å…¥å®¹å™¨æŒ‡ä»¤ï¼š <code>docker exec -it f9c23e8de222 /bin/bash</code></p><p>åç»­çš„è®¸å¤šæ“ä½œéƒ½æ˜¯åœ¨è¯¥å®¹å™¨ä¸­æ‰§è¡Œçš„ã€‚</p><p>å¦‚æœä¸å­˜åœ¨ bashï¼Œå¯è€ƒè™‘ä¸‹é¢æŒ‡ä»¤ <code>docker exec -it f9c23e8de222 sh</code></p><p>é€€å‡ºå®¹å™¨ï¼Œåˆ™æ˜¯ <code>cmd + d</code> æˆ–è€…è¾“å…¥ <code>exit</code></p><h5 id="å¯åŠ¨ä¸€ä¸ªå·²é€€å‡ºçš„å®¹å™¨"><a href="#å¯åŠ¨ä¸€ä¸ªå·²é€€å‡ºçš„å®¹å™¨" class="headerlink" title="å¯åŠ¨ä¸€ä¸ªå·²é€€å‡ºçš„å®¹å™¨"></a>å¯åŠ¨ä¸€ä¸ªå·²é€€å‡ºçš„å®¹å™¨</h5><p>æŒ‡ä»¤ <code>docker start container-id</code>æ¯”å¦‚ä¸Šä¸€èŠ‚çš„ <code>docker stop f9c23e8de222</code></p><h5 id="åœæ­¢å®¹å™¨"><a href="#åœæ­¢å®¹å™¨" class="headerlink" title="åœæ­¢å®¹å™¨"></a>åœæ­¢å®¹å™¨</h5><p>æŒ‡ä»¤: <code>docker stop container-id</code></p><h5 id="åˆ é™¤å®¹å™¨"><a href="#åˆ é™¤å®¹å™¨" class="headerlink" title="åˆ é™¤å®¹å™¨"></a>åˆ é™¤å®¹å™¨</h5><p>æŒ‡ä»¤: <code>docker rm container-id</code></p><h5 id="ç§»é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨"><a href="#ç§»é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨" class="headerlink" title="ç§»é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨"></a>ç§»é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨</h5><p>æŒ‡ä»¤ï¼š<code>docker rm -f webserver</code></p><h5 id="åˆ—å‡ºæœ¬åœ°é•œåƒ"><a href="#åˆ—å‡ºæœ¬åœ°é•œåƒ" class="headerlink" title="åˆ—å‡ºæœ¬åœ°é•œåƒ"></a>åˆ—å‡ºæœ¬åœ°é•œåƒ</h5><p>æŒ‡ä»¤ï¼š<code>docker list</code></p><h5 id="åå°è¿è¡Œ"><a href="#åå°è¿è¡Œ" class="headerlink" title="åå°è¿è¡Œ"></a>åå°è¿è¡Œ</h5><p>åœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ› docker çš„æœåŠ¡æ˜¯åå°è¿è¡Œçš„ï¼Œå¯ä»¥é€šè¿‡ <code>-d</code> æ‰§è¡Œå®¹å™¨çš„è¿è¡Œæ¨¡å¼ã€‚æ¯”å¦‚ä¸‹å¼ï¼Œå¯åŠ¨ <code>elasticsearch:7.16.2</code> é•œåƒï¼Œä½†æ˜¯ä¸è¿›å…¥å®¹å™¨ï¼Œå¦‚æœä¸åŠ  <code>-d</code>ï¼Œé»˜è®¤ä¼šç›´æ¥è¿›å…¥ docker</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd elasticsearch:7.16.2 /bin/bash</span><br></pre></td></tr></table></figure><h5 id="é‡å‘½åå®¹å™¨"><a href="#é‡å‘½åå®¹å™¨" class="headerlink" title="é‡å‘½åå®¹å™¨"></a>é‡å‘½åå®¹å™¨</h5><p>æ‰§è¡ŒæŒ‡ä»¤: <code>docker rename origin-Names new-Names</code></p><p>å¦‚ä¸‹å›¾ï¼Œå°†ä¸€ä¸ª Names ä¸º clever_mcnulty çš„å®¹å™¨é‡å‘½åä¸º abc</p><p><img src="https://jason24-zeng.github.io/img/ElasticSearch/docker_rename.png" alt="docker_rename.png"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸€ç« èŠ‚ä¸»è¦ç®€å•ä»‹ç»äº†ä¸€ä¸‹ Elastic Stack ä»¥åŠ Elasticsearchï¼Œå¹¶ä»‹ç»äº†å¦‚ä½•åœ¨ docker ä¸­å®‰è£…å’Œè¿è¡Œå®¹å™¨ elasticsearch ä¸ kibanaã€‚</p><h3 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h3><p><a href="https://www.cnblogs.com/sunsky303/p/9438737.html">Elasticsearchå…¥é—¨ï¼Œè¿™ä¸€ç¯‡å°±å¤Ÿäº†</a></p><p><a href="https://zhuanlan.zhihu.com/p/135939591">å¦‚ä½•ç³»ç»Ÿå­¦ä¹ ElasticSearchï¼šæ­»ç£• Elasticsearch æ–¹æ³•è®ºï¼ˆåˆå­¦è€…å¿…çœ‹</a></p><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html">Elasticsearch Guide</a></p><p><a href="[Macä¸­dockerç‰ˆæœ¬çš„ElasticSearchå’ŒKibanaå®‰è£…åŠæ“ä½œ_åæ­¥æ€ä¸€äºº-åƒé‡Œä¸ç•™è¡Œ-CSDNåšå®¢_docker elasticsearch mac](https://blog.csdn.net/m0_37609579/article/details/82698173">Macä¸­dockerç‰ˆæœ¬çš„ElasticSearchå’ŒKibanaå®‰è£…åŠæ“ä½œ</a>)</p>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ElasticSearch </tag>
            
            <tag> Apache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golang-Intro (I)</title>
      <link href="/2022/01/28/Golang-Intro-I/"/>
      <url>/2022/01/28/Golang-Intro-I/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="e1fff359d39cd57dd41ae7a3d61af24784793483b2bf9f0e2d52caefb65cf043">288c496f07cd7a970f0e86fc14828c2c7ff54ab2cc0761c06bcad47f6660946924e3d2bcb9311f6d61fc5adc8abe0cce2f5b55a65346ee70c6be6e42274e45bc81b3f4f2d6eee45410f98a1da3ba55087086a0dba266934370e52e4cf1f2ab73b52c55b22f2be0d4a5257f8031157bdd198067041e223a968d98a2c00fdfe9063363197b3ba531a9426874ff4c88d97cbb34ea9053c1a592fac586fd9c170ee1ecb9d8c41292c2661fc9e0467400d1b1dd9c4f5fe3d46e5973643a3b630ed98c0b36f647860a28b5ca147b661db5769d2a90a311cbe3168050602886a5e2036328723110ffee8934ffb3063225676a7c7b87cf2617ce460b979d7559b6ecdf8a84059bcf19eed23770d02cd12187bf02c7eba17d52e54e57d3da4a9a919db9eaee48a814fecba20e4afb175820bd5ae11a660b944dff254a5c89a95e7e3a66275d97b8ff0c7c6cbdf225c9b688c41c353aaebc4c14a26b849cf16f4c999f5cc0bcff1e3bbd8e740d8970d0a42d7c5010e85e49362371941004d967d409f5404ef63dd6759fc462227f9ed8e11ee9cbdb5d15fe9bf4b1021da9cc2433361e6ccd759931839289eb86a2f7b19710f362499af2f2bdb67904e101b48119fe9824dfd1a8b3368744bb2049a2e5de47cf224d</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">éœ€è¦å¯†ç è¾…åŠ©æŸ¥éªŒ</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> golang </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gRPC and protobuf</title>
      <link href="/2022/01/26/grpc-and-protobuf/"/>
      <url>/2022/01/26/grpc-and-protobuf/</url>
      
        <content type="html"><![CDATA[<h2 id="gRPC">gRPC</h2><h3 id="ä»€ä¹ˆæ˜¯-RPC">ä»€ä¹ˆæ˜¯ RPC?</h3><p>RPC æ˜¯ Remote Procedure Call çš„ç¼©å†™ï¼Œå³è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œè¯¥è°ƒç”¨åŒ…å«äº†ä¼ è¾“åè®®å’Œç¼–ç åè®®ç­‰ã€‚æ— éœ€é¢å¤–çš„å˜æˆï¼Œå°±èƒ½å®ç°ä¸€å°è®¡ç®—æœºçš„ç¨‹åºä¸ºå¦ä¸€å°è®¡ç®—æœºçš„ç¨‹åºè°ƒç”¨çš„äº¤äº’è¿‡ç¨‹ã€‚æˆ‘ä»¬å¸¸ç§°ä¹‹ä¸º RPC è°ƒç”¨ã€‚ä»æŠ½è±¡çš„è§’åº¦æ¥è¯´ï¼ŒRPC ä¸åœ¨æœ¬åœ°æ‰§è¡Œï¼Œå…¶éƒ½æ‹¥æœ‰ä¸‰ä¸ªç‰¹ç‚¹ï¼š</p><ul><li><p>éœ€è¦äº‹å…ˆçº¦å®šè°ƒç”¨çš„è¯­ä¹‰ â€“ Interface</p></li><li><p>éœ€è¦ç½‘ç»œä¼ è¾“</p></li><li><p>éœ€è¦å®šä¹‰ç½‘ç»œä¼ è¾“çš„æ•°æ®ç»“æ„</p></li></ul><h3 id="ä»€ä¹ˆæ˜¯-gRPC">ä»€ä¹ˆæ˜¯ gRPC?</h3><p>gRPC æ˜¯ä¸»è¦ç”± google å¼€å‘çš„å¼€æºï¼Œå…è´¹çš„ åŸºäº Protobuf å¼€å‘çš„è·¨è¯­è¨€çš„ RPC æ¡†æ¶ï¼Œå…¶ç‰¹ç‚¹ä¸»è¦æœ‰ï¼š</p><ol><li><p>ä½¿ç”¨ ProtoBuf è¿›è¡Œæ•°æ®ç¼–ç ï¼Œä»è€Œæå‡äº†æ•°æ®çš„å‹ç¼©ã€‚ProtoBuf æ˜¯ä¸€ç§ Interface Description Language (IDL) å€Ÿå£æè¿°è¡Œè¯­è¨€ã€‚</p></li><li><p>ä½¿ç”¨ HTTP/2 å¸¦æ¥è¯¸å¦‚åŒå‘æµã€æµæ§ã€å¤´éƒ¨å‹ç¼©ã€å• TCP è¿æ¥ä¸Šçš„å¤šå¤ç”¨è¯·æ±‚ç­‰ç‰¹æ€§ä¼ è¾“åè®®ï¼Œç›¸æ¯” HTTP 1.1 åè®®åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šæ€§èƒ½å’Œç©ºé—´å ç”¨ä¸Šéƒ½æœ‰ä¼˜åŒ–ã€‚</p></li><li><p>åŒæ—¶åœ¨è°ƒç”¨æ–¹ (Stub/Client) ä¸æœåŠ¡ç«¯ (Server) ä½¿ç”¨åè®®çº¦å®šæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡å¢åŠ  protobuf ç»“æ„ï¼Œä¸ºç‰ˆæœ¬å…¼å®¹ç•™ä¸‹ç¼“å†²ç©ºé—´ã€‚</p></li></ol><h3 id="gRPC-åŸºæœ¬ç»„æˆ">gRPC åŸºæœ¬ç»„æˆ</h3><p>ä¸‹å›¾ä¸ºä¸€ä¸ªç®€å•çš„è°ƒç”¨æ¨¡å‹</p><p><img src="https://jason24-zeng.github.io/img/grpc-and-protobuf/grpc_concept_diagram.jpeg" alt="grpc_model"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸»è¦çš„æ¨¡å—æœ‰ï¼š</p><ul><li><p>å®¢æˆ·ç«¯ (gRPC Stub)ï¼Œé€šè¿‡ç¨‹åºè°ƒç”¨æ–¹æ³•ï¼Œå‘èµ· RPC è°ƒç”¨</p></li><li><p>å¯¹è¯·æ±‚ä¿¡æ¯äº‹å…ˆ pb å¯¹è±¡åºåˆ—åŒ–</p></li><li><p>æœåŠ¡ç«¯ (gRPC Server) æ¥å—è¯·æ±‚ Proto Requestï¼Œè§£ç  (ååºåˆ—åŒ–) è¯·æ±‚å†…å®¹ç»“æ„ï¼Œè¿›è¡Œç›¸å…³ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œå¹¶è¿”å› Proto Responses.</p></li><li><p>ä»æœåŠ¡ç«¯ä¼ ä¼šå®¢æˆ·ç«¯ï¼Œä¹Ÿéœ€è¦è¿›è¡Œå¯¹è±¡åºåˆ—åŒ–ï¼Œä»è€Œå‹ç¼©ä¼ é€’ç©ºé—´ã€‚</p></li><li><p>å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯çš„ Responseï¼Œå¯¹å…¶è¿›è¡Œè§£ç  (ååºåˆ—åŒ–)ã€‚å”¤é†’æ­£åœ¨ç­‰å¾…å“åº”çš„å®¢æˆ·ç«¯è°ƒç”¨å¹¶è¿”å›å“åº”ç»“æœã€‚</p></li></ul><h3 id="gRPC-çš„ä¼˜åŠ¿">gRPC çš„ä¼˜åŠ¿</h3><ol><li><p>å¿«é€Ÿåºåˆ—åŒ–ï¼Œserver ç«¯å’Œ stubs ç«¯</p></li><li><p>åºåˆ—åŒ–ç»“æ„è¾ƒå°ï¼Œä»è€Œéœ€è¦ä¼ è¾“çš„å¸¦å®½å°</p></li><li><p>åŸºäº HTTP/2 åè®®è¿›è¡Œè®¾è®¡ï¼Œæœ‰æ˜¾è‘—çš„ä¼˜åŠ¿</p></li><li><p>ç›¸æ¯”äº JSONã€XMLï¼Œå®šä¹‰æ›´ç®€å•æ˜äº†ã€‚</p></li></ol><h3 id="gRPC-çš„ç¼ºç‚¹">gRPC çš„ç¼ºç‚¹</h3><ol><li><p>Protobuf åºåˆ—åŒ–åçš„æ•°æ®å¯è¯»æ€§æŸ¥ï¼Œæ— æ³•æƒ³ HTTP/1.1 é‚£æ ·è°ƒè¯•ã€‚</p></li><li><p>éœ€è¦é¢å¤–çš„ç»„å»ºååŠ©æµè§ˆå™¨è°ƒç”¨ gRPC æœåŠ¡ï¼ŒåŒæ—¶å¯¹æµè§ˆå™¨çš„æ”¯æŒæ˜¯æœ‰é™çš„ã€‚</p></li><li><p>å„å¤§ç»„å»ºå¯¹ HTTP/2 çš„æ”¯æŒè¾ƒå·®ï¼Œå³ä½¿æ”¯æŒï¼Œç¤¾åŒºç›¸å…³èµ„æ–™è¾ƒå°‘ã€‚</p></li></ol><h2 id="ProtoBuf">ProtoBuf</h2><h3 id="ä»€ä¹ˆæ˜¯-ProtoBuf">ä»€ä¹ˆæ˜¯ ProtoBuf ?</h3><p>Protocal Buffers (ProtoBuf) æ˜¯ä¸€ç§ IDLï¼Œå…·æœ‰å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„åŒ–ã€‚å®ƒä¸å¹³å°ï¼Œè¯­è¨€æ— å…³ï¼Œå¸¸ç”¨äºé€šä¿¡åè®®ï¼Œæ•°æ®å­˜å‚¨ç­‰ç­‰ã€‚ç›¸æ¯” JSONã€XML ç­‰ç»“æ„ï¼Œå®ƒæ›´å°ã€æ›´å¿«ï¼Œæ”¶åˆ°å¹¿æ³›å¼€å‘äººå‘˜çš„é’çã€‚</p><h3 id="ProtoBuf-åŸºæœ¬è¯­æ³•">ProtoBuf åŸºæœ¬è¯­æ³•</h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ä½¿ç”¨ proto3 è¯­æ³•ï¼Œå¦‚æœä¸å£°æ˜ï¼Œé»˜è®¤ä½¿ç”¨ proto2 è¯­æ³•</span></span><br><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> helloworld;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RPC æœåŠ¡å®šä¹‰</span></span><br><span class="line"><span class="class"><span class="keyword">service</span> <span class="title">Greeter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰äº†ä¸€ä¸ª RPC æ–¹æ³•ï¼Œå«åš SayHelloï¼Œå…¥å‚ä¸º HelloRequest ç»“æ„ä½“ï¼Œå‡ºå‚ä¸º HelloReply ç»“æ„ä½“</span></span><br><span class="line">    <span class="function"><span class="keyword">rpc</span> SayHello (HelloRequest) <span class="keyword">returns</span> (HelloReply) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆæ¯ä½“ï¼Œ</span></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloRequest</span> </span>&#123;</span><br><span class="line">    <span class="comment">// æ¶ˆæ¯ä½“ä¸­çš„å­—æ®µï¼Œå®šä¹‰äº†å­—æ®µç±»å‹ï¼Œå­—æ®µåç§°ï¼Œä»¥åŠ idx</span></span><br><span class="line">    <span class="built_in">string</span> name = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">message</span> <span class="title">HelloReply</span> </span>&#123;</span><br><span class="line">    <span class="built_in">string</span> <span class="class"><span class="keyword">message</span> = 1;</span></span><br><span class="line"><span class="class">&#125;</span></span><br></pre></td></tr></table></figure><p>proto æ–‡ä»¶é€šå¸¸ä»¥ <code>.proto</code> åç¼€ç»“å°¾ï¼Œé€šå¸¸è¿›è¡Œç¼–è¯‘å¹¶ç”Ÿæˆå¯¹åº”è¯­è¨€çš„ proto æ–‡ä»¶ã€‚æ ¹æ® Protobuf ç¼–è¾‘å™¨é€‰æ‹©çš„è¯­è¨€æˆ–è€…è°ƒç”¨çš„æ’ä»¶æƒ…å†µçš„ä¸åŒï¼Œç”Ÿæˆç›¸å¯¹åº”çš„ Service Interface Code å’Œ Stubs</p><h4 id="Proto-ç¼–è¯‘">Proto ç¼–è¯‘</h4><p>å‰é¢å·²ç»æåˆ°ï¼Œprotobuf æ”¯æŒå¤šè¯­è¨€ï¼Œè€Œè¯­è¨€ä¹‹é—´çš„åˆ‡æ¢å®é™…æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªç¼–è¯‘å™¨çš„ä¸åŒæ’ä»¶å®Œæˆçš„ã€‚è¿™ä¸ªç¼–è¯‘å™¨å°±æ˜¯ <code>protoc</code>ï¼Œå¯¹ <code>.proto</code> æ–‡ä»¶è¿›è¡Œç¼–è¯‘</p><h5 id="protoc-å®‰è£…"><code>protoc</code> å®‰è£…</h5><p>ä¸ºäº†å®‰è£… <code>protoc</code> ï¼Œæˆ‘ä»¬ä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å®‰è£… command</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget https://github.com/google/protobuf/releases/downloads/v3.11.2/protobuf-all-3.11.2.zip</span><br><span class="line">unzip protobuf-all-3.11.2.zip &amp;&amp; cd protobuf-3.11.2/</span><br><span class="line">./configure</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆåï¼Œå¯ä»¥é€šè¿‡æ‰§è¡Œ <code>protoc --version</code> æ£€æŸ¥æ˜¯å¦å®‰è£…æˆåŠŸ</p><h5 id="protoc-gen-go-æ’ä»¶å®‰è£…"><code>protoc-gen-go</code> æ’ä»¶å®‰è£…</h5><p>å‡è®¾æˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸Šé¢å…³äº <code>protoc</code> ç¼–è¯‘å™¨çš„å®‰è£…ï¼Œä½†æ˜¯ä»…ä»…æœ‰è¿™ä¸ªç¼–è¯‘å™¨è¿˜æ˜¯ä¸å¤Ÿçš„ã€‚å‰é¢æåˆ°ï¼Œé’ˆå¯¹ä¸åŒçš„è¯­è¨€ï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨ä¸åŒçš„ <code>protoc</code> æ’ä»¶ï¼Œä»è€Œå®Œæˆç›¸å…³è¯­è¨€ <code>.proto</code> æ–‡ä»¶çš„è½¬æ¢ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸»è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Instal a specific version.</span></span><br><span class="line">go install example.com/cmd@v1.2.3</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Install the highest available version.</span></span><br><span class="line">go install example.com/cmd@latest</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼š<code>Go 1.17</code> ä¹‹åï¼Œä½¿ç”¨ <code>go get</code> å»å®‰è£…æ’ä»¶çš„æ–¹å¼ä¸å†è¢«æ¨èï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä½¿ç”¨ <code>go install</code> æ–¹æ³•ï¼Œå› ä¸ºè¿™ä¸ªåŸå› ï¼Œæˆ‘åˆšå¼€å§‹ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">go</span> get -u google.golang.org/protobuf/cmd/protoc-gen-<span class="keyword">go</span></span><br></pre></td></tr></table></figure><p>ä¼šæœ‰ä¸‹è¿°é”™è¯¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">can&#x27;t load package: package google.golang.org/protobuf/cmd/protoc-gen-go: cannot find package &quot;google.golang.org/protobuf/cmd/protoc-gen-go&quot; in any of ...</span><br></pre></td></tr></table></figure><p>æ ¹æ®è¿™ä¸ªç¤¾åŒºè®¨è®º  <a href="https://stackoverflow.com/questions/62190610/cannot-find-package-google-golang-org-protobuf-cmd-protoc-gen-go">cannot find package â€œgoogle.golang.org/protobuf/cmd/protoc-gen-goâ€</a>ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰ä¸€äº›å…¶ä»–çš„è§£å†³æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œæ¯”è¾ƒæ¨èçš„æ–¹å¼è¿˜æ˜¯ä½¿ç”¨ <code>go install</code></p><p>åœ¨å®‰è£…ä»¥åï¼Œè¿˜éœ€è¦ç»™ golang æ·»åŠ è·¯å¾„ï¼ˆå¦åˆ™ä¼šå‡ºç°æŠ¥é”™ï¼š<a href="https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable">protoc-gen-go: program not found or is not executable</a>ï¼‰ï¼š</p><ol><li><p>æ‰§è¡Œ <code>vim ~/.bash_profile</code></p></li><li><p>æ·»åŠ </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export GO_PATH=$HOME/go</span><br><span class="line">export PATH=$PATH:/$GO_PATH/bin</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œ <code>source ~/.bash_profile</code></p></li></ol><p>å¦ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥å°†äºŒè¿›åˆ¶æ–‡ä»¶ç›®å½• <code>bin</code> ç§»åˆ°é»˜è®¤è·¯å¾„ä¸Šã€‚ä¸è¿‡è¿™ç§æ–¹æ³•éœ€è¦å½“å‰æ‰§è¡Œè€…å…·æœ‰ç§»åˆ° local è·¯å¾„çš„æƒé™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv ~/go/bin/protoc-gen-go /usr/local/go/bin</span><br></pre></td></tr></table></figure><h2 id="Reference">Reference</h2><ol><li><p><a href="https://golang2.eddycjy.com/posts/ch3/01-simple-grpc-protobuf/">Go è¯­è¨€ç¼–ç¨‹ä¹‹æ—…</a></p></li><li><p><a href="https://zhuanlan.zhihu.com/p/148139089#:~:text=gRPC%E6%98%AF%E4%B8%80%E6%AC%BERPC,%E5%85%BC%E5%AE%B9%E7%95%99%E4%B8%8B%E7%BC%93%E5%86%B2%E7%A9%BA%E9%97%B4">gRPCç³»åˆ—(ä¸€) ä»€ä¹ˆæ˜¯RPCï¼Ÿ</a></p></li><li><p><a href="https://developers.google.com/protocol-buffers/docs/cpptutorial">Protocol Buffer Basics: C++</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> gRPC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gRPC </tag>
            
            <tag> ProtoBuf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Effective C++ (III)</title>
      <link href="/2022/01/24/Effective-C-III/"/>
      <url>/2022/01/24/Effective-C-III/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      <categories>
          
          <category> coding </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> ä¹¦ç±ç¬”è®° </tag>
            
            <tag> Resource Management </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Effective C++ (II)</title>
      <link href="/2022/01/23/Effective-C-II/"/>
      <url>/2022/01/23/Effective-C-II/</url>
      
        <content type="html"><![CDATA[<h4 id="å‰è¨€">å‰è¨€</h4><p>ä¸€ä¸ªæœˆå‰ï¼Œå› ä¸ºå·¥ä½œè°ƒ åŠ¨åŸå› ï¼Œæœ‰äº†å……åˆ†çš„æ—¶é—´å»æ‹œè¯» C++ ç›¸å…³ä¹¦ç±ï¼Œäºæ˜¯å†³å¿ƒä» <em>effetive C++</em> å¼€å§‹ï¼Œé€šè¿‡ç®€å•å¾—å­¦ä¹ äº†å‰ 8 ä¸ªæ¡æ¬¾ï¼Œæ„Ÿè§‰è‡ªå·±èŒ…å¡é¡¿å¼€ï¼Œå‘ç°è‡ªå·±ä¹‹å‰å·¥ä½œä¸­çš„è®¸å¤šä¸æ„‰å¿«éƒ½æºäºè‡ªå·±çš„ä»£ç ä¹ æƒ¯ä¸å¤Ÿå¥½ã€‚å¸Œæœ›è‡ªå·±èƒ½åœ¨å…¥èŒå‰ï¼Œå°†è¿™æœ¬å·¥ç¨‹å¸ˆå¿…è¯»ä¹‹ä½œæ•´ä½“æ‹œè¯»ä¸€æ¬¡ï¼Œå¹¶ä»¥åšå®¢ä»£æ›¿æ—¥è®°çš„æ–¹å¼è®°å½•ä¸‹æ¥ï¼Œä»¥å¤‡æœªæ¥å›é¡¾ã€‚</p><h4 id="Item-09-ä¸è¦å†æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°">Item 09. ä¸è¦å†æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°ä¸­è°ƒç”¨è™šå‡½æ•°</h4><p><strong>Never call virtual functions during construction or destruction</strong></p><p>ä½¿ç”¨ C++ æ—¶ï¼Œä¸è¦åœ¨è¿™ä¸¤ä¸ªå‡½æ•°ä¸­è°ƒç”¨ virtual å‡½æ•°ï¼Œå¦åˆ™å¯èƒ½ä¼šå¾—åˆ°é¢„æƒ³ä»¥å¤–çš„ç»“æœã€‚è¿™æ—¶ C++ ä¸ Java æˆ– C# çš„åŒºåˆ«ã€‚</p><p>ä¸‹é¢æœ‰ä¸€ä¸ªçœ‹ä¼¼åˆç†ï¼Œå®åˆ™åç›´è§‚çš„ä¾‹å­ï¼Œæ¥è§£é‡Šè¿™ç§è¡Œä¸ºçš„ä¸åˆç†æ€§ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ„å»ºä¸€ä¸ª base class, åˆ›å»ºäº¤æ˜“å¯¹è±¡ï¼ŒåŒæ—¶è°ƒç”¨å‡½æ•°è®°å½•æ—¥å¿—</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transaction</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Transaction</span>();</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">logTransaction</span><span class="params">()</span> <span class="keyword">const</span> </span>= <span class="number">0</span>;    <span class="comment">// base ä¸­çš„æ—¥å¿—è®°å½•æ¥å£</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Transaction::<span class="built_in">Transaction</span>() &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">logTransaction</span>();                        <span class="comment">// base æ„é€ å‡½æ•°ä¸­è°ƒç”¨ virtual å‡½æ•°</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuyTransaction</span> :</span> <span class="keyword">public</span> Transaction &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">logTransaction</span><span class="params">()</span> <span class="keyword">const</span></span>;    <span class="comment">// ç»§æ‰¿ç±» BuyTransaction å†…å®šä¹‰çš„æ—¥è®°å‡½æ•°</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SellTransaction</span> :</span> <span class="keyword">public</span> Transaction &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">logTransaction</span><span class="params">()</span> <span class="keyword">const</span></span>;Â Â Â Â <span class="comment">// ç»§æ‰¿ç±» SellTransaction å†…å®šä¹‰çš„æ—¥è®°å‡½æ•°</span></span><br><span class="line">    ...Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸Šé¢çš„å‡½æ•°ç»§æ‰¿æ„é€ çœ‹ä¼¼åˆç†ï¼Œä½†å¦‚æœæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ª <code>BuyTransaction</code> å¯¹è±¡ï¼Œå°±ä¼šå‘ç°é—®é¢˜äº†ã€‚åˆå§‹åŒ–æ„é€ ç»§æ‰¿ç±»å¯¹è±¡æ—¶ï¼ŒåŸºç±»å¯¹è±¡çš„æˆåˆ†ä¼šé¦–å…ˆæ„é€ å¦¥å½“ï¼Œè¿™ä¸ªè¡Œä¸ºå‘ç”Ÿåœ¨ç»§æ‰¿ç±»å•ç‹¬æˆåˆ†æ„é€ ä¹‹å‰ã€‚è€ŒåŸºç±» <code>Transaction</code> æ„é€ æ—¶ä¼šè°ƒç”¨ <code>logTransaction</code> å‡½æ•°ï¼Œä¸”è¢«è°ƒç”¨çš„æ˜¯ <code>Transaction</code> ä¸­çš„ç‰ˆæœ¬ï¼Œè€Œé <code>BuyTransaction</code> ä¸­çš„ç‰ˆæœ¬ã€‚å¯¼è‡´æˆ‘ä»¬å¦‚ä¸Šåˆå§‹åŒ–çš„ <code>BuyTransaction</code> å¯¹è±¡è¡¨ç°ä¸åŸºç±»ä¸€æ ·ã€‚ä¹Ÿå°±è¿™æ ·ç†è§£ï¼Œåœ¨ base class æ„é€ æœŸé—´ï¼Œvirtual å‡½æ•°å¹¶é virtual å‡½æ•°ã€‚</p><p>è€Œè¿™ç§å…ˆå®Œå…¨æ„é€ å¥½ base class çš„è¡Œä¸ºä¹Ÿæ˜¯åˆç†çš„ï¼šå¦‚æœåŸºç±»åˆå§‹åŒ–æ—¶è°ƒç”¨äº†ç»§æ‰¿ç±»çš„æˆå‘˜ï¼Œè€Œè¿™äº›æˆå‘˜æœªåˆå§‹åŒ–ï¼Œåˆ™å¤§å¤§å¢åŠ äº†ä¸ç¡®å®šæ€§ã€‚</p><p>å”¯ä¸€èƒ½é¿å…ä¸Šé¢çš„æƒ…å†µçš„åšæ³•å°±æ˜¯ï¼Œç¡®å®šæˆ‘ä»¬æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°éƒ½æ²¡æœ‰è°ƒç”¨ virtual å‡½æ•°ï¼Œä¸”å®ƒä»¬è°ƒç”¨çš„æ‰€æœ‰å‡½æ•°ä¹Ÿæœä»è¿™ä¸€çº¦æŸâ€“ä¸è°ƒç”¨ virtual å‡½æ•°ã€‚</p><p>é‚£ä¸Šé¢è¿™ä¸ªé—®é¢˜æ€ä¹ˆè§£å†³å‘¢ï¼Ÿä¹Ÿå°±æ˜¯å¦‚ä½•ä¿è¯å¯¹è±¡åˆ›å»ºæ—¶èƒ½æœ‰æ­£ç¡®ç‰ˆæœ¬çš„ <code>logTransaction</code> å‡½æ•°è¢«è°ƒç”¨ï¼Ÿ</p><p>ä¸€ç§åšæ³•æ˜¯ï¼Œè™½ç„¶æˆ‘ä»¬æ²¡åŠæ³•æŠŠä½¿ç”¨ <code>virtual</code> å‡½æ•°ä»åŸºç±»å‘ä¸‹è°ƒç”¨ï¼Œä½†æ˜¯å¯ä»¥<em>è®©ç»§æ‰¿ç±»å‘ä¸Šä¼ é€’è¶³å¤Ÿä¿¡æ¯ç»™åŸºç±»æ„é€ å‡½æ•°</em></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transaction</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Transaction</span><span class="params">(<span class="keyword">const</span> std::string&amp; logInfo)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">logTransaction</span><span class="params">(<span class="keyword">const</span> std::string&amp; logInfo)</span> <span class="keyword">const</span></span>; <span class="comment">// non-virtual</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Transaction::<span class="built_in">Transaction</span>(<span class="keyword">const</span> std::string&amp; logInfo) &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="built_in">logTransaction</span>(logInfo);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuyTransaction</span>:</span> <span class="keyword">public</span> Transaction &#123;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">BuyTransaction</span>(parameters) : <span class="built_in">Transaction</span>(<span class="built_in">createLogString</span>(parameters)) </span><br><span class="line">    &#123;...&#125;    \\ å°† log ä¿¡æ¯ä¼ ç»™åŸºç±»æ„é€ å‡½æ•°</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">static</span> std::string <span class="title">createLogString</span><span class="params">(parameter)</span></span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°<code>private static</code> çš„ç”¨æ³•ã€‚æ¯”èµ·ä½¿ç”¨æˆå‘˜åˆå€¼åˆ— (member initialization list) çš„åŸºç±»åˆå§‹åŒ–æ–¹æ³•ï¼Œåˆ©ç”¨è¾…åŠ©å‡½æ•°ä¼ é€’å€¼ç»™åŸºç±»çš„æ–¹æ³•æ›´æ–¹ä¾¿ã€‚ä¸”æ­¤å‡½æ•°ä¸º <code>static</code>ï¼Œå°±ä¿è¯äº†åœ¨åŸºç±»åˆå§‹åŒ–æ—¶æŒ‡å‘çš„ç»§æ‰¿ç±»æˆå‘˜å˜é‡æ˜¯å·²ç»åˆå§‹åŒ–å¥½äº†çš„ã€‚</p><h4 id="Item-10-ä»¤èµ‹å€¼æ“ä½œç¬¦è¿”å›ä¸€ä¸ª-this-çš„å¼•ç”¨">Item 10. ä»¤èµ‹å€¼æ“ä½œç¬¦è¿”å›ä¸€ä¸ª *this çš„å¼•ç”¨</h4><p><strong>Have assignment operators return a reference to *this</strong></p><p>åœ¨èµ‹å€¼æ—¶ï¼Œå¯¹äºæ‰€æœ‰å†…ç½®ç±»å‹ä»¥åŠ STL åº“ä¸­æä¾›çš„ç±»å‹å¦‚ <code>string</code>, <code>vector</code>,<code>complex</code>, <code>tr1::shared_ptr</code>ç­‰ï¼Œæˆ‘ä»¬å‘ç° C++Â Â Â å¯ä»¥æ»¡è¶³è¿ç»­èµ‹å€¼çš„å½¢å¼ï¼Œæ¯”å¦‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> x, y, z;</span><br><span class="line">x = y = z = <span class="number">15</span>;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†å®ç°è¿™æ ·çš„è¿ç»­èµ‹å€¼ï¼Œèµ‹å€¼æ“ä½œç¬¦éœ€è¦è¿”å›ä¸€ä¸ªæŒ‡å‘æ“ä½œç¬¦å·¦è¾¹å®å‚çš„å¼•ç”¨ï¼Œè¿™æ—¶ä¸€ä¸ªæˆ‘ä»¬åœ¨ä¸º classes å®ç°èµ‹å€¼æ“ä½œæ—¶åº”è¯¥éµå®ˆçš„åè®®ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    ...</span><br><span class="line">    Widget&amp; <span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    <span class="comment">// è¿”å›æŒ‡å‘å½“å‰å¯¹è±¡çš„å¼•ç”¨</span></span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¸ä»…æ ‡å‡†èµ‹å€¼å½¢å¼é€‚ç”¨ï¼Œè¿˜é€‚ç”¨äºæ‰€æœ‰èµ‹å€¼ç›¸å…³è¿ç®—</span></span><br><span class="line">    Widget&amp; <span class="keyword">operator</span>+=(<span class="keyword">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œè¿™ä¸ªåè®®ä¸æ˜¯å¼ºåˆ¶çš„ï¼Œå› æ­¤ï¼Œå³ä½¿ä¸éµå®ˆï¼Œåœ¨ç¼–è¯‘æ—¶ä¹Ÿèƒ½é€šè¿‡ï¼Œä½†æ˜¯å› ä¸ºå‡ ä¹æ‰€æœ‰æ ‡å‡†ç±»å‹éƒ½éµå®ˆè¿™ä¸ªåè®®ï¼Œæ‰€ä»¥å»ºè®®åœ¨è‡ªå·±å®šä¹‰çš„æ—¶å€™ä¹Ÿéµå®ˆã€‚</p><h4 id="Item-11-åœ¨-operator-æ“ä½œç¬¦é‡Œé¢å¤„ç†è‡ªèµ‹å€¼">Item 11. åœ¨ <code>operator=</code> æ“ä½œç¬¦é‡Œé¢å¤„ç†è‡ªèµ‹å€¼</h4><p><strong>Handle assignment to self in operator=</strong></p><p>è‡ªèµ‹å€¼ï¼Œæˆ–è€…è‡ªæˆ‘èµ‹å€¼ï¼Œæ˜¯æŒ‡å¯¹è±¡è¢«èµ‹å€¼ç»™è‡ªå·±ï¼Œå…¸å‹çš„åœºæ™¯æœ‰å¦‚ä¸‹å‡ ä¸ªï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å£°æ˜ä¸€ä¸ªå¯¹è±¡ï¼Œèµ‹å€¼ç»™è‡ªå·±</span></span><br><span class="line">Widget w;</span><br><span class="line">...</span><br><span class="line">w = w;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ i = j æ—¶ï¼Œè‡ªæˆ‘èµ‹å€¼</span></span><br><span class="line">a[i] = a[j];</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“ px ä¸ py æŒ‡å‘åŒä¸€ä¸ªä¸œè¥¿</span></span><br><span class="line">*px = *py;</span><br></pre></td></tr></table></figure><p>è¿™äº›ä¸æ˜æ˜¾çš„è‡ªèµ‹å€¼ç°è±¡ï¼Œéƒ½æ˜¯ alias åˆ«åå¸¦æ¥çš„ç»“æœã€‚ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœæŸæ®µä»£ç æ“ä½œæŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼Œè€Œå®ƒä»¬åˆè¢«ç”¨æ¥&quot;æŒ‡å‘å¤šä¸ªæƒ³åŒç±»å‹çš„å¯¹è±¡&quot;æ—¶ï¼Œå°±å¯èƒ½å‡ºç°æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡çš„æƒ…å†µã€‚</p><h5 id="è‡ªèµ‹å€¼é™·é˜±ä¾‹å­">è‡ªèµ‹å€¼é™·é˜±ä¾‹å­</h5><p>å¦‚æœéµå¾ªåé¢è¦æåˆ°çš„ Item 13 ä¸ Item 14ï¼Œæˆ‘ä»¬ä¼šè¿ç”¨å¯¹è±¡æ¥ç®¡ç†èµ„æºï¼Œä¸”å¯ä»¥ç¡®å®šèµ„æºç®¡ç†å¯¹è±¡åœ¨ copy å‘ç”Ÿæ—¶æœ‰æ­£ç¡®çš„è¡Œä¸ºã€‚æ­¤æ—¶ï¼Œèµ‹å€¼æ“ä½œç¬¦è‡ªèµ‹å€¼ä¹Ÿè®¸æ˜¯å®‰å…¨çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœå°è¯•è‡ªè¡Œç®¡ç†èµ„æºï¼ˆå†™ä¸€ä¸ªç”¨äºèµ„æºç®¡ç†çš„ class æ—¶ï¼‰ï¼Œæˆ‘ä»¬å°±å¯èƒ½æ‰è¿›åœ¨åœæ­¢ä½¿ç”¨èµ„æºä¹‹å‰æ„å¤–é‡Šæ”¾èµ„æºçš„æƒ…å†µã€‚æ–‡ä¸­ä¸¾äº†ä¸€ä¸ªè¿™æ ·çš„ä¾‹å­ï¼Œæˆ‘ä»¬å»ºç«‹ä¸€ä¸ª class æ¥ä¿å­˜ä¸€ä¸ªæŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæŒ‡å‘ä¸€å—åŠ¨æ€åˆ†é…çš„ bitmapï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Bitmap</span> &#123;</span>...&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span> &#123;</span></span><br><span class="line">    ...</span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    Bitmap* pb;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª <code>operator=</code>èµ‹å€¼æ“ä½œç¬¦ï¼Œå»æ›´æ–°ä½å›¾</p><h5 id="Version-1">Version 1</h5><p>æœ€åˆå§‹çš„ç‰ˆæœ¬ï¼Œè²Œä¼¼åˆç†ï¼Œä½†æ˜¯å¦‚æœ *this å’Œ rhs æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™å¯èƒ½å‡ºç°é—®é¢˜</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">delete</span> pb;</span><br><span class="line">    pb = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb); <span class="comment">// å¯èƒ½ä¼šå› ä¸ºè‡ªèµ‹å€¼è€ŒæŠ¥é”™</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="Version-2">Version 2</h5><p>ä¿®æ”¹ç‰ˆæœ¬ï¼Œå…ˆåˆ¤æ–­æ˜¯å¦è‡ªèµ‹å€¼ï¼Œå†æ‰§è¡Œã€‚è¿™ä¸ªä¿è¯äº†è‡ªæˆ‘èµ‹å€¼æ˜¯å®‰å…¨çš„ï¼Œä½†æ˜¯å¦‚æœ <code>new Bitmap</code> å¯¼è‡´å¼‚å¸¸ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªæŒ‡å‘è¢«åˆ é™¤ <code>Bitmap</code> çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬æ— æ³•å®‰å…¨åˆ é™¤ï¼Œä¹Ÿæ— æ³•å®‰å…¨è¯»å–ï¼Œå› æ­¤è¿™ä¸€ç‰ˆæœ¬çš„ <code>operator=</code> ä¸å…·å¤‡å¼‚å¸¸å®‰å…¨æ€§ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span> == &amp;rhs) <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    <span class="keyword">delete</span> pb;</span><br><span class="line">    pb = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb); <span class="comment">// å¯èƒ½ä¼šå› ä¸ºè‡ªèµ‹å€¼è€ŒæŠ¥é”™</span></span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="Version-3">Version 3</h5><p>æŠŠç„¦ç‚¹æ”¾åœ¨å¼‚å¸¸å®‰å…¨æ€§ä¸Šï¼Œå› ä¸ºå½“ <code>operator=</code> å…·å¤‡å¼‚å¸¸å®‰å…¨æ€§æ—¶ï¼Œå®ƒè‡ªç„¶å°±å…·å¤‡äº†è‡ªèµ‹å€¼å®‰å…¨æ€§ã€‚å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    Bitmap* pOrig = pb;</span><br><span class="line">    pb = <span class="keyword">new</span> <span class="built_in">Bitmap</span>(*rhs.pb); <span class="comment">// copy assignment;</span></span><br><span class="line">    <span class="keyword">delete</span> pOrig;</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„ï¼Œè‡ªèµ‹å€¼çš„æ—¶å€™ï¼Œä¾ç„¶éœ€è¦å¤åˆ¶ä¸€ä»½åŸæ¥çš„å€¼ï¼Œå¯èƒ½ä¸é«˜æ•ˆã€‚å¯ä»¥è€ƒè™‘ä½¿ç”¨ Version 2 çš„æ–¹æ³•åŠ å…¥ä¸€ä¸ª identity testï¼Œä½†éœ€è¦è€ƒå¯Ÿæ˜¯å¦æœ‰å¿…è¦ï¼Œæ¯”å¦‚è¿™ç§è‡ªèµ‹å€¼å‡ºç°çš„é¢‘ç‡æ˜¯å¦èƒ½ cover ä½æ–°å¢æ§åˆ¶æµåˆ†æ”¯ä¸ä»£ç çš„æ•ˆç‡é™ä½ã€‚</p><h5 id="Version-4">Version 4</h5><p>é‡‡ç”¨ copy and swap æŠ€æœ¯ï¼Œè¿™ä¸ªæŠ€æœ¯åœ¨ pb æ–‡ä»¶çš„èµ‹å€¼æ“ä½œä¸­ç»å¸¸ç”¨åˆ°ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Widget</span> &#123;</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">swap</span><span class="params">(Widget&amp; rhs)</span></span>;     <span class="comment">// äº¤æ¢ *this å’Œ rhs æ•°æ®</span></span><br><span class="line">    ...</span><br><span class="line">&#125;;</span><br><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="keyword">const</span> Widget&amp; rhs) &#123;</span><br><span class="line">    Widget <span class="built_in">temp</span>(rhs);</span><br><span class="line">    <span class="built_in">swap</span>(temp);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// or </span></span><br><span class="line">Widget&amp; Widget::<span class="keyword">operator</span>=(<span class="keyword">const</span> Widget rhs) &#123;</span><br><span class="line">    <span class="built_in">swap</span>(rhs);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŸå¤±äº†å‡½æ•°çš„æ¸…æ™°æ€§ã€‚</span></span><br></pre></td></tr></table></figure><h4 id="Item-12-å¤åˆ¶å¯¹è±¡çš„æ¯ä¸€ä¸ªæˆåˆ†">Item 12. å¤åˆ¶å¯¹è±¡çš„æ¯ä¸€ä¸ªæˆåˆ†</h4><p><strong>Copy all parts of an object</strong></p><p>å½“æˆ‘ä»¬ä¸ç”¨ç¼–è¾‘å™¨é»˜è®¤ç”Ÿæˆçš„ copying å‡½æ•°ï¼Œè€Œè‡ªå·±å£°æ˜ copying å‡½æ•°æ—¶ï¼Œå³ä½¿è¿™ä¸ª copying å‡½æ•°æœ‰æ˜æ˜¾çš„é”™è¯¯ï¼Œæ¯”å¦‚å°‘å¼•å…¥äº†å¯¹è±¡çš„ä¸€éƒ¨åˆ† private æˆå‘˜å˜é‡æ—¶ï¼Œç¼–è¾‘å™¨ä¾ç„¶ä¸ä¼šæŠ¥é”™ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ class ä¸­æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œæˆ‘ä»¬å¿…é¡»åŒæ—¶ä¿®æ”¹ copying å‡½æ•°ã€‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹æ‰€æœ‰æ„é€ å‡½æ•°ï¼Œä»¥åŠä»»ä½•éæ ‡å‡†å½¢å¼çš„ <code>operator=</code>ã€‚</p><p>ä¸€æ—¦è¿˜æœ‰ç»§æ‰¿ç±»ï¼Œè¿™ç§æ½œåœ¨çš„å±æœºå°±æ›´ä¸å®¹æ˜“è¢«å¯Ÿè§‰ã€‚æœ‰äº›ç»§æ‰¿ç±»ï¼Œå…¶ copy æ„é€ å‡½æ•°çœ‹ä¼¼copy äº†ç±»é‡Œæ‰€æœ‰å£°æ˜çš„å˜é‡ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰åˆ¶å®šå®å‚ä¼ ç»™åŸºç±»æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥åŸºç±»æˆåˆ†ä¼šè¢«ä¸å¸¦å®å‚çš„åŸºç±» default æ„é€ å‡½æ•°åˆå§‹åŒ–ã€‚copy assignment æ“ä½œç¬¦çš„æ•´ä½“æµç¨‹åŒä¸Šã€‚</p><p>åœ¨ä»»ä½•æ—¶å€™åªè¦æˆ‘ä»¬ä¸ºç»§æ‰¿ç±»ç¼–å†™ copying å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¿…é¡»å°å¿ƒèµ‹å€¼å…¶åŸºç±»æˆåˆ†ã€‚éœ€è¦æ³¨æ„è¿™äº›æˆåˆ†æ˜¯ private çš„ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥è®¿é—®å®ƒä»¬ï¼Œè€Œåº”è¯¥ç”¨ç»§æ‰¿ç±»çš„ copying å‡½æ•°è°ƒç”¨ç›¸åº”çš„åŸºç±»å‡½æ•°ã€‚</p><p>ç»¼ä¸Šï¼Œå½“æˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ª copying å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯</p><ol><li><p>å¤åˆ¶æ‰€æœ‰çš„ local æˆå‘˜å˜é‡</p></li><li><p>è°ƒç”¨æ‰€æœ‰åŸºç±»é€‚å½“çš„ copying å‡½æ•°</p></li></ol><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»¤ copy èµ‹å€¼æ“ä½œç¬¦è°ƒç”¨ copy æ„é€ å‡½æ•°æ˜¯ä¸åˆç†çš„ï¼Œè¿™æ—¶åœ¨æ„é€ ä¸€ä¸ªå­˜åœ¨çš„å¯¹è±¡ã€‚åŒæ ·ï¼Œè®© copy æ„é€ å‡½æ•°è°ƒç”¨ copy èµ‹å€¼æ“ä½œç¬¦ï¼ŒåŒæ ·æ— æ„ä¹‰ï¼Œæˆ‘ä»¬æ— æ³•å¯¹ä¸€ä¸ªä¸ºæ„é€ å¥½çš„å¯¹è±¡èµ‹å€¼ã€‚</p><p>å¦‚æœ copy æ„é€ å‡½æ•°å’Œ copy assignment æ“ä½œç¬¦æœ‰ç›¸è¿‘çš„ä»£ç ï¼Œæœ€å¥½çš„å¤„ç†æ–¹å¼æ˜¯å»ºç«‹ä¸€ä¸ªæˆå‘˜å‡½æ•°ä¾›ä¸¤è€…è°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°å¾€å¾€æ˜¯ private ä¸”å¸¸è¢«å‘½åä¸º <code>init</code>ã€‚ï¼ˆæ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Ÿï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> coding </category>
          
          <category> C++ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> ä¹¦ç±ç¬”è®° </tag>
            
            <tag> æ„é€  </tag>
            
            <tag> ææ„ </tag>
            
            <tag> èµ‹å€¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Alias Table Sampling</title>
      <link href="/2022/01/23/alias-table-sampling/"/>
      <url>/2022/01/23/alias-table-sampling/</url>
      
        <content type="html"><![CDATA[<h3 id="ç¦»æ•£æŒ‰æ¦‚ç‡éšæœºæŠ½æ ·ç®—æ³•-Alias-method">ç¦»æ•£æŒ‰æ¦‚ç‡éšæœºæŠ½æ ·ç®—æ³• - Alias method</h3><p>å› ä¸ºæœ€è¿‘å­¦ä¹ å›¾åµŒå…¥ graph embedding çš„ç›¸å…³æ“ä½œä¸ç®—æ³•ï¼Œå‘ç°æ— è®ºåœ¨ä½¿ç”¨ deepwalk, LINE, node2vec è¿˜æ˜¯ SDNE ç­‰å›¾åµŒå…¥æ–¹æ³•æ—¶ï¼Œéšæœºæ¸¸èµ°é€‰æ‹©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹éƒ½ä¼šç”¨åˆ°ä¸€ç§æŒ‰æ¦‚ç‡é‡‡æ ·çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ Alias æ–¹æ³•ã€‚ç¬¬ä¸€æ¬¡å­¦ä¹ åˆ°è¿™ä¸ªç®—æ³•ï¼Œæ˜¯åœ¨è½¬ä¸“ä¸šåˆ·çŸ¥ä¹æ˜¯çœ‹åˆ°çš„ï¼Œæƒ³æ¥ä¹Ÿæ˜¯å¾ˆå¥‡å¦™ï¼Œæœç„¶æœ‰äº›ä¼˜ç§€çš„ç®—æ³•å®¹æ˜“è¢«äººæèµ·å¹¶è®°ä½ã€‚è¿™ç§æ–¹æ³•å› ä¸ºå…¶ $O(1)$ çš„æ—¶é—´å¤æ‚åº¦ï¼Œå¤§å¹…åŠ é€Ÿäº†å€™é€‰é›†çš„ç”Ÿæˆã€‚æ¥ä¸‹æ¥çš„ç« èŠ‚å°†ä¸»è¦è®²è§£ä¸€äº›ç›¸å…³çš„éšæœºæŠ½æ ·ç®—æ³•ï¼Œæœ€åå†è®²åˆ° Alias methodã€‚</p><h4 id="é—®é¢˜é˜è¿°">é—®é¢˜é˜è¿°</h4><p>å‡è®¾å€™é€‰é›†ä¸º $M$ ä¸ªäº‹ä»¶ï¼Œç”¨ $1, â€¦ ,m$ å¯¹è¿™äº›æ—¶é—´ç¼–å·ã€‚è¿™äº›äº‹ä»¶äº’æ–¥ï¼Œå‘ç”Ÿçš„æ¦‚ç‡ä¸º $p_i, i = 1, â€¦, m$ï¼Œæ»¡è¶³ $\sum^m_{i = 1} p_i = 1$ã€‚é—®ï¼Œå¦‚ä½•äº§ç”Ÿä¸€ä¸ªäº‹ä»¶å‘ç”Ÿå™¨ï¼Œæ ¹æ®å‘ç”Ÿæ¦‚ç‡å»äº§ç”Ÿäº‹ä»¶å‘¢ï¼Ÿ</p><h4 id="Solution-1ï¼špreSum-æ–¹æ³•">Solution 1ï¼špreSum æ–¹æ³•</h4><p>æ­¥éª¤ï¼š</p><ul><li><p>é€šè¿‡æ•°ç»„ $p_i$ ä¾ç…§å‰ç¼€å’Œæ–¹æ³•ç”Ÿæˆ prefix Sum æ•°ç»„ <code>presum</code>ã€‚äº¦å°†æ¦‚ç‡å¯†åº¦å‡½æ•°&quot;ç§¯åˆ†&quot;æˆæ¦‚ç‡åˆ†å¸ƒå‡½æ•°</p></li><li><p>äº§ç”Ÿ 0 - 1 çš„éšæœºæ•°ï¼Œåˆ¤æ–­éšæœºæ•°å¤„äºå“ªä¸ªæ¦‚ç‡åŒºé—´ï¼Œè¿”å›å¯¹åº”çš„äº‹ä»¶ã€‚</p></li></ul><p>å¤æ‚åº¦åˆ†æï¼š</p><ul><li><p>æ—¶é—´å¤æ‚åº¦: äº§ç”Ÿ <code>presum</code> æ•°ç»„ $O(n)$ï¼Œè¿”å›éšæœºäº‹ä»¶ä½¿ç”¨äºŒåˆ†æ³• $(O(logn))$</p></li><li><p>ç©ºé—´å¤æ‚åº¦ï¼šç»´æŠ¤ <code>presum</code> æ•°ç»„ $O(n)$</p></li></ul><p>ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">preSum_method</span> &#123;</span></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    vector&lt;<span class="keyword">float</span>&gt; presum;</span><br><span class="line">    std::random_device rd;</span><br><span class="line">    <span class="function">std::default_random_engine <span class="title">eng</span><span class="params">(rd())</span></span>;</span><br><span class="line">    <span class="function">std::uniform_real_distribution&lt;<span class="keyword">float</span>&gt; <span class="title">distr</span><span class="params">(FLOAT_MIN, FLOAT_MAX)</span></span>;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">preSum_method</span>(vector&lt;<span class="keyword">float</span>&gt;&amp; prob) &#123;</span><br><span class="line">        presum.<span class="built_in">reserve</span>(prob.<span class="built_in">size</span>() + <span class="number">1</span>, <span class="number">0.0f</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i != prob.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            presum[i + <span class="number">1</span>] = presum[i] + prob[i];    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">generate_case</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>, right = presum.<span class="built_in">size</span>() - <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">float</span> random_num = <span class="built_in">distri</span>(eng);</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= right) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = left + (right - left) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (random_num &lt; nums[mid + <span class="number">1</span>] &amp;&amp; random_num &gt;= nums[mid]) <span class="keyword">return</span> mid;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (random_num &gt;= nums[mid + <span class="number">1</span>]) left = mid + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="Solution-2-é¢„è®¾å€™é€‰é›†æ³•">Solution 2 : é¢„è®¾å€™é€‰é›†æ³•</h4><p>æ­¥éª¤ï¼Œ</p><ul><li><p>æ ¹æ®æ¦‚ç‡ç”Ÿæˆä¸€ä¸ªå¾ˆå¤§çš„å€™é€‰é›†</p></li><li><p>é€šè¿‡éšæœºæ•°çš„å€¼è¿”å›å¯¹åº”å€™é€‰é›†ä½ç½®çš„äº‹ä»¶</p></li></ul><p>å¤æ‚åº¦åˆ†æï¼š</p><ul><li><p>äº§å‡ºå€™é€‰é›†çš„æ—¶é—´å¤æ‚åº¦ $O(N)$ï¼Œ$N$ ä¸ç²¾åº¦æœ‰å…³ï¼Œè¿”å›éšæœºäº‹ä»¶ $O(1)$</p></li><li><p>ç©ºé—´å¤æ‚åº¦ $O(N)$</p></li></ul><p>ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CandidateSet</span> &#123;</span></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; candidate_set;</span><br><span class="line">    <span class="keyword">int</span> P;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CandidateSet</span>(vector&lt;<span class="keyword">float</span>&gt;&amp; prob, <span class="keyword">int</span> precision) &#123;</span><br><span class="line">        P = <span class="number">10</span> ** precision;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i != prob.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">temp</span><span class="params">(i, (<span class="keyword">int</span>) (i * P))</span></span>;</span><br><span class="line">            std::<span class="built_in">copy</span>(temp.<span class="built_in">begin</span>(), temp.<span class="built_in">end</span>(), std::<span class="built_in">back_insert</span>(candidate_set));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">generate_case</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> random_number = <span class="built_in">rand</span>() % P;</span><br><span class="line">        <span class="keyword">return</span> candidate_set[random_number];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹æ³•ä¸»è¦çš„å¼Šç«¯åœ¨äºéœ€è¦ç”³è¯·å¾ˆå¤§ä¸€å—è¿ç»­ç©ºé—´æ¥å­˜å‚¨å€™é€‰é›†ã€‚</p><h4 id="Solution-3-Alias-Method">Solution 3 : Alias Method</h4><p>æœ¬æ–‡çš„é‡ç‚¹ã€‚ä¸»è¦çš„åˆ›æ–°ç‚¹åœ¨äºå»ºè¡¨ç¯èŠ‚ã€‚æˆ‘ä»¬è€ƒè™‘åˆ°ç­‰æ¦‚ç‡æŠ½æ ·çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(1)$ï¼Œè€Œå¯¹äºŒé¡¹åˆ†å¸ƒçš„æ—¶é—´è¿›è¡ŒæŠ½æ ·çš„æ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯ $O(1)$ã€‚å› æ­¤ï¼Œæ•´ä¸ªæ—¶é—´çš„æ€è·¯å˜æˆäº†å¦‚ä½•æŠŠä¾æ¦‚ç‡æŠ½æ ·çš„æ—¶é—´è½¬å˜ä¸ºç­‰æ¦‚ç‡æŠ½æ ·ã€‚</p><p>alias method è€ƒè™‘ç»´æŠ¤ä¸€ä¸ª alias è¡¨ï¼Œé‡Œé¢æœ‰ $M$(äº‹ä»¶ä¸ªæ•°) ä¸ªå€¼å¾—æ•°ç»„ï¼Œå¯¹æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªäºŒé¡¹åˆ†å¸ƒå‚æ•°çš„ä¸‰å…ƒç»„<code>prob, lower_event, higher_event</code>ã€‚é€šè¿‡ç­‰æ¦‚ç‡é€‰å–æ•°ç»„çš„å…ƒç´ ï¼Œå†ä¾æ¦‚ç‡é€‰æ‹©äºŒå…ƒäº‹ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œæˆä¾æ¦‚ç‡å¯¹å¤šå…ƒäº‹ä»¶çš„æŠ½æ ·ã€‚</p><p>æ­¥éª¤ï¼š</p><ul><li><p>åˆ¶è¡¨ã€‚ä¸¤å¼ è¡¨ï¼š</p><ul><li><p>ç­‰æ¦‚ç‡è¡¨ï¼Œå¤§å°ä¸º $M$</p></li><li><p>ç»´æŠ¤ä¸¤ä¸ªé˜Ÿåˆ—ï¼Œsmall, large åˆ†åˆ«å­˜æ”¾å°äº 1 å’Œ å¤§äº 1 çš„æ—¶é—´ä¸‹æ ‡</p></li><li><p>æ¯æ¬¡ä» smallï¼Œlarge ä¸­å„å–ä¸€ä¸ªï¼Œç”¨ large é‡Œçš„å€¼å¡«è¡¥ small çš„ï¼Œä½¿ small çš„æ•´ä½“æ¦‚ç‡ç­‰äº 1ï¼Œç„¶åæ ¹æ® large å‰©ä½™çš„æ•´ä½“æ¦‚ç‡ï¼Œå°†å…ƒç´ é‡æ–°æ”¾å› large æˆ– small ä¸­ã€‚</p></li><li><p>æ‰€æœ‰çš„æ¦‚ç‡éƒ½ç­‰äº 1</p></li></ul></li><li><p>é‡‡æ ·</p></li></ul><p>ä»£ç ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AliasMethod</span> &#123;</span></span><br><span class="line">  <span class="keyword">private</span>:</span><br><span class="line">    vector&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; alias_method;</span><br><span class="line">    <span class="keyword">int</span> multiplier;</span><br><span class="line">    std::random_device rd;</span><br><span class="line">    <span class="function">std::default_random_engine <span class="title">eng</span><span class="params">(rd())</span></span>;</span><br><span class="line">    <span class="function">std::uniform_real_distribution&lt;<span class="keyword">float</span>&gt; <span class="title">distr</span><span class="params">(FLOAT_MIN, FLOAT_MAX)</span></span>;</span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CandidateSet</span>(vector&lt;<span class="keyword">float</span>&gt;&amp; prob, <span class="keyword">int</span> precision) &#123;</span><br><span class="line">        std::queue&lt;<span class="keyword">int</span>&gt; large, small;</span><br><span class="line">        multiplier = prob.<span class="built_in">size</span>();</span><br><span class="line">        alias_method.<span class="built_in">reserve</span>(multiplier);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i != multiplier; i++) &#123;</span><br><span class="line">            <span class="keyword">int</span> new_prob = prob[i] * multiplier;</span><br><span class="line">            <span class="keyword">if</span> (new_prob &lt; <span class="number">1</span>) &#123;</span><br><span class="line">                small.<span class="built_in">push</span>(i);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (new_prob &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                large.<span class="built_in">push</span>(i)</span><br><span class="line">            &#125;</span><br><span class="line">            alias_method[i] = new_prob == <span class="number">1</span> ? &#123;new_prob, i&#125; : &#123;new_prob, <span class="number">-1</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!large.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">int</span> large_pos = large.<span class="built_in">front</span>();</span><br><span class="line">            <span class="keyword">int</span> small_pos = small.<span class="built_in">front</span>();</span><br><span class="line">            <span class="keyword">auto</span>&amp; l = alias_method[large_pos];</span><br><span class="line">            large.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">auto</span>&amp; s = alias_method[small_pos];</span><br><span class="line">            small.<span class="built_in">pop</span>();</span><br><span class="line">            l.first -= s.first;</span><br><span class="line">            s.second = large_pos;</span><br><span class="line">            <span class="keyword">if</span> (l.first &lt; <span class="number">1</span>) small.<span class="built_in">push</span>(large_pos);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (l.first &gt; <span class="number">1</span>) large.<span class="built_in">push</span>(large_pos);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">generate_case</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> random_case = <span class="built_in">rand</span>() % multiplier;</span><br><span class="line">        <span class="keyword">float</span> random_num = <span class="built_in">distri</span>(eng);</span><br><span class="line">        <span class="keyword">auto</span>&amp; temp = alias_method[random_case];</span><br><span class="line">        <span class="keyword">return</span> temp.first &lt;= random_num ? random_case : temp.second;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithm </category>
          
          <category> Probability </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Algorithm </tag>
            
            <tag> Probability </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Embedding Introduction (VI)</title>
      <link href="/2022/01/22/Embedding-Introduction-VI/"/>
      <url>/2022/01/22/Embedding-Introduction-VI/</url>
      
        <content type="html"><![CDATA[<h4 id="SDNE-Structural-Deep-Network-Embedding">SDNE : Structural Deep Network Embedding</h4><p>DeepWalk, LINE, Node2vec è¿™å‡ ä¸ª Graph Embedding  çš„æ–¹æ³•ï¼Œåœ¨è®­ç»ƒ Embedding çš„æ—¶å€™ä½¿ç”¨çš„éƒ½æ˜¯ skip-gram çš„æ¨¡å‹ç»“æ„ã€‚è¿™ä¸ªæ¨¡å‹ç»“æ„åªæœ‰ä¸€å±‚éšè—å±‚ï¼Œå¾ˆéš¾å­¦åˆ°ä¸€äº›é«˜é˜¶éçº¿æ€§çš„ç‰¹å¾ã€‚è€Œ SDNE ä¸ºäº†è¡¨è¾¾é«˜é˜¶éçº¿æ€§ï¼Œå¼•å…¥äº†æ›´æ·±çš„ç½‘ç»œç»“æ„ã€‚</p><h4 id="è®­ç»ƒç½‘ç»œç»“æ„">è®­ç»ƒç½‘ç»œç»“æ„</h4><p>SDNE ä½¿ç”¨çš„è®­ç»ƒæ¡†æ¶æ˜¯ä¸€ç§åŠç›‘ç£å¼çš„æ·±åº¦æ¨¡å‹è®­ç»ƒæ¡†æ¶ã€‚å…¶æ•´ä½“çš„ç½‘ç»œç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction-VI/SDNE_top.png" alt="SDNE_framework"></p><p>é¦–å…ˆææ¸…æ¥šä¸€è¾¹çš„æ·±å±‚ç½‘ç»œç»“æ„ ï¼š Autoencoder</p><h5 id="Autoencoder-for-second-order-proximity">Autoencoder for second-order proximity</h5><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction-VI/autoencoder.png" alt="SDNE_autoencoder"></p><p>å¦‚ä¸Šå›¾ï¼Œä¸ºä¸€ä¸ª autoencoder çš„åŸºæœ¬ç»“æ„ã€‚æˆ‘ä»¬è‡ªä¸‹å¾€ä¸Šçš„çœ‹ã€‚</p><p>è¾“å…¥å±‚ $x_i \in R^{|V|}$ ï¼Œ $|V|$ ä¸ºæ‰€æœ‰èŠ‚ç‚¹çš„æ•°é‡ã€‚å¦‚æœ $(i, j)$ è¾¹å­˜åœ¨ï¼Œåˆ™ $x_{ij} &gt; 0$ï¼Œå¯ä»¥ç†è§£ä¸º $x_{ij} = w_{ij}$ ä¸º edge $(i,j)$ çš„è¾¹æƒï¼Œå¦åˆ™ï¼Œ$x_{ij} = 0$ã€‚</p><p>ç´«è‰²éƒ¨åˆ†æ˜¯ encoderï¼Œæ˜¯å°†ç¨€ç–å‘é‡ $x_i$ é™ç»´ï¼Œä½¿ä¹‹ç¨ å¯†çš„è¿‡ç¨‹ã€‚</p><p>ä¸­é—´è“è‰²éƒ¨åˆ†å°±æ˜¯æ¯ä¸ªé¡¶ç‚¹ $i$ å¯¹åº”çš„è¾“å‡º embedding $y_i^{(K)}$ ã€‚</p><p>æ·±è“è‰²éƒ¨åˆ†åˆ™æ˜¯ decoderï¼Œå¯ä»¥è®¤ä¸ºæ˜¯ç´«è‰²éƒ¨åˆ†çš„ revertï¼Œå‡ç»´ï¼Œä½¿ä¹‹ç¨€ç–ï¼Œæœ€ç»ˆè¾“å‡ºå‘é‡ $\hat{x_i}$ã€‚</p><p>æ•´ä¸ª autoencoder çš„è¿‡ç¨‹æ˜¯æ— ç›‘ç£çš„ã€‚åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—è¾“å…¥å‘é‡ $x_i$ ä¸å‘é‡ $\hat{x_i}$ çš„ lossï¼Œè®¤ä¸ºæ˜¯äºŒé˜¶è¿‘é‚»å…³ç³»çš„ç›®æ ‡å‡½æ•°è¡¨è¾¾ã€‚</p><p>è¿™ä¸ª loss è¡¨ç¤ºä¸ºï¼š</p><p>$$<br>\begin{aligned}<br>\mathcal{L}_{2nd} &amp;=  \sum^n_i |(\mathbf{\hat{x}}_i - \mathbf{x}_i) \bigodot  \mathbf{b}_i|^2_2  \\<br>&amp;= |(\hat{X}_i - X_i) \bigodot  B |^2_F<br>\end{aligned}<br>$$</p><p>å…¶ä¸­ $\bigodot$ è¡¨è¾¾ Hadamard ä¹˜ç§¯ï¼Œå³æŒ‰ä½ç½®ç›¸ä¹˜ä¹‹å’Œã€‚å¦‚æœ $s_{i,j} = 0$ï¼Œåˆ™ $b_{i,j} = 1$ã€‚å¦åˆ™ $b_{i,j} = \beta &gt; 1$ã€‚å› æ­¤ï¼Œé€šè¿‡å°†ä¸´æ¥çŸ©é˜µ $S$ä½œä¸ºè¾“å…¥ï¼Œä½¿ç”¨ä¿®æ”¹çš„æ·±å±‚ autoencoderï¼Œæœ‰ç›¸ä¼¼é‚»å±…ç»“æ„çš„é¡¶ç‚¹ä¼šåœ¨è¡¨è¾¾ç©ºé—´ embedding ä¸­é è¿‘ã€‚</p><h5 id="Supervised-component-for-first-order-proximity">Supervised component for first-order proximity</h5><p>é™¤äº† global çš„ç½‘ç»œç»“æ„ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æŠ“ä½å±€éƒ¨ç»“æ„ï¼Œè¿™é‡Œçš„å±€éƒ¨ç»“æ„åœ¨æ–‡ä¸­ä¸“æŒ‡ first-order proximityã€‚æŸå¤±å‡½æ•°å¯ä»ç½‘ç»œå›¾ä¸­å¾—åˆ°ï¼š</p><p>$$<br>\begin{aligned}<br>\mathcal{L}_{1st} &amp;= \sum^n_{i,j = 1} s_{i,j}|y^{K}_i - y^{K}_j|^2_2\\<br>&amp;= \sum^n_{i,j = 1} s_{i,j}|y_i - y_j|^2_2<br>\end{aligned}<br>$$</p><p>(è¿™é‡Œå‡ºç° markdown ä¸ mathjax å¯¹ _ çš„è½¬ä¹‰å‡ºç°å†²çªï¼Œå¯¼è‡´æ•°å­¦å…¬å¼æ˜¾ç¤ºæœ‰é—®é¢˜ã€‚éœ€è¦å† _ å‰åŠ ä¸‹åˆ’çº¿è§£å†³ã€‚)</p><p>è¿™ä¸ªæŸå¤±å‡½æ•°è¡¨å¾çš„æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªèŠ‚ç‚¹ç›¸è¿ï¼Œåˆ™å­˜åœ¨ä¸€å®šçš„ç›¸ä¼¼æ€§ï¼Œå¦‚æœæƒé‡è¶Šå¤§ï¼Œç›¸ä¼¼æ€§è¶Šé«˜ã€‚å…¬å¼ä¸­çš„ $y$ è¡¨ç¤ºè‡ªç¼–ç å™¨çš„ä¸­é—´å±‚è¾“å‡ºã€‚</p><h5 id="æ•´ä¸ªæ¨¡å‹æŸå¤±å‡½æ•°">æ•´ä¸ªæ¨¡å‹æŸå¤±å‡½æ•°</h5><p>æ•´ä¸ªæ¨¡å‹çš„æŸå¤±å‡½æ•°ç»“åˆäº†ä¸€é˜¶å’ŒäºŒé˜¶ proximity ç›¸å…³çš„ç›®æ ‡å‡½æ•°ï¼ŒåŒæ—¶å¼•å…¥äº†ä¸€ä¸ªæ­£åˆ™é¡¹ï¼š</p><p>$$<br>\mathcal{L}_{reg} = \frac{1}{2}\sum^K_{k = 1}(|W^{(k)} |^2_F + |\hat{W}^{(k)} |^2_F)<br>$$</p><p>å…¶ä¸­ $W^{(k)}$ ä¸ $\hat{W}^{(k)}$ åˆ†åˆ«ä»£è¡¨è‡ªç¼–ç å™¨ä¸­ encoder å’Œ decoder ç½‘ç»œçš„æƒé‡ã€‚</p><p>æ•´ä½“æŸå¤±å‡½æ•°å¦‚ä¸‹ï¼š</p><p>$$<br>\begin{aligned}<br>\mathcal{L}_{mix} &amp;= \mathcal{L}_{2nd} + \alpha\mathcal{L}_{1st} + \mu\mathcal{L}_{reg} \\<br>&amp;= |(\hat{X}_i - X_i) \bigodot  B |^2_F + \alpha \sum^n_{i,j = 1} s_{i,j}|y_i - y_j|^2_2 + \mu\mathcal{L}_{reg}<br>\end{aligned}<br>$$</p><p>è¿™ä¸ªæŸå¤±å‡½æ•°åœ¨å®éªŒæ•ˆæœä¸Šæ˜æ˜¾ç”±äº LINEï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œç»“æ„æ›´åŠ å¤æ‚ï¼Œè¾“å…¥è¾“å‡ºä¸­åˆåˆ†å‚ç¨€ç–ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦è¾ƒé«˜ï¼Œæ˜¯ä¸€ä¸ªä¼˜åŒ–çš„æ–¹å‘ã€‚</p><h4 id="Reference-3">Reference</h4><p><a href="https://www.kdd.org/kdd2016/papers/files/rfp0191-wangAemb.pdf">Structural Deep Network Embedding</a></p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Embedding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Embedding </tag>
            
            <tag> Graph Embedding </tag>
            
            <tag> SDNE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Embedding Introduction (V)</title>
      <link href="/2022/01/21/Embedding-Introduction-V/"/>
      <url>/2022/01/21/Embedding-Introduction-V/</url>
      
        <content type="html"><![CDATA[<h3 id="DeepWalk-çš„ä¼˜åŒ–-Node2Vec">DeepWalk çš„ä¼˜åŒ– - Node2Vec</h3><p>å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œdeepwalk ä¸»è¦æ˜¯åŸºäº DFS é‚»åŸŸçš„ graph embedding ç®—æ³•ï¼Œè€Œ LINE åˆ™æ˜¯åŸºäº BFS é‚»åŸŸçš„ graph embedding ç®—æ³•ã€‚æ¥ä¸‹æ¥ä»‹ç»çš„ node2vec åˆ™æ˜¯æ€»å’Œè€ƒè™‘ DFS ä¸ BFS çš„ graph embedding ç®—æ³•ï¼Œæ˜¯ç»“åˆ DFS ä¸ BFS çš„éšæœºæ¸¸èµ°çš„ deep walkã€‚</p><h4 id="ç®—æ³•åŸç†">ç®—æ³•åŸç†</h4><p>å®šä¹‰ï¼š</p><ol><li><p>$f(u)$ ä¸ºé¡¶ç‚¹ $u$ åˆ°å…¶å¯¹åº” embedding å‘é‡çš„æ˜ å°„</p></li><li><p>$N_S(u)$ ä¸ºåœ¨é‡‡æ ·ç­–ç•¥ $S$ ä¸‹é¡¶ç‚¹ $u$ çš„è¿‘é‚»é¡¶ç‚¹é›†åˆ</p></li></ol><p>è€Œ node2vec ä¼˜åŒ–çš„ç›®æ ‡æ¯”è¾ƒç›´æ¥ï¼Œå°±æ˜¯å¸Œæœ›æ‰¾åˆ°æœ€ä¼˜æ˜ å°„ $f(u)$ï¼Œä½¿è¿‘é‚»é¡¶ç‚¹å‡ºç°çš„æ¦‚ç‡æœ€å¤§åŒ–ï¼Œå³</p><p>$$<br>max_f\sum_{u \in V} \log Pr(N_s(u) | f(u))<br>$$</p><p>ä¸ºäº†ä½¿è¯¥æœ€ä¼˜åŒ–é—®é¢˜å¯è§£ï¼Œæ–‡ç« åšäº†ä¸¤ä¸ªå‡è®¾ï¼š</p><ol><li><p>æ¡ä»¶ç‹¬ç«‹æ€§å‡è®¾ã€‚å³åœ¨ç»™å®šé¡¶ç‚¹ $u$ ä¸‹ï¼Œå…¶è¿‘é‚»é¡¶ç‚¹å‡ºç°çš„æ¦‚ç‡ï¼Œä¸è¿‘é‚»é›†åˆä¸­å…¶ä»–é¡¶ç‚¹æ— å…³ã€‚å³</p><p>$$<br>Pr(N_s(u) | f(u)) = \prod_{n_i\in N_s(u)} Pr(n_i | f(u))<br>$$</p></li><li><p>ç‰¹å¾ç©ºé—´å¯¹ç§°æ€§å‡è®¾ã€‚ä¸ LINE ä¸åŒï¼Œå‡è®¾ä¸€ä¸ªé¡¶ç‚¹æ— è®ºæ˜¯ä½œä¸ºåŸé¡¶ç‚¹è¿˜æ˜¯è¿‘é‚»é¡¶ç‚¹ï¼Œå…¶å…±äº«åŒä¸€å¥— embedding å‘é‡ã€‚å¯¹åº”è¡¨è¾¾ä¸º</p><p>$$<br>Pr(n_i | f(u)) = \frac{\exp(f(n_i)\cdot f(u))}{\sum_{v\in V} \exp(f(v)\cdot f(u))}<br>$$</p></li></ol><p>æœ€ç»ˆï¼Œæ ¹æ®å‡è®¾æ¡ä»¶ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡å‡½æ•°è¡¨ç¤ºä¸º</p><p>$$<br>max_f\sum_{v\in V}\left[-\log Z_u + \sum_{n_i\in N_s(u)} f(n_i) \cdot f(u)\right]<br>$$</p><p>å…¶ä¸­ $Z_u = \sum_{n\in N_s(u)} \exp(f(n_i)\cdot f(u))$ çš„è®¡ç®—ä»£ä»·é«˜ï¼Œéœ€è¦é‡‡ç”¨è´Ÿé‡‡æ ·æŠ€æœ¯è¿›è¡Œä¼˜åŒ–ã€‚</p><h4 id="é‡‡æ ·ç­–ç•¥">é‡‡æ ·ç­–ç•¥</h4><p>ç›¸æ¯”éšæœºæ¸¸èµ° deep walk ä¸­çš„é‡‡æ ·æ–¹å¼ï¼Œ node2vec ä¹Ÿæ˜¯éšæœºæ¸¸èµ°ï¼Œä½†æ˜¯æ˜¯ä¸€ç§ä¾æ¦‚ç‡éšæœºæ¸¸èµ°ï¼Œè¿™ç§éšæœºæ¸¸èµ°æ˜¯æœ‰åçš„ã€‚</p><p>æ¯”å¦‚ç»™å®šå½“å‰é¡¶ç‚¹ $v$ï¼Œè®¿é—®ä¸‹ä¸€ä¸ªé¡¶ç‚¹ $x$ çš„æ¦‚ç‡æˆ‘ä»¬è®¾å®šä¸º</p><p>$$<br>P(c_i = x | c_{ - 1} = v) = \frac{\pi_{vx}}{Z} \text{, if } (v, x) \in E<br>$$</p><p>$$<br>P(c_i = x | c_{i - 1} = v) = 0  \text{, otherwise}<br>$$</p><p>å…¶ä¸­ $\pi_{vx}$ è¡¨ç¤ºé¡¶ç‚¹ $v$  ä¸é¡¶ç‚¹ $x$ ä¹‹é—´çš„è½¬ç§»æ¦‚ç‡ï¼ˆæœª normalizedï¼‰ï¼Œ $Z$ åˆ™æ˜¯å½’ä¸€åŒ–å¸¸æ•°</p><p>æ–‡ä¸­ node2vec å¼•å…¥ä¸¤ä¸ªå‚æ•° $p$ ä¸ $q$ æ¥æ§åˆ¶éšæœºæ¸¸èµ°çš„ç­–ç•¥ã€‚</p><p>$$<br>\pi_{vx} = \alpha_{pq}(t, x)\cdot w_{vx}<br>$$</p><p>å…¶ä¸­ $w_{vx}$ è¡¨ç¤ºé¡¶ç‚¹ $v$ ä¸ $x$ ä¹‹é—´çš„è¾¹æƒã€‚è€Œ $\alpha_{pq}$ åˆ™ä¸ä¸Šä¸€æ¬¡æ¸¸èµ°èµ·ç‚¹ $t$ å’Œå½“æ¬¡æ¸¸èµ°ç»ˆç‚¹ $x$ æœ‰å…³ï¼Œå¯çŸ¥ä¸¤ä¸ªé¡¶ç‚¹çš„è·ç¦» $d_{tx}$ å¯ä»¥æœ‰ä¸‰ä¸ªå–å€¼ï¼š</p><ul><li>$d_{tx} = 0$ï¼Œå³ä¸¤ç‚¹å±äºåŒä¸€ä¸ªç‚¹ï¼Œæ­¤æ—¶è®¾å®š $\alpha_{pq}(t, x) = \frac{1}{p}$ï¼Œæ‰€ä»¥ $p$ åˆè¢«ç§°ä¸º return parameterï¼Œè¡¨ç¤ºé©¬ä¸Šé‡æ–°è®¿é—®åŸæ¥ node çš„å¯èƒ½æ€§ã€‚</li><li>$d_{tx} = 1$ï¼Œå³ $t, x$ ä¸ $v$ ä¸‰ç‚¹å‡ç›¸é‚»ï¼Œæ­¤æ—¶è®¾å®š $\alpha_{pq}(t, x) = 1$</li><li>$d_{tx} = 2$ï¼Œå³ $x$ è¿œç¦» $t$ ç‚¹ï¼Œä¸¤ç‚¹ä¸ç›´æ¥ç›¸é‚»ï¼Œæ­¤æ—¶è®¾å®š $\alpha_{pq}(t, x) = \frac{1}{q}$ï¼Œæ‰€ä»¥ $q$ åˆè¢«ç§°ä¸º in-out parameterã€‚</li></ul><p>ä»è§£é‡Šä¸­å¯ä»¥çœ‹å‡ºï¼Œ $p, q$ å€¼çš„è®¾å®šï¼Œæè¿°äº†ç®—æ³•å¯¹ BFS ä¸ DFS random walk çš„å€¾å‘æ€§ã€‚å…·ä½“çš„å–å€¼å¯ä»¥é€šè¿‡ä¸‹å›¾ç›´è§‚çœ‹å‡º:</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction-V/node2vec_pm.png" alt="node2vec_parameter"></p><h4 id="ç®—æ³•ç­–ç•¥">ç®—æ³•ç­–ç•¥</h4><p>é‡‡æ ·é¡¶ç‚¹åºåˆ—åï¼Œåç»­çš„æ–¹å¼ä¸ deepwalk ä¸ LINE ä¸€è‡´ï¼Œå‡é€šè¿‡ word2vec çš„æ–¹æ³•å»å­¦ä¹  embedding å‘é‡ã€‚node2vec ä¸ LINE ä¸€æ ·ï¼Œæ˜¯ä¾æ¦‚ç‡æŠ½å–é‚»æ¥ç‚¹ï¼ŒåŒæ—¶é‡‡ç”¨ alias table ç®—æ³•è¿›è¡Œé‡‡æ ·ã€‚</p><p>å…¶æ ¸å¿ƒç®—æ³•ä¼ªä»£ç å¦‚ä¸‹ï¼š</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction-V/node2vec_algorithm.png" alt="node2vec_algorithm"></p><h4 id="Reference-2">Reference</h4><p><a href="https://www.kdd.org/kdd2016/papers/files/rfp0218-groverA.pdf">node2vec: Scalable Feature Learning for Networks</a></p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Embedding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Embedding </tag>
            
            <tag> Graph Embedding </tag>
            
            <tag> Node2Vec </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Embedding-Introduction (IV)</title>
      <link href="/2022/01/21/Embedding-Introduction-IV/"/>
      <url>/2022/01/21/Embedding-Introduction-IV/</url>
      
        <content type="html"><![CDATA[<h4 id="LINE">LINE</h4><p>æ¥ <a href="https://jason24-zeng.github.io/2022/01/20/Embedding-Introduction-III/">ä¸Šä¸€ç« èŠ‚</a></p><p>æˆ‘ä»¬å·²ç»å®šä¹‰å¥½å¤„ç† LINE çš„ä¸€é˜¶ä¸äºŒé˜¶ proximity çš„ç›®æ ‡å‡½æ•°ï¼Œè¿™ä¸€èŠ‚ä¸»è¦æ˜¯è®¨è®ºå‡½æ•°çš„ä¼˜åŒ–ã€‚</p><h4 id="æ¨¡å‹ä¼˜åŒ–">æ¨¡å‹ä¼˜åŒ–</h4><h6 id="å›é¡¾">å›é¡¾</h6><p>first-order proximity ç›®æ ‡å‡½æ•°</p><p>$$<br>O_1 = - \sum_{(i, j)\in E} w_{ij}\log p_1(v_i, v_j) \tag{1}<br>$$</p><p>second-order proximity ç›®æ ‡å‡½æ•°</p><p>$$<br>O_2 = - \sum_{(i, j)\in E} w_{ij} \log p_2(v_j|v_i) \tag{2}<br>$$</p><p>è®¡ç®— second-order proximity æ¶ˆè€—è¾ƒé«˜ï¼Œå› ä¸ºéœ€è¦è®¡ç®—æ¯ä¸ªé¡¶ç‚¹çš„æ¡ä»¶æ¦‚ç‡ï¼Œç„¶åæŠŠè¿™äº›æ¦‚ç‡åŠ å’Œã€‚ä¸ºäº†è§£å†³è¿™ä¸ªæ¶ˆè€—é—®é¢˜ï¼Œæ–‡ä¸­é‡‡ç”¨äº†è´Ÿé‡‡æ ·çš„æ–¹æ³•ï¼Œé€šè¿‡æ¯æ¡è¾¹çš„ä¸€äº›å™ªéŸ³åˆ†å¸ƒå»é‡‡æ ·å¤šæ¡è´Ÿè¾¹ã€‚å¯¹è¾¹ $(i, j)$ çš„ç›®æ ‡å‡½æ•°å˜ä¸ºï¼š</p><p>$$<br>\log\sigma(\vec{u_j}^{1T} \cdot \vec{u_i}) + \sum^K_{i = 1} E_{v_n \sim P_n(v)}\left[\log\sigma(\vec{u}_n^{1T} \cdot \vec{u}_i)\right] \tag{3}<br>$$</p><p>å…¶ä¸­ï¼Œ$\sigma(x) = 1 / (1 + \exp(-x))$ æ˜¯ sigmod å‡½æ•°ã€‚å‰ä¸€é¡¹åŸºäºè§‚å¯Ÿçš„è¾¹å»ºæ¨¡ï¼Œåä¸€é¡¹å¯¹ä»å™ªéŸ³åˆ†å¸ƒé‡‡æ ·å¾—åˆ°çš„è´Ÿè¾¹å»ºæ¨¡ã€‚$K$ è¡¨ç¤ºè´Ÿè¾¹çš„æ€»æ•°ã€‚æˆ‘ä»¬è®¾å®š $P_n(v) \propto d_v^{3/4}$ï¼Œè€Œ $d_v$ ä¸ºé¡¶ç‚¹ $v$ çš„å‡ºåº¦ã€‚</p><p>å¯¹äºç›®æ ‡å‡½æ•° $1$ï¼Œ å­˜åœ¨ä¸€ä¸ªå¹³å‡¡è§£ï¼š$\forall i k, u_{ik} = \infty$ã€‚ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä¾ç„¶ä½¿ç”¨æ–¹ç¨‹ $3$ ä¸­çš„è´Ÿé‡‡æ ·æ–¹æ³•ï¼Œåªæ˜¯æŠŠ $\vec{u_j}^{1T}$ æ¢æˆ $\vec{u_j}^{T}$ å³å¯ã€‚</p><p>ä¸ºäº†æœ€ä¼˜åŒ–æ–¹ç¨‹ $3$ï¼Œæ–‡ä¸­é‡‡ç”¨äº†å¼‚æ­¥éšæœºæ¢¯åº¦ç®—æ³•ï¼ˆasynchronous stochastic gradient algorithm, ASGDï¼‰ã€‚æ¯ä¸€æ­¥ï¼ŒASGD ç®—æ³•é‡‡æ ·äº†ä¸€ mini-batch çš„è¾¹ï¼Œç„¶åæ›´æ–°æ¨¡å‹å‚æ•°ã€‚å¦‚æœä¸€æ¡è¾¹ $(i, j)$ è¢«é‡‡æ ·ï¼Œåˆ™æ¢¯åº¦ (é¡¶ç‚¹ $i$ çš„embedding å‘é‡ $\vec{u_i}$) ä¼šè¢«ä½¿ç”¨ä¸€ä¸‹æ–¹ç¨‹è®¡ç®—</p><p>$$<br>\frac{\partial O_2}{\partial \vec{u_i}} = w_{ij}\cdot \frac{\partial \log p_2(v_j|v_i)}{\partial \vec{u_i}}<br>$$</p><p>è¿™æ ·çš„é—®é¢˜åœ¨äºæ¢¯åº¦ä¼šè¢«ä¹˜ä»¥è¾¹æƒï¼Œå½“è¾¹æƒæ–¹å·®è¾ƒå¤§æ—¶ï¼Œå¯èƒ½å‡ºç°é—®é¢˜ã€‚</p><p>ä¸Šé¢çš„é—®é¢˜ä¸»è¦å‡ºåœ¨å¯¹äºä¸åŒçš„è¾¹æƒï¼Œå›ºå®šçš„å­¦ä¹ ç‡ä¸åˆé€‚ã€‚æ‰€ä»¥ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ³•æ˜¯å°†è¾¹æƒä¸º $w$ çš„è¾¹ unfold æˆ $w$ æ¡ 0 - 1 è¾¹ã€‚è¿™å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ä¼šæ˜¾è‘—æå‡å†…å­˜å ç”¨ã€‚æ–‡ä¸­çš„è§£å†³æ–¹æ³•å®é™…ä¸Šæ˜¯ï¼Œå°† $w$ ä½œä¸ºä½œä¸ºæ¦‚ç‡åˆ†å¸ƒçš„æƒé‡ï¼Œéšæœºé‡‡æ ·æ ·æœ¬è¾¹ï¼Œå°†å–åˆ°çš„æ ·æœ¬è¾¹ä½œä¸º 0 - 1 è¾¹å»è®­ç»ƒã€‚è¿™ä¸ªæƒ³æ³•ä¸ XGBoost ä¸­çš„ç›´æ–¹å›¾æ€æƒ³å¦‚å‡ºä¸€è¾™ã€‚</p><p>è€Œéšæœºé‡‡æ ·è¦è¾¾åˆ°ç©ºé—´æ—¶é—´ä¸Šçš„æœ€ä¼˜è¿˜è¦è€ƒè™‘ä¸€äº›ç®—æ³•ä¸Šçš„ä¼˜åŒ–ã€‚æˆ‘ä»¬å‡è®¾ $W = (w_1, w_2, â€¦, w_{|E|})$ è¡¨ç¤ºä¸€ç³»åˆ—è¾¹çš„æƒé‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¡ç®—ä¸€ä¸ª $w_{sum} = \sum_{i = 1}^{|E|}$ ä½œä¸ºéšæœºæ•°çš„ä¸Šç•Œï¼Œåˆ¤æ–­è¿™ä¸ªéšæœºæ•°å¤„äºå“ªä¸ªåŒºé—´ï¼Œä¾¿èƒ½ sample å‡ºè¾¹ï¼Œè¿™æ ·çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦æ˜¯ $O(|E|)$ ï¼Œåœ¨è¾¹å¾ˆå¤šçš„æƒ…å†µä¸‹æ—¶é—´èŠ±é”€è¾ƒå¤§ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <a href="https://blog.csdn.net/haolexiao/article/details/65157026">alias table æ–¹æ³•</a>ï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥å† $O(1)$ çš„æ—¶é—´å¤æ‚åº¦ä¸‹ä»å›ºå®šçš„ç¦»æ•£åˆ†å¸ƒé‡Œæ ¹æ®æƒé‡ç­›é€‰æ ·æœ¬ã€‚</p><p>ç”±æ­¤ï¼Œæˆ‘ä»¬å¯çŸ¥ï¼Œé‡‡æ ·ä¸€æ¡è¾¹éœ€è¦ $O(1)$ çš„æ—¶é—´å¤æ‚åº¦ï¼Œé‚£ä¹ˆè´Ÿé‡‡æ ·ä¼˜åŒ–åæ•´ä½“çš„æ—¶é—´èŠ±é”€ä¸º $O(d(K + 1))$ ï¼Œ$K$ ä¸ºè´Ÿé‡‡æ ·æ•°é‡ã€‚å› æ­¤ï¼Œæ¯ä¸€æ­¥è¿­ä»£ä¼šèŠ±è´¹ $O(dK)$ æ¬¡ã€‚è€Œå®é™…æƒ…å†µä¸‹ï¼Œæ¯æ¬¡æ¶ˆè€—çš„æ—¶é—´æ­£æ¯”äºè¾¹çš„æ•°é‡ $|E|$ã€‚å› æ­¤ï¼ŒLINE çš„æ•´ä½“æ—¶é—´å¤æ‚åº¦æ˜¯ $O(dK|E|)$ï¼Œä¸é¡¶ç‚¹æ•°é‡æ— å…³ã€‚</p><h6 id="æ€»ç»“">æ€»ç»“</h6><p>ä»ä¸Šé¢çš„ç†è®ºæ¨åˆ°å¯ä»¥çœ‹å‡ºï¼Œè¾¹çš„é‡‡æ ·ç­–ç•¥åœ¨ä¸å½±å“æ•´ä½“æ•ˆæœçš„å‰æä¸‹æå‡äº†éšæœºæ¢¯åº¦ä¸‹é™çš„æ•ˆç‡ã€‚</p><h1></h1>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Embedding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Embedding </tag>
            
            <tag> Graph Embedding </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Embedding Introduction (III)</title>
      <link href="/2022/01/20/Embedding-Introduction-III/"/>
      <url>/2022/01/20/Embedding-Introduction-III/</url>
      
        <content type="html"><![CDATA[<h3 id="Embedding-åœ¨äº’è”ç½‘åœºæ™¯çš„ä½¿ç”¨-Graph-Embedding">Embedding åœ¨äº’è”ç½‘åœºæ™¯çš„ä½¿ç”¨ - Graph Embedding</h3><p>ä¹‹å‰è®²çš„ word2vec å’Œ item2vec å®é™…ä¸Šéƒ½æ˜¯åœ¨ä¸€ä¸ªåºåˆ—çš„åŸºç¡€ä¸Šè·å¾—å¯¹è±¡çš„éšå¼å‘é‡è¡¨è¾¾çš„ã€‚ä½†æ˜¯åœ¨äº’è”ç½‘åœºæ™¯ä¸‹ï¼Œæ•°æ®å¯¹è±¡ä¹‹å‰å¯èƒ½æ›´å¤šå¾—å‘ˆç°çš„æ˜¯å›¾ç»“æ„ï¼Œæ¯”å¦‚ä½¿ç”¨ç”¨æˆ·è¡Œä¸ºç”Ÿæˆçš„ç‰©å“å…¨å±€å…³ç³»å›¾ï¼Œæˆ–è€…ç‰©å“å±æ€§çŸ¥è¯†å›¾è°±ç­‰ã€‚è¿™ç§èƒŒæ™¯ä¸‹ï¼Œä¼ ç»Ÿçš„åºåˆ— embedding æ–¹æ³•æ— æ³•å¾ˆå¥½å¤„ç†ï¼Œå› æ­¤ï¼Œå¯¹å›¾ç»“æ„ä¸­èŠ‚ç‚¹è¿›è¡Œè¡¨è¾¾çš„ graph embedding ä¾¿æˆäº†æ–°çš„ç ”ç©¶æ–¹å‘ã€‚éšç€å¤§æ•°æ®æ—¶ä»£çš„åˆ°æ¥ï¼Œæ¨èç³»ç»Ÿæ„ˆå‘é‡è¦ï¼Œè¿™é¡¹æŠ€æœ¯ä¹Ÿå› æ­¤æ„ˆå‘å—åˆ°é‡è§†ã€‚</p><h3 id="Graph-Embedding-æ—©æœŸæ–¹æ³•-Deep-Walk">Graph Embedding æ—©æœŸæ–¹æ³• - Deep Walk</h3><p>åŸºäºéšæœºæ¸¸èµ°ç”Ÿæˆå›¾ç»“æ„å¯¹åº”çš„èŠ‚ç‚¹åºåˆ—ï¼Œæ˜¯æ—©æœŸ Graph Embedding çš„ä¸€ç§é‡è¦æ–¹æ³•ã€‚å…¶å…è®¸é‡å¤è®¿é—®å·²è®¿é—®èŠ‚ç‚¹ï¼Œä½¿ç”¨æ·±åº¦ä¼˜å…ˆï¼ˆDFSï¼‰è¿›è¡Œåºåˆ—ç”Ÿæˆã€‚</p><p>å…¶æ€è·¯æ˜¯ï¼Œç»™å®šä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡éšæœºé‡‡æ ·çš„æ–¹æ³•ï¼Œè·å¾—è¯¥èŠ‚ç‚¹ç›¸é‚»èŠ‚ç‚¹ä¸­çš„ä¸€ä¸ªï¼Œä»¥æ­¤ä½œä¸ºåºåˆ—çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚é‡å¤ä¸Šè¿°æ­¥éª¤ï¼ŒçŸ¥é“åºåˆ—é•¿åº¦è¾¾åˆ°é¢„æœŸé•¿åº¦ã€‚å†ä½¿ç”¨ skip-gram word2vec çš„æ–¹æ³•è¡¨è¾¾å‘é‡ã€‚ä½¿ç”¨äº† Hierachical Softmax ä¸­æ„é€  Huffman æ ‘çš„æŠ€å·§ä¼˜åŒ–äº† softmax çš„æ—¶é—´å¤æ‚åº¦</p><p>å…¶ä¼ªä»£ç è¡¨ç¤ºä¸ºï¼š</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction-III/fake_coding.png" alt="graph embedding deep walk algorithm"></p><p>ä½¿ç”¨éšæœºæ¸¸èµ°çš„æ–¹æ³•åˆ›å»ºè®­ç»ƒæ•°æ®ï¼Œè¿™ç§æ–¹æ³•çš„ç‰¹ç‚¹ï¼š</p><ul><li><p>å¯ä»¥å®ç°æœºå™¨ã€è¿›ç¨‹æˆ–çº¿ç¨‹ç»´åº¦çš„å¹¶è¡Œ</p></li><li><p>é€‚åˆåŠ¨æ€æ›´æ–°ï¼Œæ›´æ–°æ—¶åªå¯¹æ–°å¢èŠ‚ç‚¹å¢åŠ </p></li></ul><p>è¯¥ç®—æ³•çš„è¶…å‚æ•°æœ‰ï¼š</p><ul><li><p>skip-gram çš„çª—å£å¤§å° $w$</p></li><li><p>ç”Ÿæˆå‘é‡çš„ç»´åº¦ï¼Œéšè—å±‚çš„ç¥ç»å…ƒä¸ªæ•° $d$</p></li><li><p>æ¯ä¸ªèŠ‚ç‚¹çš„æ¸¸èµ°æ¬¡æ•° $\gamma$</p></li><li><p>æ¸¸èµ°é•¿åº¦ $t$</p></li></ul><p>å¯è®¤ä¸º DeepWalk æ˜¯ Graph Embedding çš„ baseline æ–¹æ³•ã€‚</p><p>å‚è€ƒï¼š<a href="https://arxiv.org/pdf/1403.6652.pdf">DeepWalk: Online Learning of Social Representations</a></p><h3 id="Large-scale-Information-Network-Embedding-LINE">Large-scale Information Network Embedding (LINE)</h3><p>LINE å°†éå¸¸å¤§çš„ä¿¡æ¯ç½‘ç»œæ˜ å°„åˆ°äº†ä½ç»´å‘é‡ç©ºé—´ï¼ˆembeddingï¼‰ä¸­ï¼Œå¯¹å¯è§†åŒ–ï¼ŒèŠ‚ç‚¹åˆ†ç±»ç­‰é—®é¢˜éƒ½æœ‰ä¸é”™çš„æ•ˆæœã€‚å…¶ç›¸å¯¹ DeepWalk è¿™ç§çº¯ç²¹éšæœºæ¸¸èµ°çš„åºåˆ—ç”Ÿæˆæ–¹å¼æœ‰ä»¥ä¸‹ä¸¤ä¸ªç‰¹ç‚¹ï¼š</p><ol><li><p>å¯ä»¥åº”ç”¨åˆ°æœ‰å‘å›¾ã€æ— å‘å›¾ä»¥åŠè¾¹æœ‰æƒé‡çš„ç½‘ç»œ</p></li><li><p>ä½¿ç”¨ä¸€é˜¶ã€äºŒé˜¶çš„ä¸´è¿‘å…³ç³»å¼•å…¥ç›®æ ‡å‡½æ•°ï¼Œä»è€Œä½¿æœ€ç»ˆå­¦å‡ºçš„ node embedding çš„åˆ†å¸ƒæ›´åŠ å‡åŒ€å¹³æ»‘ï¼Œé¿å… node embedding èšé›†çš„æƒ…å†µå‘ç”Ÿ</p></li><li><p>é€‚ç”¨äºå¤§è§„æ¨¡ network ä¸Šè¿›è¡Œåº”ç”¨(Deep Walk ä¹Ÿé€‚ç”¨)</p></li></ol><h4 id="é—®é¢˜å®šä¹‰">é—®é¢˜å®šä¹‰</h4><h5 id="Information-Network">Information Network</h5><p>$G = (V, E)$ å…¶ä¸­ $V$ æ˜¯ vertex èŠ‚ç‚¹é›†åˆï¼Œ$E$ æ˜¯ edge è¾¹é›†åˆã€‚å®šä¹‰ $e = (u, v) \in E$ æ˜¯ä¸€ä¸ªæœ‰åºçš„èŠ‚ç‚¹å¯¹ï¼Œè¾¹æƒ $W_{uv} &gt; 0$ã€‚å¦‚æœ $G$ ä¸ºæ— å‘å›¾ (undirected graph)ï¼Œåˆ™æœ‰ $(u, v) = (v, u)$ ä¸ $W_{uv} =  W_{vu}$ã€‚è€Œå¦‚æœ $G$ ä¸ºæœ‰å‘å›¾ (directed graph)ï¼Œé‚£ä¹ˆæœ‰ $(u, v) \neq (v, u)$ ä¸ $W_{uv} \neq W_{vu}$</p><h5 id="First-order-Proximity-local-network-structure-ä¸€é˜¶è¿‘é‚»å…³ç³»">First-order Proximity (local network structure) ä¸€é˜¶è¿‘é‚»å…³ç³»</h5><p>è¾¹æƒ $W_{uv}$ å°±è¡¨ç¤ºèŠ‚ç‚¹ $u$ ä¸ $v$ ä¹‹é—´çš„ first-order proximityã€‚ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´ç›¸è¿çš„è¾¹æƒé‡è¶Šé«˜ï¼Œåˆ™è¿™ä¸¤ä¸ªç‚¹è¶Šç›¸ä¼¼ã€‚è‹¥ä¸¤ç‚¹ä¹‹é—´æ²¡æœ‰è¾¹ï¼Œåˆ™ first-order proximity ä¸º 0</p><h5 id="Second-order-Proximity-global-netword-structure-äºŒé˜¶è¿‘é‚»å…³ç³»">Second-order Proximity (global netword structure) äºŒé˜¶è¿‘é‚»å…³ç³»</h5><p>é¦–å…ˆå®šä¹‰ä¸€ä¸ª $P_u = (W_{u,1},â€¦, W_{u, |V|})$ ä¾¿æ˜¯èŠ‚ç‚¹ $u$ ä¸å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹çš„ first-order proximity ç»„æˆçš„é›†åˆã€‚$u$ ä¸ $v$ ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œåˆ™å¯ä»¥é€šè¿‡ $P_u$ ä¸ $P_v$ ä¹‹é—´çš„æƒé‡é‡åˆç¨‹åº¦æ¥å†³å®šç›¸ä¼¼åº¦ã€‚ä¸¤ä¸ªèŠ‚ç‚¹çš„ neighbors é‡å¤å¾—è¶Šå¤šï¼Œä¸¤è€…è¶Šç›¸ä¼¼ã€‚ç‰¹åˆ«çš„ï¼Œå¦‚æœæ²¡æœ‰èŠ‚ç‚¹åŒæ—¶æŒ‡å‘ $u$ ä¸ $v$ æˆ–è€… è¢« $u$ ä¸ $v$ æ‰€æŒ‡å‘ï¼Œåˆ™ $u$ ä¸ $v$ ä¹‹é—´çš„ second-order proximity ä¸º 0ã€‚</p><p>å¦‚ä¸‹å›¾çš„ä¸€ä¸ª Information Netword çš„ toy modelï¼Œå¯ä»¥çœ‹å‡º 5 ä¸ 6 ä¹‹é—´æœ‰è¾ƒé«˜çš„ second-order proximityï¼Œè€Œ 6 ä¸ 7 ä¹‹é—´æœ‰è¾ƒé«˜çš„ first-order proximityã€‚</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction-III/line_information_network.png" alt="Information Network"></p><h5 id="Large-scale-Information-Network-Embedding">Large-scale Information Network Embedding</h5><p>ä½¿ç”¨ä¸€ä¸ªä½ç»´å‘é‡å»è¡¨ç¤ºæ•´ä¸ª Information Networkï¼Œå³å­¦ä¹ ä¸€ä¸ªå‡½æ•°ï¼š</p><p>$$<br>f_G : V \rightarrow R^d, where \ d \ll|V|<br>$$</p><h4 id="æ¨¡å‹æè¿°">æ¨¡å‹æè¿°</h4><p>å¦‚å‰é¢æ‰€è¯´ï¼Œä¸€ä¸ªå¥½çš„ Information Network Embedding æ—¢éœ€è¦æœ‰ first-order proximity çš„ä¿¡æ¯ï¼Œä¹Ÿä¸èƒ½å¿½è§† second-order proximityã€‚</p><h5 id="è€ƒè™‘-first-order-proximity-è¿›è¡Œå»ºæ¨¡">è€ƒè™‘ first-order proximity è¿›è¡Œå»ºæ¨¡</h5><p>å¯¹äºæ¯ä¸ªæ— å‘è¾¹ $(i,j)$ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ç‚¹ $v_i$ ä¸ $v_j$ çš„è”åˆæ¦‚ç‡å¦‚ä¸‹ï¼š</p><p>$$<br>p_1(v_i, v_j) = \frac{1}{1 + \exp(-\vec{u_i}^T\cdot\vec{u_j})} \tag{1}<br>$$</p><p>å…¶ä¸­ï¼Œ$\vec{u_i}\in R^d$ æ˜¯èŠ‚ç‚¹ $v_i$ çš„ä½ç»´å‘é‡è¡¨è¾¾ã€‚æ–¹ç¨‹ $1$ å®šä¹‰äº†ä¸€ä¸ªåœ¨ç©ºé—´ $V \times V$ çš„åˆ†å¸ƒå‡½æ•°ï¼Œå®ƒçš„ç»éªŒæ¦‚ç‡å¯ä»¥è¢«å®šä¹‰ä¸º</p><p>$$<br>\hat{p_1}(i,j) = w_{ij}/W<br>$$</p><p>å…¶ä¸­ï¼Œ</p><p>$$<br>W = {\sum_{(i, j)\in E} w_{ij}}<br>$$</p><p>ä¸ºäº†ç»´æŠ¤ first-order proximityï¼Œä¸€ä¸ªç›´ç™½çš„æƒ³æ³•æ˜¯æœ€å°åŒ–ç›®æ ‡å‡½æ•°</p><p>$$<br>O_1 = d(\hat{p}_1(\cdot ,\cdot), p_1(\cdot ,\cdot)) \tag{2}<br>$$</p><p>å…¶ä¸­ $d(\cdot ,\cdot)$ ä¸ºä¸¤ä¸ªåˆ†å¸ƒä¹‹é—´çš„è·ç¦»ï¼Œè¿™ä¸ªè·ç¦»æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ KL æ•£åº¦æ¥è¡¨è¾¾ï¼ŒåŒæ—¶å–å‡ºå…¶ä¸­çš„å¸¸æ•°é¡¹ï¼Œæˆ‘ä»¬å°±æœ‰ï¼š</p><p>$$<br>O_1 = - \sum_{(i, j)\in E} w_{ij}\log p_1(v_i, v_j) \tag{3}<br>$$</p><p>éœ€è¦æ³¨æ„åˆ° first-order proximity åªå¯¹æ— å‘å›¾æœ‰ç”¨ã€‚é€šè¿‡æ‰¾åˆ°é›†åˆ ${\vec{u_i}}_{i = 1â€¦|V|}$ ï¼Œä½¿æ–¹ç¨‹ $3$ç›®æ ‡å‡½æ•°æœ€å°åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ $d$ ç»´ç©ºé—´ä¸­è¡¨ç¤ºæ¯ä¸ªèŠ‚ç‚¹ã€‚</p><h5 id="è€ƒè™‘-second-order-proximity-å»ºæ¨¡">è€ƒè™‘ second-order proximity å»ºæ¨¡</h5><p>second-order proximity å¯¹æœ‰å‘å›¾ä¸æ— å‘å›¾éƒ½å¯è¡Œã€‚åœ¨è€ƒè™‘ second-order proximity  æ˜¯ï¼ŒèŠ‚ç‚¹æ‰®æ¼”äº†ä¸¤ä¸ªè§’è‰²ï¼š</p><ul><li><p>èŠ‚ç‚¹æœ¬èº«</p></li><li><p>å…¶ä»–èŠ‚ç‚¹çš„ä¸Šä¸‹æ–‡ context</p></li></ul><p>ä¸ºäº†åŒºåˆ†è¿™ä¸¤ä¸ªè§’è‰²ï¼Œæˆ‘ä»¬å¼•å…¥äº†ä¸¤ä¸ªå‘é‡ $\vec{u}_i$ ä¸ $\vec{u}'_i$ï¼Œåˆ†åˆ«å¯¹åº”é­”å¶ä¸ªèŠ‚ç‚¹ $v_i$ çš„ä¸Šè¿°ä¸¤ç§è§’è‰²çš„è¡¨è¾¾ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªä¸Šä¸‹æ–‡ $v_j$ è¢« $v_i$ äº§ç”Ÿçš„æ¦‚ç‡:</p><p>$$<br>p_2(v_j|v_i) = \frac{\exp(\vec{u}_iâ€™^T \cdot \vec{u}_j)}{W(\vec{u}_j)} \tag{4}<br>$$</p><p>å…¶ä¸­ï¼Œ</p><p>$$<br>W(\vec{u}_j) = \sum \exp(\vec{u}_kâ€™^T \cdot \vec{u}_j)<br>$$</p><p>è¯¥æ–¹ç¨‹å®é™…å®šä¹‰äº†ä¸€ä¸ªç½‘ç»œé‡Œæ‰€æœ‰èŠ‚ç‚¹ä¸ºèŠ‚ç‚¹ $v_i$ context çš„æ¡ä»¶æ¦‚ç‡ã€‚å¦‚æœ $p2(\cdot | v2)$ ä¸ $p2(\cdot | v1)$ çš„æ¦‚ç‡åˆ†å¸ƒç›¸ä¼¼ï¼Œåˆ™è¿™ä¸¤ä¸ªç‚¹çš„ second-order proximity æ˜¯ç›¸ä¼¼çš„ã€‚</p><p>ä¸ºäº†ç»´æŠ¤ second-order proximityï¼Œæˆ‘ä»¬éœ€è¦é€¼è¿‘ç»éªŒåˆ†å¸ƒå‡½æ•° $\hat{p}_2(\cdot | v_i)$ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦æœ€å°åŒ–ä¸€ä¸‹ç›®æ ‡å‡½æ•°</p><p>$$<br>O_2 = \sum_{i \in V} \lambda_i d(\hat{p}_2(\cdot|v_i), p_2(\cdot|v_i)) \tag{5}<br>$$</p><p>å› ä¸ºç½‘ç»œä¸­æ¯ä¸ªèŠ‚ç‚¹çš„é‡è¦æ€§ä¸åŒï¼Œæˆ‘ä»¬å¼•å…¥ $\lambda_i$ è¡¨è¾¾ç½‘ç»œä¸­èŠ‚ç‚¹ $i$ çš„ä¼˜å…ˆçº§ï¼Œå®ƒå¯ä»¥é€šè¿‡åº¦æ•°è¡¡é‡ (éœ€è¦è¿›ä¸€æ­¥æ¢è®¨ï¼Œåº”è¯¥æ˜¯å›¾è®ºä¸­çš„å‡ºå…¥åº¦è®¡ç®—) æˆ–è€…é€šè¿‡ä¸€äº›ç®—æ³•é¢„ä¼° (æ¯”å¦‚ PageRank)ã€‚</p><p>ç»éªŒåˆ†å¸ƒ</p><p>$$<br>\hat{p_2} (\cdot \vert v_i) = w_{ij} / d_i<br>$$</p><p>å…¶ä¸­ $w_{ij}$ ä¸ºè¾¹ $(i,j)$ çš„æƒé‡ï¼Œ $d_i = \sum_{k\in N(i)}  w_{ik}$ è¡¨ç¤ºé¡¶ç‚¹ $i$ çš„å‡ºåº¦ (out-degree), $N(i)$ åˆ™æ˜¯èŠ‚ç‚¹ $v_i$ çš„ out-neighborsã€‚</p><p>åœ¨æ–‡ç« ä¸­ï¼Œç®€å•å¾—å°† $\lambda_i$ è®¾æˆé¡¶ç‚¹ $i$ çš„åº¦æ•°ï¼Œå³ $\lambda_i = d_i$ï¼Œ åŒæ—¶é‡‡ç”¨ KL æ•£åº¦ä½œä¸ºè·ç¦»æ–¹ç¨‹ï¼ŒåŒæ—¶å»æ‰å¸¸æ•°é¡¹ï¼Œåˆ™æœ€ç»ˆæˆ‘ä»¬ç›®æ ‡å‡½æ•°å˜ä¸º</p><p>$$<br>O_2 = - \sum_{(i, j)\in E} w_{ij} \log p_2(v_j|v_i)<br>$$</p><p>é€šè¿‡å­¦ä¹ é›†åˆ ${\vec{u_i}}_{i = 1â€¦|V|} $ ä¸</p><p>$ {\vec{u_i}'}_{i = 1â€¦|V|}$ æœ€å°åŒ–ç›®æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª $d$ ç»´å‘é‡ $\vec{u_i}$ è¡¨è¾¾æ¯ä¸€ä¸ªé¡¶ç‚¹ã€‚</p><h5 id="Combine-ä¸€é˜¶ä¸äºŒé˜¶-proximity">Combine ä¸€é˜¶ä¸äºŒé˜¶ proximity</h5><p>æ–‡ç« ä¸­åˆ†åˆ«è®­ç»ƒä¸€é˜¶ proximity å’Œ äºŒé˜¶ proximityï¼Œç„¶åå°†å¾—åˆ°çš„ embedding æ‹¼èµ·æ¥ä½œä¸ºè¯¥é¡¶ç‚¹çš„ embedding è¡¨è¾¾ã€‚ä¸€ä¸ªæ›´åŸåˆ™æ€§çš„æ–¹å¼æ˜¯å°†ç›®æ ‡å‡½æ•°è”ç«‹èµ·æ¥æ±‚ã€‚</p><p>å‚è€ƒï¼š<a href="https://arxiv.org/pdf/1503.03578.pdf">LINE: Large-scale Information Network Embedding</a></p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Embedding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Embedding </tag>
            
            <tag> Graph Embedding </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Embedding Introduction (II)</title>
      <link href="/2022/01/20/Embedding-Introduction-II/"/>
      <url>/2022/01/20/Embedding-Introduction-II/</url>
      
        <content type="html"><![CDATA[<h4 id="ç”Ÿæˆ-Embedding-çš„æ–¹æ³•-II">ç”Ÿæˆ Embedding çš„æ–¹æ³• (II)</h4><h4 id="Item2Vec-Word2Vec-çš„è¡ç”Ÿ">Item2Vec : Word2Vec çš„è¡ç”Ÿ</h4><p>Word2Vec é‚£ç§ç”¨å‘é‡ embedding å»è¡¨è¾¾å•è¯çš„æ–¹æ³•å› å…¶ state-of-art çš„æ€§èƒ½è€Œåœ¨ NLP é¢†åŸŸå¤‡å—å…³æ³¨ã€‚åŒæ ·çš„ï¼Œè¿™ç§æŠ€æœ¯/æŠ€å·§åœ¨ æ¨èç³»ç»Ÿé¢†åŸŸä¹Ÿå—åˆ°äº†è¿½æ§ã€‚ç‰¹åˆ«çš„ï¼Œé€šè¿‡ä½¿ç”¨ skip-gram using negative sampling çš„ i2i ååŒè¿‡æ»¤(CF) ç®—æ³•å› ä¸ºæ¯”è‚© SVN CF ç®—æ³•è€Œå—åˆ°æ¨å´‡ã€‚è¿™è¾¹åšå®¢ï¼Œä¹Ÿä¸»è¦è®²è§£ Item2Vec ä¸­çš„ä¸€äº›ç‰¹ç‚¹ã€‚</p><h4 id="Skip-gram-with-negative-sampling-SGNS">Skip-gram with negative sampling (SGNS)</h4><p>Reference: <a href="https://arxiv.org/pdf/1301.3781.pdf%C3%AC%E2%80%94%20%C3%AC%E2%80%9E%C5%93">Efficient estimation of word representations in vector space</a></p><p>SGNS æ–¹æ³•æ—¨åœ¨æ‰¾åˆ°å•è¯çš„è¡¨è¾¾ï¼Œä½¿å…¶èƒ½å¤ŸæŠ“ä½è¯¥å•è¯ä¸å¥å­ä¸­å‘¨å›´å•è¯çš„å…³ç³»ã€‚</p><p>æˆ‘ä»¬ç”¨ $(w_i)^K_{i = 1}$ è¡¨ç¤ºä¸€æ‰¹è¿ç»­çš„å•è¯ï¼Œå…¶ä¸­ï¼Œè¿™äº›è¯éƒ½æ¥è‡ªäºä¸€ä¸ªæœ‰é™è¯æ±‡é›† $W = {w_i}^W_{i=1}$ã€‚ ä»è€Œï¼Œæˆ‘ä»¬å¯ä»¥è¡¨è¾¾ skip - gram çš„ç›®æ ‡ï¼Œæœ€å¤§åŒ–ï¼š</p><p>$$<br>\frac{1}{K} \sum^K_{i = 1} \sum_{-c &lt;= j &lt;= c, j \neq 0} \log{p(w_{i + j} | w_i)} \tag{1}<br>$$</p><p>å…¶ä¸­ï¼Œ$c$ æ˜¯ä¸Šä¸‹æ–‡çš„çª—å£å¤§å°ï¼Œè¯¥å¤§å°å¯èƒ½å–å†³äº $w_i$ã€‚è€Œ $p(w_{i + j} | w_i)$ åˆ™æ˜¯ softmax å‡½æ•°ï¼š</p><p>$$<br>p(w_{i + j} | w_i) = \frac{\exp(u^T_iv_j)}{\sum_{k\in I_w}\exp(u^T_iv^T_k)}<br>$$</p><p>å…¶ä¸­ $u_i\in U(\mathcal{R^m}) $ å’Œ $v_i \in V(\mathcal{R^m})$ åˆ†åˆ«æ˜¯ $w_i \in W$ ä¸­å…³äºç›®æ ‡å’Œä¸Šä¸‹æ–‡è¡¨è¾¾çš„éšå‘é‡ã€‚$m$ é€šå¸¸é€šè¿‡ç»éªŒä¸æ•°æ®é›†çš„å¤§å°å»é€‰æ‹©ã€‚ä½¿ç”¨ softmax å‡½æ•°ä¸å¤ªç°å®ï¼Œå› ä¸ºè®¡ç®— $\nabla p(w_{i + j} | w_i)$ çš„æ—¶é—´å¤æ‚åº¦æ˜¯çº¿æ€§çš„ï¼Œä¸è¯æ±‡é›†çš„å¤§å°æœ‰å…³ã€‚</p><h5 id="è´Ÿé‡‡æ ·">è´Ÿé‡‡æ ·</h5><p>ä¸ºäº†ä¸å¤§å¹…å½±å“ç²¾åº¦çš„æƒ…å†µä¸‹ç¯èŠ‚ä¸Šè¿°è®¡ç®—é—®é¢˜ã€‚æˆ‘ä»¬å°†ä¸Šé¢çš„ softmax å‡½æ•°æ¢æˆäº†</p><p>$$<br>p(w_{i + j} | w_i) = \sigma(u^T_iv_j)\prod^N_{k=1} \sigma(u^T_iv^T_k)<br>$$</p><p>å…¶ä¸­ï¼Œ$\sigma(x) = \frac{1}{1 + \exp(-x)}$ï¼Œ$N$ æ˜¯ä¸€ä¸ªå†³å®šæ¯ä¸ªæ­£æ ·æœ¬æ‰€éœ€è´Ÿä¾‹æ ·æœ¬æ•°çš„å‚æ•°ã€‚è€Œ $w_i$ ä¸­çš„è´Ÿæ ·æœ¬åŸåˆ™æ¦‚ç‡é€šè¿‡ä¸€å…ƒæ¨¡å‹å‡½æ•°ï¼ˆUnigram Distributionï¼‰ $f(w_i)$ çš„ $\frac{3}{4}$ æ¬¡æ–¹æ¥è·å¾—ã€‚æ•´ä¸ªå…¬å¼ä¸ºï¼š</p><p>$$<br>P(w_i) = \frac{f(w_i)^{3/4}}{\sum_{j = 0}^n(f(w_i)^{3/4})}<br>$$</p><p>è¿™ä¸ªä¸€å…ƒå‡½æ•°å®é™…ä¸Šå°±æ˜¯å°†æ ·æœ¬ä¸­çš„æ‰€æœ‰è¯å†™åˆ°äº†ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œé‡å¤çš„è¯é‡å¤å†™åˆ°æ•°ç»„çš„ä¸åŒä½ç½®(ä½¿ç”¨æ¯ä¸ªå•è¯çš„ç´¢å¼•å¡«å……)ï¼Œç›´æ¥é€šè¿‡ç”Ÿæˆéšæœºæ•°çš„æ–¹å¼å»è¿”å›è¯¥éšæœºæ•°å¯¹åº”ä½ç½®çš„æ•°ã€‚å¦‚æ­¤ä¾èµ–ï¼Œå¦‚æœæ•°ç»„ä¸­å‡ºç°æ¬¡æ•°å¤šçš„æ•°ï¼Œè¢«è´Ÿé‡‡æ ·çš„æ¦‚ç‡å°±æ›´å¤§ã€‚</p><p>ä½¿ç”¨ $\frac{3}{4}$ æ¬¡æ–¹ï¼Œæ›´å¤šçš„æ˜¯ä¸€ç§ç»éªŒæ•ˆæœï¼Œå¥½äºå•çº¯ç”¨ä¸€å…ƒå‡½æ•°æ¨¡å‹ã€‚</p><h5 id="é™é‡‡æ ·">é™é‡‡æ ·</h5><p>é™¤æ­¤ä»¥å¤–ï¼Œä¸ºäº†è§£å†³ç¨€æœ‰ä¸é«˜é¢‘è¯çš„ä¸å¹³è¡¡é—®é¢˜ï¼Œæ–‡ç« ä¸­æå‡ºäº†ä¸€ç§é™é‡‡æ ·çš„æ–¹æ³•ã€‚</p><p>å·²çŸ¥ä¸€ä¸ªè¾“å…¥è¯åºåˆ—ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ªæ¦‚ç‡å»ä¸¢å¼ƒæ¯ä¸ªè¯ï¼š</p><p>$$<br>p(discard | w) = 1 - \sqrt{\frac{\rho}{f(w)}}<br>$$</p><p>å…¶ä¸­ $f(w)$ ä¸ºè¯¥è¯çš„è¯é¢‘ï¼Œ$\rho$ ä¸ºä¸€ä¸ªé¢„è®¾é˜ˆå€¼ã€‚è¿™ä¸ªæ“ä½œæ®æŠ¥é“èƒ½æå‡è®­ç»ƒè¿›ç¨‹ï¼Œå¹¶å¤§å¹…æå‡ç¨€æœ‰è¯çš„è¡¨è¾¾ã€‚</p><p>ä»¥ä¸Šå°±æ˜¯<strong>SGNS</strong> çš„ä¸¤å¤§æ“ä½œ è´Ÿé‡‡æ · ä¸ é™é‡‡æ ·ã€‚</p><h4 id="Item2Vec-æ€è·¯">Item2Vec æ€è·¯</h4><p>SGNS æ–¹æ³•è¢«ä½¿ç”¨åˆ°äº† item-based çš„ååŒè¿‡æ»¤æ¨èç³»ç»Ÿä¸­ã€‚æœ‰äº›åœºæ™¯ï¼Œæˆ‘ä»¬æ²¡åŠæ³•è¾¾åˆ°ç”¨æˆ·ä¸ä¸€ç³»åˆ—å•†å“ä¹‹é—´çš„å…³è”ä¿¡æ¯ï¼Œè¿™æ—¶å€™ï¼Œé€šè¿‡å•†å“ä¾§åšçš„ååŒè¿‡æ»¤å°±å°¤ä¸ºé‡è¦ã€‚ä½¿ç”¨ SGNS çš„æƒ³æ³•ä¹Ÿå¾ˆæ˜¾ç„¶ï¼Œåªè¦æˆ‘ä»¬æŠŠä¸€é›†åˆçš„å•†å“è®¤ä¸ºæ˜¯ä¸€åºåˆ—çš„å•è¯ï¼Œåˆ™ä½¿ç”¨ embedding å»è·å¾—å•†å“é—´çš„ç›¸å…³æ€§ä¸è·å¾—å•è¯ä¹‹é—´çš„ç›¸å…³æ€§å°±å¹¶æ— ä¸åŒã€‚</p><p>ä»åºåˆ—åˆ°é›†åˆåï¼Œæ—¶ç©ºä¿¡æ¯å°±ä¸¢å¤±äº†ï¼Œä¹Ÿå°±æ˜¯ä¸¢æ‰äº†å®ƒä»¬ä¹‹é—´çš„ç›¸é‚»å…³ç³»ã€‚è€Œ Item2Vec å°±è€ƒè™‘ä¸¢æ‰è¿™éƒ¨åˆ†ä¿¡æ¯ï¼Œä»–ä»¬è®¤ä¸ºåœ¨åŒä¸€ä¸ª set ä¸­çš„å•†å“å°±åº”è¯¥æ˜¯ç›¸å…³çš„ï¼Œæ— è®ºç”¨æˆ·çœ‹åˆ°è¿™ä¸ª set çš„é¡ºåºæˆ–è€…æ—¶é—´æ˜¯å¦‚ä½•çš„ã€‚è™½ç„¶è¿™ä¸ªå‡è®¾åœ¨å…¶ä»–åœºæ™¯ä¸‹ä¸æˆç«‹ï¼Œä¸è¿‡å¯ä»¥è®¤ä¸ºåœ¨å½“å‰åœºæ™¯ä¸‹æ˜¯åˆç†çš„ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬è®¤ä¸ºæ¯å¯¹åœ¨åŒä¸€ä¸ªå­é›†åˆä¸­çš„å•†å“æ˜¯æ­£ä¾‹ã€‚è¿™æ„å‘³ç€é›†åˆçš„å¤§å°å†³å®šäº†çª—å£çš„å¤§å°ã€‚ç‰¹åˆ«åœ°ï¼Œå¯¹äºä¸€ä¸ªç»™å®šé›†åˆçš„å•†å“ï¼Œæ–¹ç¨‹ $(1)$ å˜ä¸º</p><p>$$<br>\frac{1}{K} \sum^K_{i = 1} \sum^K_{j \neq i} \log p(w_j | w_i)<br>$$</p><p>æ•´ä¸ªé›†åˆå¤§å°ä¸º $K$ï¼Œè®¡ç®—ä¸¤ä¸¤ pair ä¹‹é—´çš„ log æ¦‚ç‡ä¹‹å’Œã€‚</p><p>å¦ä¸€ç§æ–¹æ³•ï¼Œåˆ™ä¿æŒæ–¹ç¨‹ $(1)$ ä¸å˜ï¼Œåœ¨æ‰§è¡ŒæœŸé—´ shuffle æ¯ä¸ªé›†åˆå†…çš„å•†å“ã€‚å®éªŒä¸­å‘ç°ä¸¤ç§æ–¹æ³•æœ€ç»ˆçš„è¡¨ç°å·®ä¸å¤šã€‚</p><p>åé¢çš„æ­¥éª¤ä¸ä¸Šä¸€ä¸ª Section ä¿æŒä¸€è‡´ï¼Œè¿™å°±æ˜¯ Item2Vecã€‚å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ $u_i$ ä½œä¸ºç¬¬ $i$ ä¸ªå•†å“çš„è¡¨è¾¾ï¼Œè€Œä¸€å¯¹å•†å“çš„ç›¸å…³æ€§é€šè¿‡ cosine ç›¸å…³æ€§è®¡ç®—å¾—åˆ°ã€‚å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨ $v_i$ï¼Œæˆ–è€… $v_i + u_i$ï¼Œæˆ–è€…å®ƒä¿©çš„ concatenation $[u^T_iv^T_i]^T$ã€‚æœ€åä¸¤ç§æ–¹æ³•ä¼˜åŠ¿æœ‰æ›´å¥½çš„æ•ˆæœã€‚</p><h4 id="Item2Vec-æ•ˆæœ">Item2Vec æ•ˆæœ</h4><p>å°† Item2Vec ç”Ÿæˆçš„ embedding ç”¨ä½œèšç±»ï¼Œä¸åŸºäº SVD æ–¹æ³•çš„ç”¨æˆ· embedding èšç±»ç»“æœè¿›è¡Œæ¯”è¾ƒï¼Œå‘é‡ç»´åº¦ä¿æŒä¸€è‡´ï¼Œå³ $m = 40$ã€‚å¯¹æ¯”æ•°æ®ä¸ºéŸ³ä¹é¢†åŸŸé‡Œ web éŸ³ä¹äººæ ¹æ®ç±»åˆ«çš„èšç±»ï¼ŒåŒä¸€ä¸ªé¢œè‰²çš„èŠ‚ç‚¹è¡¨ç¤ºç›¸åŒç±»å‹çš„éŸ³ä¹äººã€‚å¯¹æ¯”ç»“æœå¦‚ä¸‹</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction-II/item2vec.jpg" alt="item2vec.jpg"></p><p>å¯ä»¥çœ‹å‡ºï¼Œä¸¤è€…å·®è·ä¸å¤§ï¼Œç”šè‡³ Item2Vec çš„æ•ˆæœæ›´å¥½ã€‚</p><h4 id="Reference">Reference</h4><p><a href="https://arxiv.org/pdf/1603.04259v2.pdf">Item2Vec: Neural Item Embedding for Collaborative Filtering</a></p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Embedding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Embedding </tag>
            
            <tag> Item2Vec </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Embedding Introduction (I)</title>
      <link href="/2022/01/19/Embedding-Introduction/"/>
      <url>/2022/01/19/Embedding-Introduction/</url>
      
        <content type="html"><![CDATA[<h4 id="ä»€ä¹ˆæ˜¯-Embedding">ä»€ä¹ˆæ˜¯ Embedding ?</h4><p>å¹¿ä¹‰å¾—è¯´ï¼Œ Embedding å°±æ˜¯ä¸€ç§ç”¨å‘é‡è¡¨è¾¾æŸä¸ªè¯æ±‡çš„æ–¹å¼ã€‚å…¶ç‰¹ç‚¹å°±æ˜¯å¯ä»¥æ•æ‰åˆ°æ–‡æ¡£ä¸­å•è¯çš„ä¸Šä¸‹æ–‡ã€è¯­ä¹‰ä¸å¥æ³•ç›¸ä¼¼ä»¥åŠä¸å…¶ä»–å•è¯çš„å…³ç³»ç­‰ã€‚</p><p>è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰åœ¨åšç±»åˆ«ç‰¹å¾æ—¶å¸¸ç”¨çš„ one-hot æ–¹æ³•ï¼Œå‡è®¾æ•´ä¸ªä¸Šä¸‹æ–‡çš„å•è¯é‡æœ‰ Lï¼Œå¯¹ä»»æ„ä¸€ä¸ªå•è¯ï¼Œæˆ‘ä»¬å°†å…¶åš one-hot è½¬æ¢æˆä¸€ä¸ªé•¿åº¦ä¸º L çš„å‘é‡ï¼Œå…¶ä¸­æŸä¸ªä½ç½®ä¸º 1ï¼Œå…¶ä½™ä½ç½®ä¸º 0ã€‚è¿™æ ·æˆ‘ä»¬çš„ç¡®å¯ä»¥å°†å•è¯æ˜ å°„åˆ°ä¸€ä¸ªå‘é‡è¡¨è¾¾ä¸Šã€‚ä½†å½“å‰è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼šè¿™æ ·çš„è¡¨è¾¾å¯ä»¥è¡¨å¾ä¸¤ä¸ªå•è¯çš„ç›¸å…³æ€§ä¹ˆï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ä¸èƒ½ï¼Œå› ä¸ºä¸¤ä¸ªå•è¯çš„è®¡ç®— cosine ä¸º 0ã€‚(åœ¨ä¸åŒä½ç½®åŒ…å«ä¸€ä¸ª 1)</p><p>æ‰€ä»¥æ€ä¹ˆæ‰èƒ½ä½“ç°ç›¸å…³æ€§å‘¢ï¼Ÿå¯ä»¥è€ƒè™‘å°†è¿™äº› one-hot çŸ©é˜µæ˜ å°„åˆ°ä¸€ä¸ªä½ä½ç©ºé—´ï¼Œä½¿å…¶å‘é‡å€¼å˜ç¨ å¯†ï¼ŒåŒæ—¶ä¿è¯â€œç›¸ä¼¼â€è¯çš„ embedding å†…ç§¯æ¥è¿‘ 1ï¼Œä¸ç›¸ä¼¼è¯çš„ embedding å†…ç§¯æ¥è¿‘ 0ï¼Œâ€œç›¸åâ€è¯çš„ embedding å†…ç§¯æ¥è¿‘ -1ã€‚è¿™æ ·çš„å‘é‡è¡¨è¾¾ï¼Œå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ embeddingã€‚</p><p>ä½†æ˜¯ï¼Œè¿™æ ·çš„ embedding éœ€è¦å¦‚ä½•ç”Ÿæˆå‘¢ï¼Ÿè¿™ç¯‡æ–‡ç« å°±ä¸»è¦è®²è®²ç”Ÿæˆ embedding çš„å‡ ç§æ–¹æ³•ã€‚</p><h4 id="ç”Ÿæˆ-word-embeddings-çš„æ–¹å¼-ä¸€">ç”Ÿæˆ word embeddings çš„æ–¹å¼ (ä¸€)</h4><h5 id="Word2Vec">Word2Vec</h5><p>word2vec æ˜¯ä¸€ç§ä½¿ç”¨æµ…ç¥ç»ç½‘ç»œè®­ç»ƒ word embedding çš„ä¸€ç§æµè¡ŒæŠ€å·§ã€‚å®ƒä¸»è¦é€šè¿‡ä¸¤ç§åŒ…å«ç¥ç»ç½‘ç»œçš„æ–¹å¼è·å¾— embedding: Â Â Skip Gram å’Œ CBOW (Common Bag Of Words)</p><p>è€Œ embedding ä»æ¨¡å‹çš„ä»€ä¹ˆéƒ¨åˆ†è·å¾—å‘¢ï¼Ÿå½“æ¨¡å‹è®­ç»ƒå®Œåï¼Œå®é™…ä¸Šæˆ‘ä»¬å¾—åˆ°äº†ç¥ç»ç½‘ç»œçš„æƒé‡ï¼Œå› ä¸ºè¾“å…¥å±‚æ˜¯ one-hot æ ¼å¼ï¼Œåˆ°éšè—å±‚æ—¶ï¼Œç›¸å½“äºåªæœ‰è¿™ä¸ªè¯å¯¹åº”çš„ embedding è¢«æ¿€æ´»äº†ï¼Œå› è€Œå¯ä»¥ç”¨è¿™ä¸ª embedding æ¥è¡¨è¾¾è¯¥å•è¯ã€‚</p><h6 id="CBOW-æ¨¡å‹">CBOW æ¨¡å‹</h6><p>CBOW æ¨¡å‹ï¼šä½¿ç”¨æ¯ä¸ªè¯çš„ä¸Šä¸‹æ–‡ä½œä¸ºè¾“å…¥ï¼Œä»¥é¢„æµ‹å‡†ç¡®è¿™ä¸ªè¯ä¸ºè®­ç»ƒç›®æ ‡ï¼Œå»è®­ç»ƒæ•´ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</p><p>åªåŒ…å«ä¸€ä¸ªä¸Šä¸‹æ–‡å•è¯ one-hot ä½œä¸ºè¾“å…¥çš„ç¥ç»ç½‘ç»œæ•´ä½“å®é™…ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction/CBOW_word2vec.png" alt="CBOW_word2vec.png"></p><p>è¿™ä¸ªè¾“å…¥ï¼Œæˆ–è€…è¯´è¿™ä¸ªä¸Šä¸‹æ–‡å•è¯æ˜¯ä¸€ä¸ªå¤§å°ä¸º V çš„ one-hot ç¼–ç å‘é‡ã€‚éšè—å±‚åŒ…å« N ä¸ªç¥ç»å…ƒï¼Œè€Œè¾“å‡ºåˆ™åŒæ ·æ˜¯ä¸€ä¸ª Size ä¸º V çš„å‘é‡ï¼Œå…¶ä¸­çš„å€¼é€šè¿‡äº† Softmax åšå½’ä¸€åŒ–ã€‚ç›®çš„æ˜¯é¢„æµ‹ç›®æ ‡å•è¯ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­æœ‰ä¸¤ä¸ªæƒé‡çŸ©é˜µ $W_{vn}$ å’Œ $Wâ€™_{nv}$ ã€‚</p><p>è¿™ä¸ªç¥ç»ç½‘ç»œä¸­ï¼Œå”¯ä¸€ç‰µæ¶‰åˆ°éçº¿æ€§çš„åœ°æ–¹å°±æ˜¯è¾“å‡ºå±‚çš„ softmaxï¼Œè€Œæ²¡æœ‰ç”¨åˆ°å…¶ä»–æ¿€æ´»å‡½æ•°ï¼Œæ¯”å¦‚ sigmoid, tanh æˆ–è€… ReLUã€‚</p><p>åŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬è€ƒè™‘çš„ä¸Šä¸‹æ–‡å•è¯ä¸æ˜¯ä¸€ä¸ªï¼Œè€Œæ˜¯å¤šä¸ªï¼Œåˆ™å¯ä»¥è€ƒè™‘å¦‚ä¸‹ç»“æ„ï¼š</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction/CBOW_word2vec_2.png" alt="CBOW_word2vec_2.png"></p><p>å°† C ä¸ªä¸Šä¸‹æ–‡å•è¯è€ƒè™‘å…¥æ¨¡å‹ï¼Œå‡ä½¿ç”¨æƒé‡çŸ©é˜µ $W_{vn}$ è®¡ç®—éšè—å±‚è¾“å…¥ï¼Œå†å¯¹æ‰€æœ‰ C å–å¹³å‡å€¼å¾—åˆ°è¾“å‡ºå±‚çš„è¾“å…¥ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ä¸Šä¸‹æ–‡å•è¯äº§ç”Ÿè¯è¡¨è¾¾ã€‚</p><h6 id="Skip-Gram-æ¨¡å‹">Skip-Gram æ¨¡å‹</h6><p>æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼Œä»æŸç§æ„ä¹‰ä¸Šï¼Œè¿™ä¸ªç»“æ„å°±åƒ CBOW ç»“æ„ç¿»è½¬è¿‡æ¥ä¸€æ ·</p><p><img src="https://jason24-zeng.github.io/img/Embedding-Introduction/skip_gram.png" alt="skip_gram.png"></p><p>å¯¹æ¯ä¸ªä¸Šä¸‹æ–‡ä½ç½®ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ° C ä¸ª å‘é‡æ¥é¢„æµ‹è¯çš„å¯èƒ½æ€§åˆ†å¸ƒï¼Œæ¯ä¸ªå‘é‡å¯¹åº”ä¸€ä¸ªå•è¯ã€‚</p><p>ä¸¤ç§æ¨¡å‹éƒ½ä½¿ç”¨ backward propagation è´Ÿåé¦ˆçš„æ–¹å¼å»è¿­ä»£å­¦ä¹ ã€‚</p><h6 id="ä¼˜åŠ¿åœºæ™¯">ä¼˜åŠ¿åœºæ™¯</h6><p>å¯¹äºå°‘é‡æ•°æ®ï¼Œskip gram å·¥ä½œè¡¨ç°å¾—æ›´å¥½ï¼Œå¹¶ä¸”æ›´èƒ½è¡¨è¾¾ç¨€æœ‰è¯è¯­ã€‚</p><p>CBOW æ¨¡å‹åˆ™å¯¹æ›´é¢‘ç¹å‡ºç°çš„è¯è¯­è¡¨è¾¾æ›´å¥½ï¼Œä¸”æ›´å¿«ã€‚</p><h6 id="ç®—æ³•ä¼˜åŒ–">ç®—æ³•ä¼˜åŒ–</h6><p>æ–‡ç« ä¸­è¿˜æåˆ°äº†ä½¿ç”¨ Hierachical Softmax å’Œ Skip Gram è´Ÿé‡‡æ ·çš„æ–¹å¼ï¼Œä½¿è®¡ç®—å˜å¾—æ›´æœ‰æ•ˆç‡ã€‚è¯¦ç»†æ–‡ç« å¯ä»¥å‚è€ƒ<a href="https://arxiv.org/abs/1310.4546">åŸæ–‡</a> æˆ–<a href="https://arxiv.org/pdf/1411.2738.pdf">Xin Rong çš„è®ºæ–‡</a></p><h5 id="æ€»ç»“-2">æ€»ç»“</h5><p>æœ¬æ–‡ä¸»è¦ä»‹ç»äº†ä¸€ä¸‹è¯è¡¨è¾¾çš„ä¸€ç§å½¢å¼ embeddingï¼Œå¹¶ç®€å•åœ°è®²è¿°äº† embedding çš„ä¸¤ç§åŸºç¡€è®­ç»ƒæ–¹æ³•ï¼šCBOW å’Œ skip-gramã€‚</p><p>åœ¨å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œå‘ç°ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹ã€‚é€šè¿‡è¾“å…¥å±‚ä¸éšè—å±‚é—´æƒé‡çŸ©é˜µçš„æŸä¸€åˆ—æ¥è¡¨è¾¾æŸä¸ªå•è¯ï¼Œè¿™ä¸ªåšæ³•å’Œ Factorization Machine ä¸­æŸä¸ªç‰¹å¾çš„è¡¨è¾¾æ‰€ç”¨çš„çŸ©é˜µæœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ã€‚åŒæ—¶ï¼Œä¹Ÿå¸Œæœ›è‡ªå·±èƒ½åœ¨ä¸€ç‚¹ç‚¹ç§¯ç´¯çŸ¥è¯†çš„åŒæ—¶èƒ½ç»§ç»­æå‡è‡ªå·±çš„å†™ä½œèƒ½åŠ›ã€‚ å¹¶èƒ½æ‰‹åŠ¨å¤ç°è¿™ä¸ªåŸºç¡€çš„è®­ç»ƒä»£ç ã€‚``</p>]]></content>
      
      
      <categories>
          
          <category> Machine Learning </category>
          
          <category> Embedding </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Embedding </tag>
            
            <tag> Word2Vec </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å †æ’åºä»£ç å®ç°</title>
      <link href="/2022/01/17/heap-sort/"/>
      <url>/2022/01/17/heap-sort/</url>
      
        <content type="html"><![CDATA[<h4 id="ä»€ä¹ˆæ˜¯å †æ’åºï¼Ÿ">ä»€ä¹ˆæ˜¯å †æ’åºï¼Ÿ</h4><p>å †æ’åºæ˜¯ä¸€ç§åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œéœ€è¦å€ŸåŠ©äºä¸€ç§å«åšäºŒå‰å †ï¼ˆBinary Heapï¼‰çš„æ•°æ®ç»“æ„ã€‚å…¶æ“ä½œå’Œé€‰æ‹©æ’åºå¾ˆç›¸ä¼¼ï¼Œå‡å¯ä»¥è®¤ä¸ºæ˜¯ä»æŸä¸ªæ•°æ®ç»“æ„ä¸­é€‰å‡ºæœ€å°/æœ€å¤§çš„æ•°å‡ºæ¥ã€‚</p><h5 id="ä»€ä¹ˆæ˜¯äºŒå‰å †ï¼Ÿ">ä»€ä¹ˆæ˜¯äºŒå‰å †ï¼Ÿ</h5><p>åœ¨å®šä¹‰äºŒå‰å †ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆå£°æ˜ä¸€ä¸ªæ»¡äºŒå‰æ ‘ï¼ˆå®Œå…¨äºŒå‰æ ‘ï¼‰çš„å®šä¹‰ã€‚ä¸€ä¸ªæ»¡äºŒå‰æ ‘æ˜¯ä¸€ä¸ªé™¤æœ€åä¸€å±‚ä»¥å¤–ï¼Œå…¶ä»–å±‚éƒ½è¢«å®Œå…¨å æ»¡çš„äºŒå‰æ ‘ã€‚åŒæ—¶ï¼Œæ»¡äºŒå‰æ ‘è¿˜è¦æ±‚æ ‘çš„èŠ‚ç‚¹å°½å¯èƒ½åœ°é è¿‘å·¦è¾¹ã€‚</p><p>è€ŒäºŒå‰å †ï¼Œåˆ™æ˜¯ä¸€ä¸ªæœ‰ç‰¹æ®Šæ’åºçš„æ»¡äºŒå‰æ ‘ï¼Œä»–æ¯ä¸ªçˆ¶èŠ‚ç‚¹çš„å€¼ï¼Œéƒ½æ¯”ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å€¼å¤§(æˆ–è€…å°)ã€‚å‰è€…ï¼Œè¢«ç§°ä¸ºæœ€å¤§å †ï¼Œåè€…ï¼Œåˆ™æ˜¯æœ€å°å †ã€‚è¿™æ ·çš„å †æˆ‘ä»¬å¯ä»¥ç”¨äºŒå‰æ ‘æˆ–è€…æ•°ç»„æ¥è¡¨è¾¾ã€‚</p><h5 id="æ€ä¹ˆç”¨æ•°ç»„çš„æ ¼å¼è¡¨è¾¾äºŒå‰å †ï¼Ÿ">æ€ä¹ˆç”¨æ•°ç»„çš„æ ¼å¼è¡¨è¾¾äºŒå‰å †ï¼Ÿ</h5><p>æˆ‘ä»¬è¦å……åˆ†åˆ©ç”¨å¥½æ»¡äºŒå‰æ ‘æ¯ä¸€å±‚ä¸ªæ•°å›ºå®šçš„æ€§è´¨ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœä¸€ä¸ªçˆ¶èŠ‚ç‚¹è¢«å­˜åœ¨äº† <code>i</code> ä½ç½®ï¼Œåˆ™å…¶å·¦å­èŠ‚ç‚¹çš„ä½ç½®ä¸º <code>2 * i + 1</code>ï¼Œè€Œå³å­èŠ‚ç‚¹çš„ä½ç½®ä¸º <code>2 * i + 2</code>ã€‚è¿™æ ·çš„ array-base çš„è¡¨è¾¾ç›¸æ¯”äºŒå‰æ ‘å……åˆ†åˆ©ç”¨äº†ç©ºé—´ã€‚</p><h4 id="Heapify-è¿‡ç¨‹">Heapify è¿‡ç¨‹</h4><p>å°†ä¸€ä¸ªäºŒå‰æ ‘é‡æ„æˆä¸€ä¸ªå †æ•°æ®ç»“æ„çš„è¿‡ç¨‹ï¼Œè¢«ç§°ä½œ heapifyã€‚</p><h5 id="å¢åºçš„å †æ’åºç®—æ³•">å¢åºçš„å †æ’åºç®—æ³•</h5><p>æ­¥éª¤ï¼š</p><ol><li><p>é€šè¿‡è¾“å…¥æ•°æ®ä»¶ä¸€ä¸ªæœ€å¤§å †ã€‚</p></li><li><p>æœ€å¤§çš„å…ƒç´ è¢«æ”¾åˆ°äº†å †é¡¶ã€‚ç”¨è¿™ä¸ªå †çš„æœ€åä¸€ä¸ªå€¼ä¸å †é¡¶äº¤æ¢ï¼Œå¹¶ä½¿è¿™ä¸ªå †çš„ size ç¼©å°ä¸€ä½ã€‚æœ€ç»ˆ heapify æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</p></li><li><p>é‡å¤ç¬¬ 2 æ­¥ï¼ŒçŸ¥é“å †åªå‰©ä¸€ä¸ªå…ƒç´ ã€‚</p></li></ol><h5 id="ä»£ç å®ç°">ä»£ç å®ç°</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// heapify ä¸€ä¸ªæ ¹èŠ‚ç‚¹åœ¨ i ä½ç½®çš„å­æ ‘ï¼Œå †çš„å¤§å°ä¸º n</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapify</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; arr, <span class="keyword">int</span> n, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> largest = i;</span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> r = <span class="number">2</span> * i + <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l &lt; n &amp;&amp; arr[l] &gt; arr[largest]) largest = l;</span><br><span class="line">    <span class="keyword">if</span> (r &lt; n &amp;&amp; arr[r] &gt; arr[largest]) largest = r;</span><br><span class="line">    <span class="keyword">if</span> (largest != i) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(arr[i], arr[largest]);</span><br><span class="line">        <span class="built_in">heapify</span>(arr, n, largest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// å †æ’åºè¿‡ç¨‹</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; arr, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 0x01 å»ºå †, ä»ç¬¬ä¸€ä¸ªæœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹å¼€å§‹ heapify</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="built_in">heapify</span>(arr, n, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 0x02 ä¸€ä¸ªä¸€ä¸ªä» heap ä¸­å–å‡ºæœ€å¤§å…ƒç´ ï¼Œæ”¾åˆ°æœ€åï¼Œç›´åˆ°å †åªå‰©ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n - <span class="number">1</span>; i &gt; <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="built_in">swap</span>(arr[<span class="number">0</span>], arr[i]);</span><br><span class="line">        <span class="built_in">heapify</span>(arr, i, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// test case</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printArray</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> num : arr) std::cout &lt;&lt; num &lt;&lt; <span class="string">&quot; &quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; arr = &#123;<span class="number">17</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">4</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> n = arr.<span class="built_in">size</span>();</span><br><span class="line">    <span class="built_in">heapSort</span>(arr, n);</span><br><span class="line">    <span class="built_in">printArray</span>(arr);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Leetcode </category>
          
          <category> Sort </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Leetcode </tag>
            
            <tag> Sort </tag>
            
            <tag> Heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è‚¡ç¥¨é—®é¢˜ç³»åˆ—--åŠ¨æ€è§„åˆ’æ±‚è§£</title>
      <link href="/2022/01/16/stock-problem-dp/"/>
      <url>/2022/01/16/stock-problem-dp/</url>
      
        <content type="html"><![CDATA[<h4 id="å‰è¨€-2">å‰è¨€</h4><p>æœ€è¿‘åˆ·åˆ°å¤šé“ Best Time to Buy and Sell Stock ç³»åˆ—çš„é—®é¢˜ï¼Œæƒ³è¦æ¢ç©¶ä¸€ä¸‹è¿™ç±»é¢˜ç›®çš„é€šç”¨åŠ¨æ€è§„åˆ’è§£æ³•ã€‚ä¸ºæ­¤ï¼Œç‰¹å†™äº†æ­¤æ–‡ï¼Œæ‰¾å‡ºè¿™ç±»é—®é¢˜çš„ç»ƒä¹ ï¼Œä¾›æœ‰é¢è¯•éœ€æ±‚çš„ç›¸å…³åŒå­¦å­¦ä¹ ã€‚</p><h5 id="ç›¸å…³é¢˜ç›®">ç›¸å…³é¢˜ç›®</h5><ol><li><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock/#/description">121. Best Time to Buy and Sell Stock</a></li><li><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-ii/#/description">122. Best Time to Buy and Sell Stock II</a></li><li><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iii/#/description">123. Best Time to Buy and Sell Stock III</a></li><li><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-iv/#/description">188. Best Time to Buy and Sell Stock IV</a></li><li><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-cooldown/#/description">309. Best Time to Buy and Sell Stock with Cooldown</a></li><li><a href="https://leetcode.com/problems/best-time-to-buy-and-sell-stock-with-transaction-fee/description/">714. Best Time to Buy and Sell Stock with Transaction Fee</a></li></ol><h5 id="é€šç”¨é—®é¢˜æè¿°">é€šç”¨é—®é¢˜æè¿°</h5><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>vector&lt;int&gt;&amp; prices</code> ï¼Œè¿™ä¸ªæ•°ç»„ä»£è¡¨äº†ä¸€ä¸ªåºåˆ—åŒ–çš„è‚¡ç¥¨ä»·æ ¼ï¼Œåœ¨æŸäº›é™åˆ¶æ¡ä»¶ä¸‹ï¼Œæ±‚èƒ½é€šè¿‡è¿™äº›å¤©çš„è‚¡ç¥¨ä¹°å–è·å¾—çš„æœ€å¤§æ”¶ç›Šã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥è®°å½•ä¸€ä¸‹å¯èƒ½çš„é™åˆ¶æ¡ä»¶ï¼š</p><ul><li><p>äº¤æ˜“æ¬¡æ•° <code>int k</code></p></li><li><p>äº¤æ˜“å†·å´æ—¶é—´ <code>int time</code></p></li><li><p>äº¤æ˜“è´¹ç”¨ <code>int fee</code></p></li></ul><p>ä»¥åŠä¸€äº›æ³¨æ˜ (notation)ï¼š</p><ul><li>è‚¡ç¥¨ä»·æ ¼æ‰€å¤„æ—¥æœŸ<code>int i</code>ï¼Œç¬¬ä¸€å¤©ä¸º <code>0</code></li></ul><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°çš„è¿™ç±»é—®é¢˜ï¼Œå…¶å®éƒ½å­˜åœ¨å¾ˆæ˜æ˜¾çš„çŠ¶æ€è½¬ç§»å…³ç³»ã€‚</p><ul><li><p>å½“å¤©æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼ŒæŒæœ‰è‚¡ç¥¨ä¸ä¸æŒæœ‰è‚¡ç¥¨</p></li><li><p>å½“å¤©çš„çŠ¶æ€ï¼Œä¼šä¸å‰é¢æŸå¤©çš„çŠ¶æ€æœ‰å…³ã€‚æ¯”å¦‚å¦‚æœä»Šå¤©æŒæœ‰è‚¡ç¥¨ï¼Œåˆ™è¦ä¹ˆæ˜¨å¤©ä¹ŸæŒæœ‰è‚¡ç¥¨ï¼Œè¦ä¹ˆéœ€è¦å†å†·å´æœŸå†…ä¸æŒæœ‰è‚¡ç¥¨ã€‚</p></li></ul><h4 id="é€šç”¨é—®é¢˜çŠ¶æ€è½¬ç§»å…³ç³»">é€šç”¨é—®é¢˜çŠ¶æ€è½¬ç§»å…³ç³»</h4><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªä¸‰ç»´çŸ©é˜µ<code>T</code>ï¼Œ å…¶ä¸­ <code>T[i][k][0]</code> è¡¨ç¤ºç´¯è®¡åˆ°ç¬¬ <code>i</code> å¤©ï¼Œè¿›è¡Œäº†æœ€å¤š <code>k</code> æ¬¡äº¤æ˜“ï¼Œå¹¶åœ¨ç¬¬ <code>i</code> å¤©æ‰‹ä¸Šä¸æŒæœ‰è‚¡ç¥¨ä¸‹çš„æœ€å¤§æ”¶ç›Šï¼›åŒæ ·çš„ï¼Œ<code>T[i][k][0]</code> è¡¨ç¤ºç´¯è®¡åˆ°ç¬¬ <code>i</code> å¤©ï¼Œè¿›è¡Œäº†æœ€å¤š <code>k</code> æ¬¡äº¤æ˜“ï¼Œå¹¶åœ¨ç¬¬ <code>i</code> å¤©æ‰‹ä¸ŠæŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šã€‚ç›®å‰æˆ‘ä»¬å¯ä»¥ä¾æ­¤å†™å‡ºbase æ¡ä»¶ä¸é€’å½’æ¡ä»¶ï¼š</p><ol><li><p>base æƒ…å†µï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å§‹è®¡ç®—è‚¡ç¥¨å‰ä¸€å¤©çš„åˆå§‹åŒ–ï¼Œä¸æŒæœ‰è‚¡ç¥¨è®¤ä¸ºæ˜¯åˆæ³•çš„ï¼Œä¸º 0ï¼ŒæŒæœ‰è‚¡ç¥¨è®¤ä¸ºæ˜¯ä¸å¯èƒ½</span></span><br><span class="line">T[<span class="number">-1</span>][k][<span class="number">0</span>] = <span class="number">0</span>, T[<span class="number">-1</span>][k][<span class="number">1</span>] = INT_MIN</span><br><span class="line"><span class="comment">// æ— å¯äº¤æ˜“æ¬¡æ•°æ—¶çš„åˆå§‹åŒ–ï¼Œä¸æŒæœ‰è‚¡ç¥¨è®¤ä¸ºæ˜¯åˆæ³•çš„ï¼Œä¸º 0ï¼ŒæŒæœ‰è‚¡ç¥¨è®¤ä¸ºæ˜¯ä¸å¯èƒ½</span></span><br><span class="line">T[i][<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>, T[i][<span class="number">0</span>][<span class="number">1</span>] = INT_MIN</span><br></pre></td></tr></table></figure></li><li><p>é€’å½’å…³ç³»ï¼š<br>2.1. ä¸æŒæœ‰è‚¡ç¥¨çš„çŠ¶æ€è½¬ç§»:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œè®¤ä¸ºæ˜¯å‰ä¸€å¤©ä¸æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œä¸å‰ä¸€å¤©æŒæœ‰å½“å–å‡ºè‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šä¹‹é—´çš„æœ€å¤§å€¼ã€‚</span></span><br><span class="line">T[i][k][<span class="number">0</span>] = <span class="built_in">max</span>(T[i - <span class="number">1</span>][k][<span class="number">0</span>], T[i - <span class="number">1</span>][k][<span class="number">1</span>] + prices[i]);</span><br><span class="line"><span class="comment">// å¦‚æœè€ƒè™‘æœ‰äº¤æ˜“è´¹ç”¨ï¼Œåä¸€é¡¹çš„æœ€å¤§æ”¶ç›Šéœ€è¦å‡å»äº¤æ˜“è´¹ç”¨</span></span><br><span class="line">T[i][k][<span class="number">0</span>] = <span class="built_in">max</span>(T[i - <span class="number">1</span>][k][<span class="number">0</span>], T[i - <span class="number">1</span>][k][<span class="number">1</span>] + prices[i] - fee);</span><br></pre></td></tr></table></figure><p>2.2. æŒæœ‰è‚¡ç¥¨çš„çŠ¶æ€è½¬ç§»:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“å¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œè®¤ä¸ºæ˜¯å‰ä¸€å¤©æŒæœ‰è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Šï¼Œä¸å‰ä¸€å¤©ä¸æŒæœ‰è€Œä»Šå¤©ä¹°å…¥è‚¡ç¥¨çš„æœ€å¤§æ”¶ç›Š</span></span><br><span class="line">T[i][k][<span class="number">1</span>] = <span class="built_in">max</span>(T[i - <span class="number">1</span>][k][<span class="number">1</span>], T[i - <span class="number">1</span>][k - <span class="number">1</span>][<span class="number">0</span>] - prices[i]);</span><br><span class="line"><span class="comment">// å¦‚æœè€ƒè™‘äº¤æ˜“è´¹ç”¨ï¼Œé™¤äº†ä¸Šé¢ 2.1 åœ¨å–å‡ºæ—¶æ”¯ä»˜äº¤æ˜“è´¹ç”¨å¤–ï¼Œè¿˜å¯ä»¥è€ƒè™‘æ˜¯åœ¨ä¹°å…¥æ—¶æ”¯ä»˜äº¤æ˜“è´¹ç”¨</span></span><br><span class="line">T[i][k][<span class="number">1</span>] = <span class="built_in">max</span>(T[i - <span class="number">1</span>][k][<span class="number">1</span>], T[i - <span class="number">1</span>][k - <span class="number">1</span>][<span class="number">0</span>] - prices[i] - fee);</span><br><span class="line"><span class="comment">// å¦‚æœè€ƒè™‘ cooldown æ—¶é—´ï¼Œé‚£ä¹ˆæˆ‘ä»¬èƒ½ä¹°å…¥çš„æ¡ä»¶ä¹Ÿå°±ä¸æ˜¯å‰ä¸€å¤©ä¸æŒæœ‰è‚¡ç¥¨ï¼Œè€Œæ˜¯ cooldown æ—¶é—´å‰ä¸æŒæœ‰è‚¡ç¥¨</span></span><br><span class="line">T[i][k][<span class="number">1</span>] = <span class="built_in">max</span>(T[i - <span class="number">1</span>][k][<span class="number">1</span>], T[i - time][k - <span class="number">1</span>][<span class="number">0</span>] - prices[i]);</span><br></pre></td></tr></table></figure></li></ol><h4 id="ç‰¹æ®Š-cases-çš„æ±‚è§£">ç‰¹æ®Š cases çš„æ±‚è§£</h4><p>æœ‰äº†ä¸Šè¿°çš„é€šç”¨çŠ¶æ€è½¬ç§»å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æ¯”è¾ƒè½»æ¾å¾—æ±‚è§£å‚æ•°å€¼å›ºå®šçš„æƒ…å†µã€‚</p><h5 id="case-I-k-1">case I : <code>k = 1</code></h5><p>å½“äº¤æ˜“æ¬¡æ•°é™åˆ¶ä¸º <code>k = 1</code> æ—¶ï¼Œæ¯å¤© <code>i</code> æˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸¤ä¸ªçŠ¶æ€ä¸‹çš„å€¼</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">T[i][<span class="number">1</span>][<span class="number">0</span>] = <span class="built_in">max</span>(T[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">0</span>], T[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>] + prices[i]);</span><br><span class="line">T[i][<span class="number">1</span>][<span class="number">1</span>] = <span class="built_in">max</span>(T[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>], T[i - <span class="number">1</span>][<span class="number">0</span>][<span class="number">0</span>] - prices[i]) = <span class="built_in">max</span>(T[i - <span class="number">1</span>][<span class="number">1</span>][<span class="number">1</span>], - prices[i]);</span><br></pre></td></tr></table></figure><p>ä»è€Œï¼Œè¿™é“é¢˜çš„è§£æ³•ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> T_10 = <span class="number">0</span>, T_11 = INT_MIN;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price : prices) &#123;</span><br><span class="line">            <span class="comment">// æ¯æ¬¡è¿­ä»£æœ€å¤šåªä¼šä¿®æ”¹å…¶ä¸­ä¸€ä¸ªå€¼</span></span><br><span class="line">            T_10 = <span class="built_in">max</span>(T_10, T_11 + price);</span><br><span class="line">            T_11 = <span class="built_in">max</span>(T_11, -price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> T_10;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="Case-II-k-INT-MAX">Case II: <code>k = INT_MAX</code></h5><p>è¿™ä¸ªæ—¶å€™ï¼Œå…¶å® <code>T[i-1][k-1][0] = T[i-1][k][0]</code> ä¸” <code>T[i-1][k-1][1] = T[i-1][k][1]</code></p><p>æ¯å¤© <code>i</code> ï¼Œæˆ‘ä»¬ä»ç„¶æœ‰ä¸¤ä¸ªå˜é‡æœªçŸ¥</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">T[i][k][<span class="number">0</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">0</span>], T[i<span class="number">-1</span>][k][<span class="number">1</span>] + prices[i])</span><br><span class="line">T[i][k][<span class="number">1</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">1</span>], T[i<span class="number">-1</span>][k<span class="number">-1</span>][<span class="number">0</span>] - prices[i]) = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">1</span>], T[i<span class="number">-1</span>][k][<span class="number">0</span>] - prices[i])</span><br></pre></td></tr></table></figure><p>ä»è€Œï¼Œè¿™é“é¢˜çš„è§£æ³•ä¸ºï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> T_k0 = <span class="number">0</span>, T_k1 = INT_MIN;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price : prices) &#123;</span><br><span class="line">            <span class="keyword">int</span> T_k0_old = T_k0;</span><br><span class="line">            T_k0 = <span class="built_in">max</span>(T_k0, T_k1 + price);</span><br><span class="line">            T_k1 = <span class="built_in">max</span>(T_k1, T_k0_old - price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> T_k0;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="Case-III-k-2">Case III : <code>k = 2</code></h5><p>å’Œ case I å¾ˆç›¸ä¼¼ï¼Œä¸è¿‡ç°åœ¨æ¯å¤©éœ€è¦è€ƒå¯Ÿå››ä¸ªå˜é‡ï¼Œå…¶çŠ¶æ€è½¬ç§»å…³ç³»ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">T[i][<span class="number">2</span>][<span class="number">0</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][<span class="number">2</span>][<span class="number">0</span>], T[i<span class="number">-1</span>][<span class="number">2</span>][<span class="number">1</span>] + prices[i])</span><br><span class="line">T[i][<span class="number">2</span>][<span class="number">1</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][<span class="number">2</span>][<span class="number">1</span>], T[i<span class="number">-1</span>][<span class="number">1</span>][<span class="number">0</span>] - prices[i])</span><br><span class="line">T[i][<span class="number">1</span>][<span class="number">0</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][<span class="number">1</span>][<span class="number">0</span>], T[i<span class="number">-1</span>][<span class="number">1</span>][<span class="number">1</span>] + prices[i])</span><br><span class="line">T[i][<span class="number">1</span>][<span class="number">1</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][<span class="number">1</span>][<span class="number">1</span>], - prices[i])</span><br></pre></td></tr></table></figure><p>åŒç†ï¼Œè§£æ³•ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> T_10 = <span class="number">0</span>, T_11 = INT_MIN;</span><br><span class="line">        <span class="keyword">int</span> T_20 = <span class="number">0</span>, T_21 = INT_MIN;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price : prices) &#123;</span><br><span class="line">            T_20 = <span class="built_in">max</span>(T_20, T_21 + price);</span><br><span class="line">            T_21 = <span class="built_in">max</span>(T_21, T_20 - price);</span><br><span class="line">            T_10 = <span class="built_in">max</span>(T_10, T_11 + price);</span><br><span class="line">            T_11 = <span class="built_in">max</span>(T_11, - price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> T_20;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>é€šè¿‡è¿™æ ·çš„æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§£ä»»æ„ k çš„ç»“æœã€‚</p><h5 id="Case-IV-k-INT-MAX-ä½†æ˜¯æœ‰å†·å´">Case IV : <code>k = INT_MAX</code> ä½†æ˜¯æœ‰å†·å´</h5><p>æˆ‘ä»¬è€ƒè™‘ cool down ä¸º 1 çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦åœ¨ç¬¬ <code>i</code> å¤©ä¹°è‚¡ç¥¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªèƒ½åœ¨ç¬¬ <code>i - 2</code> å‰å°†è‚¡ç¥¨å–å‡ºã€‚çŠ¶æ€è½¬ç§»æ–¹ç¨‹å˜ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">T[i][k][<span class="number">0</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">0</span>], T[i<span class="number">-1</span>][k][<span class="number">1</span>] + prices[i])</span><br><span class="line">T[i][k][<span class="number">1</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">1</span>], T[i<span class="number">-2</span>][k][<span class="number">0</span>] - prices[i])</span><br></pre></td></tr></table></figure><p>è§£æ³•ä¿®æ”¹ä¸º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> T_k0 = <span class="number">0</span>, T_k1 = INT_MIN, T_k0_pre = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price : prices) &#123;</span><br><span class="line">            <span class="keyword">int</span> T_k0_old = T_k0;</span><br><span class="line">            T_k0 = <span class="built_in">max</span>(T_k0, T_k1 + price);</span><br><span class="line">            T_k1 = <span class="built_in">max</span>(T_k1, T_k0_pre - price);</span><br><span class="line">            T_k0_pre = T_k0_old;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> T_k0;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="Case-V-k-INT-MAX-æœ‰äº¤æ˜“è´¹ç”¨">Case V : <code>k = INT_MAX</code> æœ‰äº¤æ˜“è´¹ç”¨</h5><p>åœ¨ case II çš„åŸºç¡€ä¸Šï¼Œè€ƒè™‘è´­ä¹°æˆ–å–å‡ºæ—¶æ”¶ç›Šå¤šå‡å»ä¸€ä¸ª fee å³å¯</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">T[i][k][<span class="number">0</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">0</span>], T[i<span class="number">-1</span>][k][<span class="number">1</span>] + prices[i])</span><br><span class="line">T[i][k][<span class="number">1</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">1</span>], T[i<span class="number">-1</span>][k][<span class="number">0</span>] - prices[i] - fee)</span><br></pre></td></tr></table></figure><p>æˆ–è€…</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">T[i][k][<span class="number">0</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">0</span>], T[i<span class="number">-1</span>][k][<span class="number">1</span>] + prices[i] - fee)</span><br><span class="line">T[i][k][<span class="number">1</span>] = <span class="built_in">max</span>(T[i<span class="number">-1</span>][k][<span class="number">1</span>], T[i<span class="number">-1</span>][k][<span class="number">0</span>] - prices[i])</span><br></pre></td></tr></table></figure><h6 id="è§£æ³•-I-ä¹°å…¥æ—¶è€ƒè™‘è´¹ç”¨">è§£æ³• I : ä¹°å…¥æ—¶è€ƒè™‘è´¹ç”¨</h6><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> T_k0 = <span class="number">0</span>, T_k1 = INT_MIN;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price : prices) &#123;</span><br><span class="line">            <span class="keyword">int</span> T_k0_old = T_k0;</span><br><span class="line">            T_k0 = <span class="built_in">max</span>(T_k0, T_k1 + price);</span><br><span class="line">            T_k1 = <span class="built_in">max</span>(T_k1, T_k0_old - price - fee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> T_k0;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h6 id="è§£æ³•-II-ï¼šå–å‡ºæ—¶è€ƒè™‘è´¹ç”¨">è§£æ³• II ï¼šå–å‡ºæ—¶è€ƒè™‘è´¹ç”¨</h6><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> T_k0 = <span class="number">0</span>, T_k1 = INT_MIN;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> price : prices) &#123;</span><br><span class="line">            <span class="keyword">int</span> T_k0_old = T_k0;</span><br><span class="line">            T_k0 = <span class="built_in">max</span>(T_k0, T_k1 + price - fee);</span><br><span class="line">            T_k1 = <span class="built_in">max</span>(T_k1, T_k0_old - price);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> T_k0;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h5 id="æ€»ç»“-3">æ€»ç»“</h5><p>å¯¹äºè¿™ä¸€ç±»è‚¡ç¥¨äº¤æ˜“ç›¸å…³çš„é—®é¢˜ï¼ŒåŠ¨æ€è§„åˆ’å‡å¯æ±‚è§£ã€‚</p><p>é‡ç‚¹éœ€è¦å…³æ³¨ï¼š</p><ul><li><p>äº¤æ˜“æ—¥æœŸ <code>i</code></p></li><li><p>æœ€å¤§å…è®¸äº¤æ˜“æ¬¡æ•° <code>k</code></p></li><li><p>æ¯å¤©èƒ½æœ‰çš„çŠ¶æ€</p></li></ul><p>åªè¦æˆ‘ä»¬å¼„æ¸…æ¥šæ¯å¤©è¿™äº›çŠ¶æ€ä¹‹é—´çš„è½¬ç§»å…³ç³»ï¼Œå°±å¯ä»¥è½»æ¾ solve è¿™ä¸€ç³»åˆ—é—®é¢˜ã€‚åŒæ—¶ï¼Œå¼„æ¸…æ¥šçŠ¶æ€è½¬ç§»å…³ç³»ï¼Œè¿˜èƒ½å¯¹ç©ºé—´å¤æ‚åº¦è¿›è¡Œä¼˜åŒ–ï¼Œä¸å†éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ•°ç»„å»ä¿ç•™æ¯å¤©äº¤æ˜“çŠ¶æ€çš„æœ€å€¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Leetcode </category>
          
          <category> Dynamic Program </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Leetcode </tag>
            
            <tag> DP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Self Introduction</title>
      <link href="/2022/01/15/self-introduction/"/>
      <url>/2022/01/15/self-introduction/</url>
      
        <content type="html"><![CDATA[<h4 id="Self-Introduction">Self Introduction</h4><p>My name is Jason Zeng, a junior machine learning engineer worked in Kuaishou Corporation last year. For the first half of the year, I was working as an intern in search scene of HashTag. My major target is to improve the ranking result by comparing query-photo relevance. While in the second half of the year, I became a full time employer in search scene of Electric Commerce. My major work is focus on the recall and coarse-grained ranking stage.</p><p>Prior to working, I gained my bachelor degree in University of Chinese Academy of Science in Beijing, and then I pursue my Ph.D. study in University of California, San Diego. In 2020, I quit my Ph.D. programme and went back to China with master degree.</p><p>Thatâ€™s all for my introduction, thank you.</p>]]></content>
      
      
      <categories>
          
          <category> Resume </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Resume </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­å»º Hexo åšå®¢</title>
      <link href="/2022/01/14/%E6%90%AD%E5%BB%BAHexo-blog/"/>
      <url>/2022/01/14/%E6%90%AD%E5%BB%BAHexo-blog/</url>
      
        <content type="html"><![CDATA[<h4 id="Mac-å®‰è£…-Node-js">Mac å®‰è£… Node.js</h4><ul><li>æœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡ Homebrew è¿›è¡Œ Node.js å’Œ npm çš„å®‰è£…ã€‚å¸¸ç”¨æŒ‡ä»¤</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ–°ä¸å®‰è£… node</span></span><br><span class="line">brew update</span><br><span class="line">brew install node</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ£€æŸ¥å®‰è£…ç‰ˆæœ¬</span></span><br><span class="line">brew list</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤ node</span></span><br><span class="line">brew uninstall node</span><br></pre></td></tr></table></figure><h4 id="å®‰è£…-Hexo">å®‰è£… Hexo</h4><ul><li>ä½¿ç”¨ npm å‘½ä»¤å®‰è£… Hexo</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli </span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ–è€…å®‰è£… æ‡’äººåŒ…</span></span><br><span class="line">npm install -g hexo</span><br></pre></td></tr></table></figure><h4 id="åˆå§‹åŒ–-Hexo">åˆå§‹åŒ– Hexo</h4><ol><li><p>åˆå§‹åŒ–ä¸€ä¸ª directory: <code>mkdir ~/hexo/dir &amp;&amp; cd ~/hexo/dir</code></p></li><li><p>åˆå§‹åŒ–åšå®¢ï¼š<code>hexo init</code></p></li><li><p>é™æ€ç¼–è¯‘åšå®¢ : <code>hexo g</code> \ <code>hexo generate</code></p></li><li><p>ç¦»çº¿æ£€æŸ¥åšå®¢æ•ˆæœï¼š<code>hexo s</code>\ <code>hexo server</code> å¯ä»¥é€šè¿‡è®¿é—®  <code>http://localhost:4000/</code> æœ¬åœ°æ£€æŸ¥æ•ˆæœ</p></li><li><p>ä¿®æ”¹ config æ–‡ä»¶ï¼Œè·¯å¾„åœ¨ <code>~/hexo/dir/_config.yml</code>ï¼Œéœ€è¦ä¿®æ”¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">deploy:</span></span><br><span class="line"> <span class="attr">type :</span> <span class="string">git</span></span><br><span class="line"> <span class="attr">repository:</span> <span class="string">git@github.com:username/username.github.io.git</span></span><br><span class="line"> <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure></li><li><p>æ¨åˆ°çº¿ä¸Š <code>hexo d</code> \ <code>hexo deploy (-m message)</code></p></li></ol><h4 id="å†™åšå®¢å¹¶æ¨åˆ°çº¿ä¸Š">å†™åšå®¢å¹¶æ¨åˆ°çº¿ä¸Š</h4><ol><li><p>æ–°å»ºåšå®¢ï¼š<code>hexo n &quot;your title&quot;</code>\ <code>hexo new &quot;your title&quot;</code></p></li><li><p>è¿›å…¥ç›¸åº”è·¯å¾„ä¿®æ”¹ md æ–‡ä»¶(å†™åšå®¢)ï¼š <code>cd ~/hexo/dir/source/_posts/your title.md</code></p></li><li><p>é™æ€ç¼–è¯‘åšå®¢ : <code>hexo g</code> \ <code>hexo generate</code></p></li><li><p>ç¦»çº¿æ£€æŸ¥åšå®¢æ•ˆæœï¼š<code>hexo s</code>\ <code>hexo server</code> å¯ä»¥é€šè¿‡è®¿é—® <code>http://localhost:4000/</code> æœ¬åœ°æ£€æŸ¥æ•ˆæœ</p></li><li><p>æ¨åˆ°çº¿ä¸Š <code>hexo d</code> \ <code>hexo deploy (-m message)</code></p></li></ol><h4 id="ä¸ªæ€§åŒ–-Hexo-åšå®¢">ä¸ªæ€§åŒ– Hexo åšå®¢</h4><ul><li>å‚è€ƒï¼š<a href="https://butterfly.js.org/posts/dc584b87/">Butterfly å®‰è£æ–‡æª”</a></li></ul><h5 id="å¦‚ä½•å¯¹æ¯ä¸€ç¯‡-post-åšç›¸åº”çš„ä¿®æ”¹ï¼Ÿ">å¦‚ä½•å¯¹æ¯ä¸€ç¯‡ post åšç›¸åº”çš„ä¿®æ”¹ï¼Ÿ</h5><p>å¯å‚è€ƒ <a href="https://blog.csdn.net/qq_43857095/article/details/108306164"># Hexo butterfly è‡ªå®šä¹‰æ–‡ç« å°é¢ &amp;&amp; ä¸»é¡µé¡¶éƒ¨å›¾ç‰‡æ›´æ”¹</a></p><p>æ¯”è¾ƒé‡è¦çš„å‡ ä¸ªå‚æ•°ï¼š</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">Hexo</span> <span class="string">Blog</span></span><br><span class="line"><span class="attr">tags:</span> [<span class="string">Hexo</span>, <span class="string">Nodejs</span>, <span class="string">git</span>] <span class="comment"># æˆ–è€…ç”¨ - éš”è¡Œåˆ†éš”</span></span><br><span class="line"><span class="attr">categories:</span> <span class="string">Hexo</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">å¯¹è¿™ç¯‡</span> <span class="string">blog</span> <span class="string">çš„æè¿°</span></span><br><span class="line"><span class="attr">top_img:</span> <span class="string">/img/avocado.jpeg</span> <span class="comment"># å¤´éƒ¨å›¾ç‰‡</span></span><br><span class="line"><span class="attr">comments:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦ç°å®è¯„è®º</span></span><br><span class="line"><span class="attr">cover:</span> <span class="string">/img/hashtag.jpeg</span> <span class="comment"># å°é¢å›¾ç‰‡</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰ pug ä»¥åŠ stylus çš„æ¸²æŸ“å™¨ï¼Œè¯·ä¸‹è½½å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br></pre></td></tr></table></figure><h5 id="å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆ-categories-é¡µæˆ–è€…-tags-é¡µï¼Ÿ">å¦‚ä½•è‡ªåŠ¨ç”Ÿæˆ categories é¡µæˆ–è€… tags é¡µï¼Ÿ</h5><ol><li><p>åˆ›å»º categories page æˆ–è€… tags pageï¼Œè¿™æ—¶ä¼šåœ¨ source æ–‡ä»¶å¤¹ä¸‹ç”Ÿæˆç›¸åº”å­æ–‡ä»¶å¤¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hexo new page categories</span><br><span class="line">hexo new page tags</span><br></pre></td></tr></table></figure></li><li><p>åœ¨ç›¸åº”çš„å­æ–‡ä»¶å¤¹ä¸­ä¼šç”Ÿæˆ <code>index.md</code> æ–‡ä»¶, ä¿®æ”¹ <a href="http://index.md">index.md</a> ä¸­çš„å¤´æ–‡ä»¶é…ç½®å¦‚ä¸‹</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    <span class="attr">title:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2022-01-14 20:10:25</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">&quot;categories&quot;</span></span><br><span class="line"><span class="attr">cover:</span> <span class="string">/img/category.png</span></span><br><span class="line"><span class="attr">top_img:</span> <span class="string">/img/category.png</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹ <code>_config.butterfly.yml</code> æ–‡ä»¶ä¸­çš„ä»¥ä¸‹ command</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">aside:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hide:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">true</span> <span class="comment"># display on mobile</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">right</span> <span class="comment"># left or right</span></span><br><span class="line">  <span class="attr">card_author:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span></span><br><span class="line">    <span class="attr">button:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">My</span> <span class="string">Github</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://github.com/Jason24-Zeng/Jason24-Zeng.github.io/tree/main</span></span><br><span class="line">  <span class="attr">card_announcement:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">This</span> <span class="string">is</span> <span class="string">my</span> <span class="string">Blog</span></span><br><span class="line">  <span class="attr">card_recent_post:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">5</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort:</span> <span class="string">date</span> <span class="comment"># date or updated</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_categories:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">expand:</span> <span class="literal">false</span> <span class="comment"># none/true/false</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_tags:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">40</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">color:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_archives:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">monthly</span> <span class="comment"># yearly or monthly</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">MMMM</span> <span class="string">YYYY</span> <span class="comment"># eg: YYYYå¹´MMæœˆ</span></span><br><span class="line">    <span class="attr">order:</span> <span class="number">-1</span> <span class="comment"># Sort of order. 1, asc for ascending; -1, desc for descending</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_webinfo:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">post_count:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">last_push_date:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡Œä»¥ä¸‹æ‰§è¡Œæ›´æ–° blog</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo g &amp;&amp; hexo d</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> Hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> Blog </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
